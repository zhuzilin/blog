{"data":{"markdownRemark":{"html":"<h2>Type of CORS</h2>\n<p>There are mainly two kinds for CORS. CORS for simple request and CORS for preflight request.</p>\n<h2>Simple Request</h2>\n<p>Simple request is GET request or POST request with Content-Type in one of application/x-www-form-urlencoded, multipart/form-data, text/plain. Note that the commonly used <em>application</em>/json is not simple request. Those Content-Type are exceptions due to historical legacy.</p>\n<p>For simple request we only need to add an \"Origin: <a href=\"http://api.bob.com\">http://api.bob.com</a>\" in the request header.</p>\n<blockquote>\n<pre><code class=\"language-http\">GET /cors HTTP/1.1\nOrigin: http://api.bob.com\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n</code></pre>\n</blockquote>\n<p> And add \"Access-Control-Allow-Origin: <a href=\"http://api.bob.com\">http://api.bob.com</a>\" in the response.</p>\n<blockquote>\n<pre><code class=\"language-http\">Access-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text/html; charset=utf-8\n</code></pre>\n</blockquote>\n<p>Or simply use \"Access-Control-Allow-Origin: *\" in the response.</p>\n<p>If hoping to add cookie to the request, we need to add \"withCredentials: true\" in the request and \"Access-Control-Allow-Credentials: true\" in the server. Note that when sending cookie, we cannot set \"Access-Control-Allow-Origin\" as \"*\", but the domain of client.</p>\n<h2>Preflight Request</h2>\n<p>For request other than simple request, the client will add another request as preflight request. Only when the domain of client is in the allowed list of server, the client will then send the original request to the server.</p>\n<p>The preflight request will look like this:</p>\n<blockquote>\n<pre><code class=\"language-http\">OPTIONS /cors HTTP/1.1\nOrigin: http://api.bob.com\nAccess-Control-Request-Method: PUT\nAccess-Control-Request-Headers: X-Custom-Header\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...\n</code></pre>\n</blockquote>\n<p>And the server will need to return status code 200 for this request. Here is an express middleware that can solve this problem nicely,</p>\n<pre><code class=\"language-javascript\">// add header and return for OPTIONS request\napp.use(function(req, res, next) {\n    res.header('Access-Control-Allow-Origin', '*');\n    res.header('Access-Control-Allow-Methods', 'GET, PUT, POST, DELETE, OPTIONS');\n    res.header('Access-Control-Allow-Headers', 'Content-Type, Authorization, Content-Length, X-Requested-With');\n\n    //intercepts OPTIONS method\n    if ('OPTIONS' === req.method) {\n        //respond with 200\n        res.send(200);\n    }\n    else {\n        //move on\n        next();\n    }\n});\n</code></pre>\n<h2>References</h2>\n<ol>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/04/cors.html\">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a></li>\n</ol>","frontmatter":{"title":"About CORS"}}},"pageContext":{"slug":"/About-CORS/"}}