{"data":{"markdownRemark":{"html":"<h2>Type of CORS</h2>\n<p>There are mainly two kinds for CORS. CORS for simple request and CORS for preflight request.</p>\n<h2>Simple Request</h2>\n<p>Simple request is GET request or POST request with Content-Type in one of application/x-www-form-urlencoded, multipart/form-data, text/plain. Note that the commonly used <em>application</em>/json is not simple request. Those Content-Type are exceptions due to historical legacy.</p>\n<p>For simple request we only need to add an \"Origin: <a href=\"http://api.bob.com\">http://api.bob.com</a>\" in the request header.</p>\n<blockquote>\n\n    <div class=\"gatsby-highlight\" data-language=\"http\">\n      <pre class=\" cm-s-ambiance\"\n      ><code><span>GET /cors HTTP/1.1\nOrigin: http://api.bob.com\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...</span></code></pre>\n    </div>\n</blockquote>\n<p> And add \"Access-Control-Allow-Origin: <a href=\"http://api.bob.com\">http://api.bob.com</a>\" in the response.</p>\n<blockquote>\n\n    <div class=\"gatsby-highlight\" data-language=\"http\">\n      <pre class=\" cm-s-ambiance\"\n      ><code><span>Access-Control-Allow-Origin: http://api.bob.com\nAccess-Control-Allow-Credentials: true\nAccess-Control-Expose-Headers: FooBar\nContent-Type: text/html; charset=utf-8</span></code></pre>\n    </div>\n</blockquote>\n<p>Or simply use \"Access-Control-Allow-Origin: *\" in the response.</p>\n<p>If hoping to add cookie to the request, we need to add \"withCredentials: true\" in the request and \"Access-Control-Allow-Credentials: true\" in the server. Note that when sending cookie, we cannot set \"Access-Control-Allow-Origin\" as \"*\", but the domain of client.</p>\n<h2>Preflight Request</h2>\n<p>For request other than simple request, the client will add another request as preflight request. Only when the domain of client is in the allowed list of server, the client will then send the original request to the server.</p>\n<p>The preflight request will look like this:</p>\n<blockquote>\n\n    <div class=\"gatsby-highlight\" data-language=\"http\">\n      <pre class=\" cm-s-ambiance\"\n      ><code><span>OPTIONS /cors HTTP/1.1\nOrigin: http://api.bob.com\nAccess-Control-Request-Method: PUT\nAccess-Control-Request-Headers: X-Custom-Header\nHost: api.alice.com\nAccept-Language: en-US\nConnection: keep-alive\nUser-Agent: Mozilla/5.0...</span></code></pre>\n    </div>\n</blockquote>\n<p>And the server will need to return status code 200 for this request. Here is an express middleware that can solve this problem nicely,</p>\n\n    <div class=\"gatsby-highlight\" data-language=\"javascript\">\n      <pre class=\" cm-s-ambiance\"\n      ><code><span class=\"cm-comment\">// add header and return for OPTIONS request</span><span>\n</span><span class=\"cm-variable\">app</span><span>.</span><span class=\"cm-property\">use</span><span>(</span><span class=\"cm-keyword\">function</span><span>(</span><span class=\"cm-def\">req</span><span>,</span><span> </span><span class=\"cm-def\">res</span><span>,</span><span> </span><span class=\"cm-def\">next</span><span>)</span><span> </span><span>{\n</span><span>    </span><span class=\"cm-variable-2\">res</span><span>.</span><span class=\"cm-property\">header</span><span>(</span><span class=\"cm-string\">'Access-Control-Allow-Origin'</span><span>,</span><span> </span><span class=\"cm-string\">'*'</span><span>);\n</span><span>    </span><span class=\"cm-variable-2\">res</span><span>.</span><span class=\"cm-property\">header</span><span>(</span><span class=\"cm-string\">'Access-Control-Allow-Methods'</span><span>,</span><span> </span><span class=\"cm-string\">'GET, PUT, POST, DELETE, OPTIONS'</span><span>);\n</span><span>    </span><span class=\"cm-variable-2\">res</span><span>.</span><span class=\"cm-property\">header</span><span>(</span><span class=\"cm-string\">'Access-Control-Allow-Headers'</span><span>,</span><span> </span><span class=\"cm-string\">'Content-Type, Authorization, Content-Length, X-Requested-With'</span><span>);\n\n</span><span>    </span><span class=\"cm-comment\">//intercepts OPTIONS method</span><span>\n</span><span>    </span><span class=\"cm-keyword\">if</span><span> </span><span>(</span><span class=\"cm-string\">'OPTIONS'</span><span> </span><span class=\"cm-operator\">===</span><span> </span><span class=\"cm-variable-2\">req</span><span>.</span><span class=\"cm-property\">method</span><span>)</span><span> </span><span>{\n</span><span>        </span><span class=\"cm-comment\">//respond with 200</span><span>\n</span><span>        </span><span class=\"cm-variable-2\">res</span><span>.</span><span class=\"cm-property\">send</span><span>(</span><span class=\"cm-number\">200</span><span>);\n</span><span>    </span><span>}\n</span><span>    </span><span class=\"cm-keyword\">else</span><span> </span><span>{\n</span><span>        </span><span class=\"cm-comment\">//move on</span><span>\n</span><span>        </span><span class=\"cm-variable-2\">next</span><span>();\n</span><span>    </span><span>}\n});</span></code></pre>\n    </div>\n<h2>References</h2>\n<ol>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/04/cors.html\">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a></li>\n</ol>","frontmatter":{"title":"About CORS"}}},"pageContext":{"slug":"/About-CORS/"}}