{"componentChunkName":"component---src-templates-blog-post-js","path":"/About-CORS/","webpackCompilationHash":"4caac2cf7443445fbc35","result":{"data":{"markdownRemark":{"html":"<h2>Type of CORS</h2>\n<p>First of all, it is very important that CORS error is a restriction from <strong>browser</strong>. And when a server is sending some request to other server, no CORS error will happens. Therefore, we can use our server (the code we can modify and control) as a medium to connect frontend and some resource from other resources. And the following codes are all for our intermediate server.</p>\n<p>There are mainly two kinds for CORS. CORS for simple request and CORS for preflight request.</p>\n<h2>Simple Request</h2>\n<p>Simple request is GET request or POST request with Content-Type in one of application/x-www-form-urlencoded, multipart/form-data, text/plain. Note that the commonly used <em>application</em>/json is not simple request. Those Content-Type are exceptions due to historical legacy.</p>\n<p>For simple request we only need to add an <code class=\"language-text\">Origin: http://api.bob.com</code> in the request header.</p>\n<blockquote>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre class=\"language-http\"><code class=\"language-http\"><span class=\"token request-line\"><span class=\"token property\">GET</span> /cors HTTP/1.1</span>\n<span class=\"token header-name keyword\">Origin:</span> http://api.bob.com\n<span class=\"token header-name keyword\">Host:</span> api.alice.com\n<span class=\"token header-name keyword\">Accept-Language:</span> en-US\n<span class=\"token header-name keyword\">Connection:</span> keep-alive\n<span class=\"token header-name keyword\">User-Agent:</span> Mozilla/5.0...</code></pre></div>\n</blockquote>\n<p> And add <code class=\"language-text\">Access-Control-Allow-Origin: http://api.bob.com</code> in the response.</p>\n<blockquote>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre class=\"language-http\"><code class=\"language-http\"><span class=\"token header-name keyword\">Access-Control-Allow-Origin:</span> http://api.bob.com\n<span class=\"token header-name keyword\">Access-Control-Allow-Credentials:</span> true\n<span class=\"token header-name keyword\">Access-Control-Expose-Headers:</span> FooBar\n<span class=\"token header-name keyword\">Content-Type:</span> text/html; charset=utf-8</code></pre></div>\n</blockquote>\n<p>Or simply use <code class=\"language-text\">Access-Control-Allow-Origin: *</code> in the response.</p>\n<p>If hoping to add cookie to the request, we need to add \"withCredentials: true\" in the request and \"Access-Control-Allow-Credentials: true\" in the server. Note that when sending cookie, we cannot set \"Access-Control-Allow-Origin\" as \"*\", but the domain of client.</p>\n<h2>Preflight Request</h2>\n<p>For request other than simple request, the client will add another request as preflight request. Only when the domain of client is in the allowed list of server, the client will then send the original request to the server.</p>\n<p>The preflight request will look like this:</p>\n<blockquote>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre class=\"language-http\"><code class=\"language-http\"><span class=\"token request-line\"><span class=\"token property\">OPTIONS</span> /cors HTTP/1.1</span>\n<span class=\"token header-name keyword\">Origin:</span> http://api.bob.com\n<span class=\"token header-name keyword\">Access-Control-Request-Method:</span> PUT\n<span class=\"token header-name keyword\">Access-Control-Request-Headers:</span> X-Custom-Header\n<span class=\"token header-name keyword\">Host:</span> api.alice.com\n<span class=\"token header-name keyword\">Accept-Language:</span> en-US\n<span class=\"token header-name keyword\">Connection:</span> keep-alive\n<span class=\"token header-name keyword\">User-Agent:</span> Mozilla/5.0...</code></pre></div>\n</blockquote>\n<p>And the server will need to return status code 200 for this request. Here is an express middleware that can solve this problem nicely,</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// add header and return for OPTIONS request</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Methods'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'GET, PUT, POST, DELETE, OPTIONS'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    res<span class=\"token punctuation\">.</span><span class=\"token function\">header</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Access-Control-Allow-Headers'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Content-Type, Authorization, Content-Length, X-Requested-With'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">//intercepts OPTIONS method</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'OPTIONS'</span> <span class=\"token operator\">===</span> req<span class=\"token punctuation\">.</span>method<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//respond with 200</span>\n        res<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">//move on</span>\n        <span class=\"token function\">next</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>References</h2>\n<ol>\n<li><a href=\"http://www.ruanyifeng.com/blog/2016/04/cors.html\">http://www.ruanyifeng.com/blog/2016/04/cors.html</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS\">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a></li>\n</ol>","frontmatter":{"title":"About CORS","date":"2018-11-04T09:59:53.000Z","tags":["Web"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/About-CORS/"}}}