<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.44 'Fira Sans',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Fira Sans',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2.15rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.58293rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.35824rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.85805rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;color:hsla(0,0%,0%,1);font-family:'Playfair Display',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.79482rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}ul{margin-left:1.44rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.44rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;font-size:0.85rem;line-height:1.44rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;font-size:1rem;line-height:1.44rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}blockquote{margin-left:0;margin-right:1.44rem;margin-top:0;padding-bottom:0;padding-left:1.17rem;padding-right:0;padding-top:0;margin-bottom:1.08rem;font-size:1.16543rem;line-height:1.44rem;color:hsla(0,0%,0%,0.59);font-style:italic;border-left:0.27rem solid hsla(0,0%,0%,0.2);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.08rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.08rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.08rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.44rem;margin-bottom:calc(1.08rem / 2);margin-top:calc(1.08rem / 2);}li > ul{margin-left:1.44rem;margin-bottom:calc(1.08rem / 2);margin-top:calc(1.08rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.08rem / 2);}code{font-size:0.85rem;line-height:1.44rem;}kbd{font-size:0.85rem;line-height:1.44rem;}samp{font-size:0.85rem;line-height:1.44rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:0.96rem;padding-right:0.96rem;padding-top:0.72rem;padding-bottom:calc(0.72rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#9f392b;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.44rem;color:hsla(0,0%,0%,0.8);font-weight:400;}blockquote cite:before{content:"â€” ";}@media only screen and (max-width:480px){blockquote{margin-left:-1.08rem;margin-right:0;padding-left:0.81rem;}}</style><link as="script" rel="preload" href="/component---src-templates-blog-post-js-edb632f8e95dc6f71e05.js"/><style data-href="/styles.59d5c578236e9940eba2.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}blockquote{font-size:inherit!important}p.info{color:silver}@font-face{font-family:KaTeX_AMS;src:url(/static/KaTeX_AMS-Regular-e78e28b4834954df047e4925e9dbf354.woff2) format("woff2"),url(/static/KaTeX_AMS-Regular-7f06b4e30317f784d61d26686aed0ab2.woff) format("woff"),url(/static/KaTeX_AMS-Regular-aaf4eee9fba9907d61c3935e0b6a54ae.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(/static/KaTeX_Caligraphic-Bold-4ec58befa687e9752c3c91cd9bcf1bcb.woff2) format("woff2"),url(/static/KaTeX_Caligraphic-Bold-1e802ca9dedc4ed4e3c6f645e4316128.woff) format("woff"),url(/static/KaTeX_Caligraphic-Bold-021dd4dc61ee5f5cdf315f43b48c094b.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(/static/KaTeX_Caligraphic-Regular-7edb53b6693d75b8a2232481eea1a52c.woff2) format("woff2"),url(/static/KaTeX_Caligraphic-Regular-d3b46c3a530116933081d9d74e3e9fe8.woff) format("woff"),url(/static/KaTeX_Caligraphic-Regular-d49f2d55ce4f40f982d8ba63d746fbf9.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(/static/KaTeX_Fraktur-Bold-d5b59ec9764e10f4a82369ae29f3ac58.woff2) format("woff2"),url(/static/KaTeX_Fraktur-Bold-c4c8cab7d5be97b2bb283e531c077355.woff) format("woff"),url(/static/KaTeX_Fraktur-Bold-a31e7cba7b7221ebf1a2ae545fb306b2.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(/static/KaTeX_Fraktur-Regular-32a5339eb809f381a7357ba56f82aab3.woff2) format("woff2"),url(/static/KaTeX_Fraktur-Regular-b7d9c46bff5d51da6209e355cc4a235d.woff) format("woff"),url(/static/KaTeX_Fraktur-Regular-a48dad4f58c82e38a10da0ceebb86370.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-Bold-8e1e01c4b1207c0a383d9a2b4f86e637.woff2) format("woff2"),url(/static/KaTeX_Main-Bold-22086eb5d97009c3e99bcc1d16ce6865.woff) format("woff"),url(/static/KaTeX_Main-Bold-9ceff51b3cb7ce6eb4e8efa8163a1472.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-BoldItalic-284a17fe5baf72ff8217d4c7e70c0f82.woff2) format("woff2"),url(/static/KaTeX_Main-BoldItalic-4c57dbc44bfff1fdf08a59cf556fdab3.woff) format("woff"),url(/static/KaTeX_Main-BoldItalic-e8b44b990516dab7937bf240fde8b46a.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-Italic-e533d5a2506cf053cd671b335ec04dde.woff2) format("woff2"),url(/static/KaTeX_Main-Italic-99be0e10c38cd42466e6fe1665ef9536.woff) format("woff"),url(/static/KaTeX_Main-Italic-29c86397e75cdcb3135af8295f1c2e28.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(/static/KaTeX_Main-Regular-5c734d78610fa35282f3379f866707f2.woff2) format("woff2"),url(/static/KaTeX_Main-Regular-b741441f6d71014d0453ca3ebc884dd4.woff) format("woff"),url(/static/KaTeX_Main-Regular-5c94aef490324b0925dbe5f643e8fd04.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Math;src:url(/static/KaTeX_Math-BoldItalic-d747bd1e7a6a43864285edd73dcde253.woff2) format("woff2"),url(/static/KaTeX_Math-BoldItalic-b13731ef4e2bfc3d8d859271e39550fc.woff) format("woff"),url(/static/KaTeX_Math-BoldItalic-9a2834a9ff8ab411153571e0e55ac693.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Math;src:url(/static/KaTeX_Math-Italic-4ad08b826b8065e1eab85324d726538c.woff2) format("woff2"),url(/static/KaTeX_Math-Italic-f0303906c2a67ac63bf1e8ccd638a89e.woff) format("woff"),url(/static/KaTeX_Math-Italic-291e76b8871b84560701bd29f9d1dcc7.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(/static/KaTeX_SansSerif-Bold-6e0830bee40435e72165345e0682fbfc.woff2) format("woff2"),url(/static/KaTeX_SansSerif-Bold-3fb419559955e3ce75619f1a5e8c6c84.woff) format("woff"),url(/static/KaTeX_SansSerif-Bold-7dc027cba9f7b11ec92af4a311372a85.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:"KaTeX_SansSerif";src:url(/static/KaTeX_SansSerif-Italic-fba01c9c6fb2866a0f95bcacb2c187a5.woff2) format("woff2"),url(/static/KaTeX_SansSerif-Italic-727a9b0d97d72d2fc0228fe4e07fb4d8.woff) format("woff"),url(/static/KaTeX_SansSerif-Italic-4059868e460d2d2e6be18e180d20c43d.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(/static/KaTeX_SansSerif-Regular-d929cd671b19f0cfea55b6200fb47461.woff2) format("woff2"),url(/static/KaTeX_SansSerif-Regular-2555754a67062cac3a0913b715ab982f.woff) format("woff"),url(/static/KaTeX_SansSerif-Regular-5c58d168c0b66d2c32234a6718e74dfb.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Script;src:url(/static/KaTeX_Script-Regular-755e2491f13b5269f0afd5a56f7aa692.woff2) format("woff2"),url(/static/KaTeX_Script-Regular-d524c9a5b62a17f98f4a97af37fea735.woff) format("woff"),url(/static/KaTeX_Script-Regular-d12ea9efb375f9dc331f562e69892638.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size1;src:url(data:font/woff2;base64,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) format("woff2"),url(data:font/woff;base64,d09GRgABAAAAABooAA4AAAAAMnQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAAPSAAAAE4AAABgQ2JZAWNtYXAAAA+YAAAA7QAAAhobTaO1Y3Z0IAAAFnwAAAAKAAAADAAAAABmcGdtAAAQiAAABYwAAAuX1RTb8Gdhc3AAABogAAAACAAAAAgAAAAQZ2x5ZgAAAUQAAAyXAAAYrO5FPkxoZWFkAAAOZAAAADYAAAA2E2h062hoZWEAAA8oAAAAHwAAACQGkwLaaG10eAAADpwAAACMAAAAzHYWCaVsb2NhAAAN/AAAAGgAAABoij+Qfm1heHAAAA3cAAAAIAAAACAA0Ax7bmFtZQAAFogAAALBAAAG50jJ4LVwb3N0AAAZTAAAANMAAAGcu8W4hHByZXAAABYUAAAAaAAAAH/i0Eg6eNrtWAV420q21jkzGskiW7IlOYljx3ZiO3HQWAxs4ZZxy11Ibm4vM0O/9rvpMjNT+xiWmZmZmZmZo74Z2c7zMvN6PkU0+c//n3PmjGYklCqSJL0RXYlIiqQ+j1GQcLJctat2sWrnK49erFTQXf5KBZ4lgfTY4Bz8G9knxSX2nBiByXKz5jSrnptQmB3zxTlfwMfefm2Kac98psZS197+k9fB1DwjVH99cO/gfm/UKWHzMCVxrDzHmuJYLseyBdZQApV8rlBvNBt2rFgo1hrVqufA1G3XmaaK2tOfrqFqmhzyDcE756ki66+FW+DW1+qySuaDd3DEZnAONY4Y5YgR4IjQqFY8l0kKC3El+JSqR0wIjlFm8jP8K9lsmBr5yemIONHTHOPNnNX9OYbCMUDiGHG76ub58eZXPparp88o/eRppZ+zpaGwleBGigWpWOBGfU9CjZtgNDgGwC8UCv8avFgzjQg9TdSoEfnJaeEDLzgnvb9tjYCwVudO54f3ylc+loyUfrK3RO/B+13KWX2M99vD+02EyhRhjLdirc5P/OCtUK81mqLVxFGv1cMb7sVKo1Kt+iJKTGHixJvie6K5Cd8TJ/gYM62hhcGoCkAhPp3RDEoNLTMd57egRotXOYBIGVpMHd2hy8AyhR1G9FjOkUHWd4yqwX8yvX/cyT4tWbxMA5jIWpQyw5RlamU5Zf0As4rJs+nEVJoBsxw0xlPWU5/ASplCD2UD430p9oSnWqlxA50uvbu43lLol2ZFeJU3P+EKvoJ0S5CQk3ATrsJE43EW6sPWvmqGjuLP+d9xzPOLq2RZNlfEGttGVXV0m9ESOrgwmGJA3Ol0ggHITu5Y1Dg+KFQm7k4VBgrZC1yonT3bEppZZRLbIeaqTEfk07LOeL/OLBMpS6QTPezxT2CpvvEBRjOTLZmVDCBBOyrB+R9iEWv4RcnjSs0wj3I0L8hWmw1O3aM+11gsDILPgh9BRIW4szX7IAIeizAKcnAen3STE0PQtJKzCx9DHVMGcp3ILcADOILvlooc2Q19GCamaNVKsyncx7MgTFrR8jlFEXa50blpUx6cWjskR9Zu0Ay9z7Tuss72ekprB2Wt9cTCp1SB+b0UahGuk3iaVpUVp+ueM1h+KxYl9bfQFnzld9S2/D48cD7o1ga/pbZA/6OIQwBJwggebVdNuVU1s3Y1bADlZ5fx6PK/iUPE4hreu4yHpQTnq4d8myKVXTGA7bwthiMfrLBFVnbcWzYWdpplc+eCIS/h7oh+0ySO0qFtRqDCD41tQ3QUR38O0RCIQ9yuSHZXgAncOrcAq9pAezrI94QfBmob5o4VcMFxNUd8Fx6ShkU9bnEUDhU0C2GlUXgd5GcmDLRIMyZoc+InVUr3PGU4Y5JhbfOcBmVjYEyWU0WjrG3YpA0TMzP8FLwgpkTOHUvqchlsOVdXn/98eJSRm2PqSNkILocr1EZWtqEs68ljLT7A+RwO+aQ6CjmdcEjzguwLyw2hVxASDIVoTzCGLgKgzW1uM9jTxXLThq/CFcHlHfvwqOc/X63nOvbPdVPNNkS9P8/ILfh1aZCzSVPORvb8qputVwWZrB3vuuM88vWsm+feIY6xwwpebW2OkeBKWLkmsc0WmbNKw8oTqrRUomUxg+0O9nRuykqZX2FPn9RleUjMuaHlX2GL0/h50z99RcccTAtzAI/o3AjbP2+Oc9hNFlaMg7SK2/4Ct91cqcONbNZPo8+HcejxbM71JN9TIFGttMtulRuXB8RwC0d5bQJr6wn8J/zHsOZrmEh48zPNE+ngW/clsBEYDR75vo9FL5u5ZrVmlqKrreBwcJgwAi88fvzFLwL8Kl7VN93PYM2hRFxBIMEGjLBgLwB1Bo7GsuX/GgFEhVD88JVXwvnzekx47OrgLPkpnz1SIpMVkTkVnhZSU9QIFxgyXhmKvCqE5yYocOJigAAVg0fpS2ueuAGUmMHhYk4Wenf86OtfB5rVdIctv+jW4KUP5N2Xf2pYvb1ruaWHnf+W9FK8XkpyS0rLP7wMxcLKU1+HhXW0UavVH04HZADi2AQAF6NRXH4qRqNaJFturtkwvWFNs5yNSBIKNHh8iDbFa8pArwL4KxCbv8nMx1vXtvNrTGq/ion4unk7LpAhaRPXNZPmurxKe7ZVEq0a2+hqlUbVExU3txJzUXJF704TRPnL/SOpJKiU6DTmx82kYUetWC/t2dKTxqg8MZ0KXxMatb3RhGFqViyhmX7/VG96S9p4eH8ibQABBA2NiFWYfMfL73yL+9CJGAOyftxLtV4jyKpR67/o3i9d+p/aBWPTSXPa7fMkFIrIy0JFD+C+vdfiTBr/WKoG/+K+gZvbb3Vqe471K/6ZkmjM/+M6NvWHBEUiIipysh2Vd0naC97yXyIy5I8YmX/GF27+C4261F8qschK/Toh3Szdh+fV0h3XX3LPyV+VV832ZBauF6axyY9fG1v+z62lE7+0UFEs+v9hjtdEjzxjLjdQFyg1/lnihongVjjKz+dBLEpkasIGX1V798tRmwJoKvzy6MQ11e/qiDozolo7Ut8DAIKj6yeHAOU3jA2ogCxGWKxQ//kYjr12GIkMua3JXDa5P4uUgiZvn5Z/uXdHH3YCI7xvNtfpax3Kz5QTbWdjHQCMnbXxjXFGUxv7yhfEKKN9Wx7kyoq1rfX9opAIfl1Ki1W5WFH7LX+25mPP8YUnW5/qSCSFzcd9QJhFvccz8eyePZh0+MXgpQ8KvszMH/XYjKjkkcR1aFD9wuc1aicdcgIm4WE//ZjidNsT30s9KObkWmgIGo6IazXMAIVhZ3lAxrFYaPqOZxHoWX/5qpEYmp6TxD17zqLlWrpCjUcN7R8GxNc6yTj96YefDpWn3TZKnKRNtc9/IahSW5W1FPzPpd+8EbVuBuOcgQVCcWjKjvHwcwKCTXuxYrfm8BrW28sUkZnkAdG+TATBeMEpOQIRQx0bW9h8UAOMZNI6orXqwM0bplfv1BE+NNDPYB3MqktPNwFA791y5FY1eGXwWtY/cAU8/XJz35oDmdRFc2bwsm5eY5xXbmVF6Ntx3+sMhmbNqYuHITPRQhe1uG/WYv06AYyevrsTv/nAKgvRTAmi2sHtF5YWi4vbBUmCn9X65OBlwcvNI7eZeGDNflNQyfSz4LXBK5XbjmxPalpy+5HbFJiFdcxq77m8iuyT5J/dc3nzD97R2nC5tbVTAmbYp3unxPZ+UAq3Seh9fgWO2LkphTg/ubX0S3FsjlP/XOkHwVvoffh+iwSwSpLgQrG26+CIdR1fSnVWc/PB2XCPKNHJaKj4CULijhvGGbHmOM0G3BjHU6dPn0LbZHjnqVN3okL2OUrwqeCTvH1KcQwF8pBWIQ15xRC4OznuTW1cox0fHhjHSSC28iQeJ7gT44bcAmSmHZogsw7oSvCx4NNq8OngY4rhKJCBAd4ykkTEVzxN87hn+JpqI6+Gd1lXGYwD4bzbqeh1ylm7jLVrYQNqK1nJEivLa5HEQ2JMtWoj3HBkV1Qdy934ynrBgFzh4fOH77lwYP4RhVyu8Ah8wQeeECl7pfu80gGwj97tQQPDzdGb/ttlQaKcHhwrbyzjW/KgJB5y2e6768XFu84/vJDPc4i7Li4cnH94cOA/PuuA7L/+YdpG7X4XXppkevpZdwwMD4wO53MjI5Ikd2kbkWrSeq4vOmvMzTTqE+PD2TjIv1mkH1Zs3pRsvJAv2tmwKNhZ0d3zoZm1eadfK/LrQPCSo4/yAG640lBluAG8R+57S/BAsLbWHrof3grBA+VHvunXCX3Di0Gbu/L5MlxDROfnX7nmp++HG+Rbj83u0eAqmUPZ7/hZtWPSGmmbdFio3b9jw/rKb6tWbs9gYh1dLECjWSgq7ehCscbCN2Lyq/GXxfYuYVgYfq0HYJMI8kW7raUzZ5aso0H6zNLSmcgmE8DchI+N5GdynXsr+O6ZdVt4n+sTk4nrj1q/zismyPY6TUBpG5YvFdDmkRt5Jtx4BL6ngwDtPLkheNrS2i1ntI0morlRk7Cr1h3k3/vbmznA37XexWvNamsLsSp86VZbDs3nxV/uVOHSuvDtb1kYz2VukRWVOT2afCtLetpsE4gfs3wCzVnN+x3LZtDotVdPa7rMSFybXk2NvqTOVq8hVjxukTWrmd5V7/vErpOYCWWmZDnrWKhJiLazdqx9SSK6u3x1UkEkmhYTE80IRjJZBT/UJ6suI09lFtPSLNgSbIEXwgtZP7+eEKtW/oNRafFnd8Km6lW3yo/F1u+37weS+C3ytlJ9RR/x7v8AozlAwgAAAQAAADMA0gAFAAAAAAACAAAAEAB3AAAAIAuXAAAAAAAAABYAFgAWABYAPABlAIcAmwC+ANIBSgG/Ab8B7AItAloCmwKyAtsDBANMA5MD0AQOBGkEngTFBQoFcwY+B2oIMAhoCKkI9QlBCVMJZQl3CYkJmQnFCfEKXwrWC2sL7QwgDDQMSAxWAAEAAAABAAC6weBlXw889QALA+gAAAAA2LKZCQAAAADYspkJ/cz+ogUYA1IAAAAIAAIAAAAAAAB42lXKIQjCQBSH8e+9La2zLFgvadgZtZgumwWLSXvPwpqwZC/2ng6rYE/2JAdD3w0nGH78Hx+PxAxAApBAImcz1RWNXIjfrXXNPiOBuvdLHQL9Dfp7UYloxzErKhaDK01WTvDFk4MEWnW08rA+t36iGe7ln9yiqcfVTrzt1oRygx/9/h1k7OADRvspE3jaY2BkYGAO+reIIYql7++Z/2WsEkARVGAMAJ6LBnIAeNpjYGJqYZzAwMrAwNTFtIeBgaEHQjM+YDBkZGJAAg0MDO8FGN68hfED0lxTGBwYFN7/Z1b4b8EQxRzEGKfAwNAfxwzXosDACAASxQ/yAAB42mNgYGCGYhkGRgYgYBQB8hjBfBaGH0DaikEByJICkpoM+gyxDNUMtQwLmI4x3WFmVhBTnKg4WfGi4mUlQSUpJWUlVSU9pcPK3MoX1F9qMWmxaLG9////PwMDUK8GUG80kl4mJL38UL3aSgeUOYB6X2gxgPX+BWp+/P/O/+v/1/zv/9/3P+ev+1+jv7z3f99rvNdwz/me0z32u//vfr/77e7Huwl3Ze5E3HC8pn1N65qmgDHQBxQARjYghrGZgAQTugJQkEEACyuYYiPBeHYOTrzyXAzcZDtdQoxBBsaWhFA8JGjn5YOxANbHSYoAAAB42qxV5ZrjyA4th5phGHxBnpr07ZuUPcxsx8nwNH6fa9Fu+r28+wx+GjnL//bR9shJc/dyQ1SlUklHR1KFlSFWq0lsiV79pKYXX3Fj+b2Eb7o8b9MtylcTrjSzn0fVqFpf12uu57GyrCLd6StHRWnos2OY0i2fK4Y2iH9Z4Nrce/15ZzyK1+Ol9xNPe26eEC8sJB4/tS7xXVndtZaKgVG2wfNQDXfEV+X8KizhLCGAyDPi8YUkhYbkbFxWt2V1O3VTa63LTttazWoh2bTW56oh+Kk1MwCqRwsJ13XIDR0CvmUn9blmNHDRRlFfC0lOBsHlk1Uar3O15UEfUU45fBdX602ktZikC262ZBNtcfp0OcGRi6S2I/tcNzwStfuqMqCmga0ONbHSYcaVtS121hGf6y2fRwwJyIlo/aeaWiPxwE9TKyZppwQ5avojEyqKw5a3Q/aY2U/+eOkFODT0yDilONcZbQyZUq6wyeQC5DZKrjZ11hmEmDjmOl/GLYVbR12aNGVC/Ynxapx4rvZsy/N5yhSVSswbWcfnaQNDIp6MXsp1LHRoeUp2S9hNYefzDNzMlpQQGFhHXJ6OUspT4mmQ5vOsebWSFLWNjr3MU5v6G59PmFeLyavlgdL1oD9V6k+aQs1Eq0kxMxOxk4U805YmReuGxaR8TOGDnbOakMdCUgh5yDbMcyrDtjyNa9trd3COK/gvNRaZ9IC/B+3+Uh1TwEKpUxpsRawe9x3HKWt1yqhCVeKVhGd0SDFP6JDHwW8aUorw38/OOmpahWGeFicbbf6y7V4CTaeR26m2z2dM4Yg8C55FnjNFVeR5U9REXjBFXeRFUzREuqYYEfkvU4yK/LcpxkT+31DAzoc+t8rFpz63y8VnPv/HKJ5q/wWM/wXG/8A3AaNIDxhFXgJGkRoYRV4GRpFNYBQ5B4wi/weMIueBUaQx9LBsNd8g7GxKkcY2knJAspF+Cwz7bfYxSVcMUY+OqYTO7mp5xn7TAq3k89Wd8jhn+UqrqDtn4uSqLRO8VjJz7PF1Q7dKvDdg58SHg2DCEPxovTr7nZKfzmN9t7junEFGN5E/9Y7ByyrK7vp8ywTnHvp8+/dM2YnWYX4HJVFnmxRQj5WWzn6R5z3d0xkla8ifHUz0bcc5cxrx7xqgwoDgrzThsai9mQea6GEOX/d2jykY+OCaDsWKOJV5f7qYfFuhKrnfVuaqF20ob+BoRLkurXUX04dqHkBLYGPw2FeidENzNco2FhJsMhfrVN6gg3cyTQg9p7uooUaELvKCKKOkdFQQLVE0TlJIrqOh6oe8wqNk1CxB4HNh8MrtxkLJ7wsHBE19bsiBfghqHogaueoQZ13dk2BSrYeiLxMYMqpWkoAeas+FZlsJZ7uUN5rYvdj77Tso1FEdPKyMljZ+NEQQbZcmla/ngylul/Kx0RQIa108zA9tUATOaQzgkx31wl710/3WR9o8M3y3faTT0PC9do7A0ixAe9gGZQk4gGm002Fgd6cFNVo90HeH7jp4NPCG/4VW7P1T3Sfws7uApfGE7Km3Z4cYYyFjO/+u5O/pIQH67v6Ue0j5zGA4+0rm8FTANzGLz4/RvzCFck6f4ltYvzR8B+KVsBaDV+rmQPFrj/WAHEEABFA0xj1STOcCsb22OWv7WIMLbv9R8XXVH9Pf7L9wO5p/yojY+p5RRBWHICb24QGIKw5BguZDkaQBKRqQpgEZmhdFlgbkaECeBhRo3hRFGlCiAWUaUKH5VFRpQI0G1GlAg+ZV0aQBLRrQpgGGmLfhae4wmI+qrqsnVY8zw/CsQ1/Mu7AeMLj1ELn1CLnpWMz7MJ0wuOkUuekMuelczIcwXTC46RK56Qq56Vqcy5Oj4Ofp9dq8MMzjq/gu+Kbc7AERbE1geNpj8N7BcCIoYiMjY1/kBsadHAwcDMkFGxnYnDYyMGhBaA4UeicDAwMnMouZwWWjCmNHYMQGh46IjcwpLhvVQLxdHA0MjCwOHckhESAlkUCwkYFHawfj/9YNLL0bmYC6WFNcAJhIJBt42mNAAgAADAABAAB42kzMtYFCYRAE4PntDncPsQYgxiF/ORFWChWgIW4VUAp1kOODbPStDYCI8EDgVRZACzhh0RL/aNIKKbRpjSD6tIEbU/rvZ+4WOaxpDxLiRPt+8v3PfAWh7QDm4kwLROSQlvDIA63QkEdaIyuvtEFCZei/n7lb9lSR9iBvVrTvJ9//yK/eWqOi1tSZIHqe8yvmsUJcE/GhlVKQrwiiVFpL6VvZrlOzbYwhu5q2v/6brl4xpXK9l8uy2cPJmXNmZ1flR2UXmacz06Jukly0u0ma0DU7uyhoZiwXhmMaFUZF38Vp70t8TuNMFzQwes7Lj7G+58enmf3k9I4X61xXw1Xhh6tqwdRVCfXpQNHeSX6gHrhydlVQohLVO9Jl/GObdHZZ17Vaap+96nclyVetk1rfFb4JpbfMtjiOauszumPH1Ybn9HUhutFLPryKiqL7zLrtz9nqxde6YhIit4YLJ2XrYs4V+YxpNprQtORiK55sBTH9unKqxE3M9rWkN9rm+jlnCp1oGg5uSft+lHlf9jsdZypbeqeczb9a7kyHk+N/8B9WKPGBChYLZPAgnMGgJWcXiawLtANKZROuwXBBW4AwgxHMgo18Y2FGAStEv3VO0ds7nws3Fo0OrgMYQXMwllI/Fnwv+BFPkmfxKTjFHVhc18ihJWEoWQV8OCvhOWSo0HEfdMSj3XQ5UfUAlq+DDZkkGSrs3h/OMj59msHnEnVYCktoePF/lfMdanfnK7T+4dSbiW87lT7UNJJjRKK0oS8KE3NhThuw6Gn/QoQbaKnmo6+ixCkSPhPGNSpngl4E1eEdxGGnyOU0YW5ul7YWPA/5FDriUD3CRM4pyqA9dJ40HGLQ91cOfcludNbMJWhsZFvhNZ7lK9zBTHRIHOA2YI8+IuG9rFJwR5aDCe9WwgtWIT3fT7mDqdRP/qbmf7W5WNkAAAB42mzBQQEBUQAA0Zm/AAAAgAicoQh0UQJcdaIMcN73CPy9j8yJswAkEJGnQI0VazbsOBh48DQyYdKUaTNmuZjjzN28BW4WLVm2YtWadRs2bdm2Y9eefQcOHTl24tTZp2a5NmAgimEA2oWHMQS74znCzDj+JyvVM0jtz/VAlFNSSbrvw3m9Wd0uy3gR4nF78Xzefp97N7m+/a49m5bnz33wH+M9NYTJFIUjWMIK1mZJkKFA6ytN4QzmsDArSk7qKbRcTgQZChzCcbRumgrWsPFEcFtwAAABAAH//wAP) format("woff"),url(/static/KaTeX_Size1-Regular-7342d45b052c3a2abc21049959fbab7f.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size2;src:url(data:font/woff2;base64,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) format("woff2"),url(data:font/woff;base64,d09GRgABAAAAABkkAA4AAAAAL4wAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAAOlAAAAE4AAABgRWJbumNtYXAAAA7kAAAAyQAAAdqK1xeEY3Z0IAAAFaQAAAAKAAAADAAAAABmcGdtAAAPsAAABYwAAAuX1RTb8Gdhc3AAABkcAAAACAAAAAgAAAAQZ2x5ZgAAAUQAAAwCAAAWjK6904RoZWFkAAANwAAAADYAAAA2FFN06WhoZWEAAA50AAAAHwAAACQJfAGCaG10eAAADfgAAAB5AAAArH3JAgZsb2NhAAANaAAAAFgAAABYadFve21heHAAAA1IAAAAIAAAACAAyAxmbmFtZQAAFbAAAAK/AAAG50rK5LZwb3N0AAAYcAAAAKkAAAFCunBaJXByZXAAABU8AAAAaAAAAH/i0Eg6eNrlWAVg21gS1fwvsGXLtmxBwLEMiexwYll2aZOmFGjKzHhQ5i6Wl5nhmJnTHDMzM/My826s3khO2vSY73Y34tHov5k3k/l/zBAmzzDMF4nKUEZgfMM8CwzpaLZkS85aciZ/6+Z8nqjle/PwXgaYk+VzSSd7mIkz/FCQQEczKELGNLOmXShFS5amKgIv8JRXFT2qa6STj7/49sZCYfF34ryUSL4z5fOZv5fKRym/7NlbP/LLX3wMrGGesqFU7h7nmjkHDs5xFj4VYhAnUz4XXoM4CcSRXJxYoWhZmqa7CETIpE27WCrGinYhS7IIn/FJ0iiSFBIg+HvT50u9M5kIsnt9rIv1q59/zPnaMOuD0FPwrjkHD8yBffc0Jj2sCejTI4glIRbPuFjoDVMqut4wAj9XI9dQKmvlfZSiphbgf0BFoolP56iIX/8SLf0Cfi3g1+B9LVtqBo9f3nkS2RIE6+l1FuqVRlFCqOcHj7lMOmsyWbNo5XWNIY/oEQTYBxAOBHlKrilfVyWy/I+5QFikTzfiCJHyucyTo0gUXCQbA4RH5M47T7KzraeetvjXot65iJRBvXmo1+AhIV8uSWY7Mb1roVjCrZsUXBLdA521dFXh3eCFiaLixT0EQdd0xT1UHc+4aSrJ8JIUHDJYACCckN4isqy4JS1wBIAFdXXzZF8gxFOfafSGUURB32bxYvDlCbwFEu41TB8tH+LZ7v1y0zceCVSFl1hUqPJRa0m4OvBw/cSXhyjMmVitET4kcTSs53vFh5u6rw0BLJ9WTSnfdRAgdG1300OB3rweppw0zuMB9Lh+LFvyFYtVZczyinvomVK5uklU6CKlIrof9c6lUrZCUOXURs/lwpLU1bYgxoFgN9t+Sv3JmmUB4GIL2rokKcSzbJAtzBeBQLCtubE94N/bGvO71IA4v4DvWHZrmOM0o9SvPXS3MKPUXMVyQYljw0rPSuHuh7T+kqFxfMjvpyzRF1hB+JGU7zESMZbt7I0n5aavPyJYC3TCUj/DwKlniU3voyyjoZ8+Fv2keTSb1RU+49qbTQs8xixtcvDDZxrgMS5ADOPIxMfpoxOPGAYJkFV9i6W3AM34fenw9OnhtM+fQfYYsoneSR5g2nFUXXbzxcprHmdW3k0NpEXTdRzayyLcMojjISGkqwAdcm5mtmV1R9CcO/+cDsoTQjlf/bLL5rR3xu217WeL50/pIfcHguEUT+rUKjcrfP5ItLlVEmJni3KKysBIjNgMO95n+PM+j8T+Aadx3Cqy6dSpf8Xrct9/zmtmgtPFfo6+n2lA65Ke15plqSkbbSvJKTk27sl0bcvYKRUNZNOxS0UnIh6qoU4ATt8HqqvNksheI57QnC8tKRYH/ewHym8ov7FyuymeCISLxcXMONws4kYruH8eicqpP0V+dt8ZNHgI0QAeH/fkYo8HRBPewH5wHHrJ6eK2I/pkRM95Fa6YSukJomOoK1tDSmd0TQDFSpaK3mZhRLikNwG5QWOyBTQLsoUplKwkKydJyTDNCWhhbvdXO51vOT/1wTcIQPmh78Bb01cM3LRIVXJ0yqTym8tvwlBl0pf2gAjTbpjoPAH0JLnMGExzoUZEnSFRCJQv4wlbfhMQIVq/sbaVf8PLgRCBsNncHf3QTmDFF+bCjrAbv13lg3QEK1Lt2JwCed2dTDIZdIJ6SeSWm1gNlh96t0zKv44KcpBw9mvD0aQ/Wp2rL3xzsfPaIM8ejrJPD5YETvkoaYmqWV800dk0pdwGAjXhVFp0WRt5HX0PN5/pQixbcVlTBDeNNY+faKyLloqY27pSqXhY405nM26EjhXDbMFVe7NN2FiNFLLsePPKSzW9zTJShtVF6+J60qZUpOEoR5KpVC5Rvf5oUmtoaZ3a2k0StXqyXNscolQByXrm+FMkSqoXL7xkgVY1rbMulaxqDrHUR0Twr1r5lRtfXv5J2Tkyffek7hkd8VSSIa4P3Cc9Hw7hGmT/Ilsh/6If3P+GBBL57/NX9c/yTl3ehY+O8v5RRvzA0I0u9/Rf5/6FFDgYeW7E/F/PFa/OLGBezBzEXNm1ZePSvsQf5Uqs0gtgJbZKUVfwV6JHK8t5nhcyAjkrjNBFSq4Wytzlm57HARsKWV4IEcHCBxz1TKTbOuY0tLUld0wX/UubWq2sRX1/lvuOQbOtzdiJagtbW60z0fMJNTHC1be09QR5XpmrAaHV0HbEX+3K2WDV9DUSGRenb0O7OXn6ogWzOqfyLXD08lumFfzwpwRe5/zcnDRrwaLpnT18i3Pry2+ZUSGSvsM4uorTtPl5faq+zJJC8sXNl/bVX5c4vorjIy/ui1TmQdag7/dmD6XSZXnLEGCEUR6LTKnSNugaa8SVRIh1tjvbqJRQ6oDCZ0jQiIcIfI6AsyuWqOXZ657dxdbWKQLr5zS2uoo+8zuBMn8OaXTlDN74XnQQc7RRKdWqhsTDjXAbhOuUOBBnMpHidWHinEOBXhwzaoLPHmRvJjWJmECFZ35Hq2oop4r0NM4w04Y4YW8+rKzP3T0WwUBj5E05gukxGnb5tNDLIuLTCsEbdg9sCHEAQOPpWhZA/O0b+mftvMoHwNam4xQAqq4/SochsqT0qhV1i5yjzkRW1jWZhY/CJ8QbvleTO7lbdHqcGays6Sj9Anwx8Jlzt1R46PZ46DjdQRRd//HjCFo4mnJyBC+ekIx1EGO9Ao1MILVROV6xamDWjvFWBbKzb9p2boux9JWT1qtoP70u4lrlzHB6xqyCT8BHXasinDPRmRBYOXhdv8UFF3VvvaxuERyFLzCjneYpXFNwZzrNFHaavwTjvkqf2cJUukRod7XOdIkpOSNHwLC8HpH/7l8Yy3J7Vssb6ukW68+OhDope8RyflV+G/9dbDfdkXZj7xVArRrUUnnUKtmxaMljT1Cpu16OxVTNo4ruft8ranm/GAzBUG6dpg0NQVgMB2pf8VgI3g37Zwb8YVFw5m38bbHozHHmC4GwMhP2I8ZStMTtnXXECHrWpk2EiRUIGW2fEYNiUHaLERgaet8QgVAgIsAHhoc/AEL53IgowHtgCOAdcFIQZQmcXmd2yBlwekFiGIqr3m7uXZiddcwUZgAr28zuNkMGilk6ro2shBzdqK9UuFKRO13J3CZzXOdQtAtoGOC/ktd2Ztw8Jq9ItE0OnNj60x0D5tSbX/nF+t2ZIefuQXy45dWwLGC1a++99KLJiXl9j706WpeI7tzw4lc1tbzx8LnOnXau3rKyqXYfwfILofxLfnzzG/fv/vCFJ2o4ruobt1YeLpkFrL532xtWr3/1NRe9PkSI2Nr+pq279r0Z5MHe8nDOIvlsLp+tCzIMN87fRmYi08ssYcJTg4P9kye1tRoJGbi/5XhMzqCEuH6nwMxk5VTStk0Td/QaH1QV/faaKSikUnKFFNz+GgcPkRbzfSMGBzG4IcryEMMNpIs2HXPudO537nfvN1/yDnKt+8BvW4PsVAe5v0ZI+SaSZf0556lPJIJA6gmUfwSE+OihH81e9+xLSHbsYbNMGtx3YgsS1t2bOIufdqabmc9sdvlZu7i355x8k/F38IOJUckMFeeuUqngVu5sRaB4HWYRTGRQYHQvYWxUoJpp6mlGVbxBK3n0t1ImFvS9+ZLGZds+/elPNx53fuU4x/lcUm2ZJ9ZUscdp3A/Lt34ayKiwegf/hS9y4BwqRM6/LToleuuFEeuv5xNI6+Pschz9M2x8dflDwB6bUrB27XvVNbH6zDFyKIivnJExWfPIL/gvfZF3LgJiinMw/0JzRJNhyLjKuhlX9nOsekL+ieoKox+oqsu7Szq+RpZVZUzRtjNp784ueD9n2YV/oCLDZ9lqT3fLdhrRayVDsNQtwIXjdSEOtqiWYEi1eoRu3/JPlG7nNe4n+C3QWtmQBNi6NO6vqfHHl24FQTLkWoqo4+fi4p/MQXJqjBw1TrQ4yyuKqqLjqQYza08h5hS2WCjYE0Z9oPXopzdBCgbn2E4x4Ts955SvLF9FDpCDaLAmK0rvmvMO3XDpDYfOW9OrKIaAxNSeLXQjiH/Qwmwe/X2Yq/w+3GlbqoXH5srf368Hrh5qod7Y3OPquO/+AMfzgJUAAAABAAAAKwC9AAUAAAAAAAIAAAAQAHcAAAAgC5cAAAAAAAAAFgAWABYAFgBKAIAAnwCzANQA6AFhAdUB1QIAAk8CewLKAwYDRQOqA+AEQgT+BhQGyQb+BzIHggfUB+cH+ggMCB8IUQiBCPkJiQovCsQLEAskCzgLRgABAAAAAQAAf0Tz9V8PPPUACwPoAAAAANiymQkAAAAA2LKZCfwT/KIHvAVQAAAACAACAAAAAAAAeNpVyjEOAUEUxvH/zOyqJ9HolbbSvClcQYkD0NM5jNYRHEa5nT0Dgu9JRqL45f/y8nFnDhCWoJu44iLTNKOEK71qao4njs43aXg/0gDwHMukeVFce8b038cOaxbYqGDfe/MvZnrJv245yLq9Uaq6DR04dvABg04iLgAAAHjaY2BkYGAN+LOIIYrN4o/wvxr2PUARVKANAJIcBgUAeNpjYGK2Z5zAwMrAwNTFtIeBgaEHQjM+YDBkZGJAAg0MDO8FGN68hfED0lxTGBwYFN7/Z1b4b8EQxRrAHKfAwNAfxwzXosDACAD6LQ+wAAB42mNgYGCGYhkGRgYQuALkMYL5LAw7gLQWgwKQxQUkNRn0GWIZqhlqGRYwHWO6w8ysJKgkpaSndFiZW/2lFpMWixbb+////zMwANVqANVGI6llUuIHqtVWOqDMof5CiwGs9i9Q8eP/d/5f/7/mf///vv85f93/Gv3lvcd099fdV3cj74resLymfE3pmqKANtBFJABGNiCGsZmABBO6ApCXIYCFFUyxkWA8OwcnXnkuBm4GcoGwIIMojC0CoXhI0M7LB2MBAO5wM9cAAAB42qxV5ZrjyA4th5phGHxBnpr07ZuUPcxsx8nwNH6fa9Fu+r28+wx+GjnL//bR9shJc/dyQ1SlUklHR1KFlSFWq0lsiV79pKYXX3Fj+b2Eb7o8b9MtylcTrjSzn0fVqFpf12uu57GyrCLd6StHRWnos2OY0i2fK4Y2iH9Z4Nrce/15ZzyK1+Ol9xNPe26eEC8sJB4/tS7xXVndtZaKgVG2wfNQDXfEV+X8KizhLCGAyDPi8YUkhYbkbFxWt2V1O3VTa63LTttazWoh2bTW56oh+Kk1MwCqRwsJ13XIDR0CvmUn9blmNHDRRlFfC0lOBsHlk1Uar3O15UEfUU45fBdX602ktZikC262ZBNtcfp0OcGRi6S2I/tcNzwStfuqMqCmga0ONbHSYcaVtS121hGf6y2fRwwJyIlo/aeaWiPxwE9TKyZppwQ5avojEyqKw5a3Q/aY2U/+eOkFODT0yDilONcZbQyZUq6wyeQC5DZKrjZ11hmEmDjmOl/GLYVbR12aNGVC/Ynxapx4rvZsy/N5yhSVSswbWcfnaQNDIp6MXsp1LHRoeUp2S9hNYefzDNzMlpQQGFhHXJ6OUspT4mmQ5vOsebWSFLWNjr3MU5v6G59PmFeLyavlgdL1oD9V6k+aQs1Eq0kxMxOxk4U805YmReuGxaR8TOGDnbOakMdCUgh5yDbMcyrDtjyNa9trd3COK/gvNRaZ9IC/B+3+Uh1TwEKpUxpsRawe9x3HKWt1yqhCVeKVhGd0SDFP6JDHwW8aUorw38/OOmpahWGeFicbbf6y7V4CTaeR26m2z2dM4Yg8C55FnjNFVeR5U9REXjBFXeRFUzREuqYYEfkvU4yK/LcpxkT+31DAzoc+t8rFpz63y8VnPv/HKJ5q/wWM/wXG/8A3AaNIDxhFXgJGkRoYRV4GRpFNYBQ5B4wi/weMIueBUaQx9LBsNd8g7GxKkcY2knJAspF+Cwz7bfYxSVcMUY+OqYTO7mp5xn7TAq3k89Wd8jhn+UqrqDtn4uSqLRO8VjJz7PF1Q7dKvDdg58SHg2DCEPxovTr7nZKfzmN9t7junEFGN5E/9Y7ByyrK7vp8ywTnHvp8+/dM2YnWYX4HJVFnmxRQj5WWzn6R5z3d0xkla8ifHUz0bcc5cxrx7xqgwoDgrzThsai9mQea6GEOX/d2jykY+OCaDsWKOJV5f7qYfFuhKrnfVuaqF20ob+BoRLkurXUX04dqHkBLYGPw2FeidENzNco2FhJsMhfrVN6gg3cyTQg9p7uooUaELvKCKKOkdFQQLVE0TlJIrqOh6oe8wqNk1CxB4HNh8MrtxkLJ7wsHBE19bsiBfghqHogaueoQZ13dk2BSrYeiLxMYMqpWkoAeas+FZlsJZ7uUN5rYvdj77Tso1FEdPKyMljZ+NEQQbZcmla/ngylul/Kx0RQIa108zA9tUATOaQzgkx31wl710/3WR9o8M3y3faTT0PC9do7A0ixAe9gGZQk4gGm002Fgd6cFNVo90HeH7jp4NPCG/4VW7P1T3Sfws7uApfGE7Km3Z4cYYyFjO/+u5O/pIQH67v6Ue0j5zGA4+0rm8FTANzGLz4/RvzCFck6f4ltYvzR8B+KVsBaDV+rmQPFrj/WAHEEABFA0xj1STOcCsb22OWv7WIMLbv9R8XXVH9Pf7L9wO5p/yojY+p5RRBWHICb24QGIKw5BguZDkaQBKRqQpgEZmhdFlgbkaECeBhRo3hRFGlCiAWUaUKH5VFRpQI0G1GlAg+ZV0aQBLRrQpgGGmLfhae4wmI+qrqsnVY8zw/CsQ1/Mu7AeMLj1ELn1CLnpWMz7MJ0wuOkUuekMuelczIcwXTC46RK56Qq56Vqcy5Oj4Ofp9dq8MMzjq/gu+Kbc7AERbE1geNpj8N7BcCIoYiMjY1/kBsadHAwcDMkFGxnYnDYyMGhBaA4UeicDAwMnMouZwWWjCmNHYMQGh46IjcwpLhvVQLxdHA0MjCwOHckhESAlkUCwkYFHawfj/9YNLL0bmYC6WFNcAJhIJBt42mNAAgAADAABAAB42kzMtYFCYRAE4PntDncPsQYgxiF/ORFWChWgIW4VUAp1kOODbPStDYCI8EDgVRZACzhh0RL/aNIKKbRpjSD6tIEbU/rvZ+4WOaxpDxLiRPt+8v3PfAWh7QDm4kwLROSQlvDIA63QkEdaIyuvtEFCZei/n7lb9lSR9iBvVrTvJ9//yK/eWqOK5ciBGPrO/grdljxtWA4zM99SHY8y7sRUdg9+/SodpuUyvZIftKSyGtamk1p6m7yjOAy/t+IwCmmBG9MpaD8xXCTs02qRKO8pOfp0Rf5G66kuaDbRbc6H6/qAT073zYjjPe50M10vlYVdKusOU6xCGqMHjNYN5YXSEdeNKQsKVag+vXJK/8Vj0tuJfr+vcm3TCz1Qkjz17reOfiO8lJK+rlyLfa9vbEp73HDd4zZdNURbOueHrSjPO0hNc/1zvzy3fV0zSSEzCReNyLpFm2uyKdP+6gZtV1xckzeuCT7dthypSInZvZZ0T5tMn2VM7iSalmZ3SdsxL7W2GguCJqlNZRvVmOzqyMH20sbrfzCPEhWGqGHQQQoLwlskeCffGKFc39FyKJKHsABG47gFCPtIBLPgRN6+VFYdVvB+6Rzh053zN6mtC0c711kkgtpg5KJfF3wg+ASnkmcwEhxjDyyuXWTQkrAkWQWs+9ZSZ5eh3InHQK94tB67/CbrCCxvmYHLJMlQ7vn0h7P0f3+azmcCfXcp5NCw4n8h3wHUTc9TePcfp/448fKGpR9yHiX78IRp3LnITaxxc+qBhU93GyJsQYuaX92KEidP6qlUmkfKfUHngvpuD+Jww8jkm7i5NTdpXcFtl0/uROzUq9iQ7zYqx33ovPHIwQc923IE5R53shdzCRo9eYzUNc7kLbUHM9EucRa7DluMwZO6lasSHMjVIHF7q2AFK5ee3U05wLboN/5G8wPUoVjhAHjabME3AYMAAADB//Teu4Vs2ZNghOIFE7QVT6AGDHDHCAC6lA9D3oCMGLNmw4kffwIiEkc0tI6dUDglp6Zy5tyFS1eu3bh1596DR0+evXj15t2HT1/zviW5NkAAhoIAWrPNF7SL74G7w/zRq97J/3EmstRVksnvfNvtt8/7pi0iTEPxMMA49AQZCtSu0hKuoIWuu4hLOH5LBBkKnMJ5M6YUYISpAMYdQXoAAAAAAQAB//8ADw==) format("woff"),url(/static/KaTeX_Size2-Regular-eb130dcc661de766c999c60ba1525a88.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size3;src:url(data:font/woff2;base64,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) format("woff2"),url(data:font/woff;base64,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) format("woff"),url(data:font/ttf;base64,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ZQBYAF8AUwBpAHoAZQAzAC0AUgBlAGcAdQBsAGEAcgBWAGUAcgBzAGkAbwBuACAAMAAuADAALgA0AEMAbwBwAHkAcgBpAGcAaAB0ACAAKABjACkAIAAyADAAMAA5AC0AMgAwADEAMAAsACAARABlAHMAaQBnAG4AIABTAGMAaQBlAG4AYwBlACwAIABJAG4AYwAuACAAKAA8AHcAdwB3AC4AbQBhAHQAaABqAGEAeAAuAG8AcgBnAD4AKQAKAEMAbwBwAHkAcgBpAGcAaAB0ACAAKABjACkAIAAyADAAMQA0AC0AMgAwADEAOAAgAEsAaABhAG4AIABBAGMAYQBkAGUAbQB5ACAAKAA8AHcAdwB3AC4AawBoAGEAbgBhAGMAYQBkAGUAbQB5AC4AbwByAGcAPgApACwACgB3AGkAdABoACAAUgBlAHMAZQByAHYAZQBkACAARgBvAG4AdAAgAE4AYQBtAGUAIABLAGEAVABlAFgAXwBTAGkAegBlADMALgAKAAoAVABoAGkAcwAgAEYAbwBuAHQAIABTAG8AZgB0AHcAYQByAGUAIABpAHMAIABsAGkAYwBlAG4AcwBlAGQAIAB1AG4AZABlAHIAIAB0AGgAZQAgAFMASQBMACAATwBwAGUAbgAgAEYAbwBuAHQAIABMAGkAYwBlAG4AcwBlACwAIABWAGUAcgBzAGkAbwBuACAAMQAuADEALgAKAFQAaABpAHMAIABsAGkAYwBlAG4AcwBlACAAYQB2AGEAaQBsAGEAYgBsAGUAIAB3AGkAdABoACAAYQAgAEYAQQBRACAAYQB0ADoACgBoAHQAdABwADoALwAvAHMAYwByAGkAcAB0AHMALgBzAGkAbAAuAG8AcgBnAC8ATwBGAEwAaAB0AHQAcAA6AC8ALwBzAGMAcgBpAHAAdABzAC4AcwBpAGwALgBvAHIAZwAvAE8ARgBMAAACAAAAAAAA/4MAMgAAAAAAAAAAAAAAAAAAAAAAAAAAABsAAAABAAIAAwALAAwAEgA+AD8AQABeAGABAgDYANkBAwEEAKUBBQEGAQcBCAEJAQoBCwEMAQ0HdW5pMDBBMAd1bmkwMzAyCXRpbGRlY29tYgd1bmkyMzA4B3VuaTIzMDkHdW5pMjMwQQd1bmkyMzBCB3VuaTI3RTgHdW5pMjdFOQd1bmlFRkZEB3VuaUVGRkUHdW5pRUZGRgAAAAEAAf//AA8=) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size4;src:url(data:font/woff2;base64,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) format("woff2"),url(data:font/woff;base64,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) format("woff"),url(/static/KaTeX_Size4-Regular-ad7672524b64b730dfd176140a8945cb.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Typewriter;src:url(/static/KaTeX_Typewriter-Regular-6cc31ea5c223c88705a13727a71417fa.woff2) format("woff2"),url(/static/KaTeX_Typewriter-Regular-3fe216d2a5f736c560cde71984554b64.woff) format("woff"),url(/static/KaTeX_Typewriter-Regular-257023560753aeb0b89b7e434d3da17f.ttf) format("truetype");font-weight:400;font-style:normal}.katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto}.katex *{-ms-high-contrast-adjust:none!important}.katex .katex-version:after{content:"0.10.2"}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathdefault{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-weight:700;font-style:italic}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;vertical-align:bottom;position:relative}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;vertical-align:bottom;font-size:1px;width:2px;min-width:2px}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{display:inline-block;width:100%;border-bottom-style:solid}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{width:0;position:relative}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{display:inline-block;border:0 solid;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{display:inline-block;width:100%;border-bottom-style:solid}.katex .hdashline{display:inline-block;width:100%;border-bottom-style:dashed}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer,.katex .sizing{display:inline-block}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;margin:0 -.025em;border-right:.05em solid;min-width:1px}.katex .mtable .vs-dashed{border-right:.05em dashed}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{display:block;position:absolute;width:100%;height:inherit;fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1}.katex svg path{stroke:none}.katex img{border-style:none;min-width:0;min-height:0;max-width:none;max-height:none}.katex .stretchy{width:100%;display:block;position:relative;overflow:hidden}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{width:100%;position:relative;overflow:hidden}.katex .halfarrow-left{position:absolute;left:0;width:50.2%;overflow:hidden}.katex .halfarrow-right{position:absolute;right:0;width:50.2%;overflow:hidden}.katex .brace-left{position:absolute;left:0;width:25.1%;overflow:hidden}.katex .brace-center{position:absolute;left:25%;width:50%;overflow:hidden}.katex .brace-right{position:absolute;right:0;width:25.1%;overflow:hidden}.katex .x-arrow-pad{padding:0 .5em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{box-sizing:border-box;border:.04em solid}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{text-align:left}h2 a{color:#000;text-decoration:none}h1.notfound{font-size:100px}h1.notfound,h3.notfound{display:table;margin:auto;vertical-align:middle}h3.notfound{font:40px Fira Sans,sans-serif;color:silver}</style><link href="//fonts.googleapis.com/css?family=Playfair+Display:700|Fira+Sans:400,400i,700,700i" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/styles-b3b9a98f1384a6f8783d.js"/><meta name="generator" content="Gatsby 2.13.31"/><link as="script" rel="preload" href="/2-4f864fc2dd9dc731be34.js"/><link as="script" rel="preload" href="/0-e2dc2f855e44dc3424e8.js"/><link as="script" rel="preload" href="/app-e224b96ae8eed8904dc4.js"/><link as="script" rel="preload" href="/webpack-runtime-06fcd653e46f731a33d8.js"/><link as="fetch" rel="preload" href="/page-data\6.828-lab4\page-data.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="1mnrsyi">.css-1mnrsyi{margin:0 auto;max-width:900px;padding:2.88rem;padding-top:2.16rem;}</style><div class="css-1mnrsyi"><a href="/"><style data-emotion-css="i0b9uu">.css-i0b9uu{margin-bottom:2.88rem;display:inline-block;font-style:normal;}</style><h3 class="css-i0b9uu">Zilin&#x27;s Blog</h3></a><style data-emotion-css="146q31f">.css-146q31f{float:right;}</style><a class="css-146q31f" href="/about/">about</a><div><h1>6.828 lab4 Preemptive Multitasking</h1><p class="info">date: <!-- -->2019-03-31<!-- --> <br/>tags: <span><a href="/tags/os">OS</a>Â Â </span><span><a href="/tags/6-828">6.828</a>Â Â </span></p><div><h2>Part A: Multiprocessor Support and Cooperative Multitasking</h2>
<p>ç¬¬ä¸€éƒ¨åˆ†è¦æŠŠJOSæ‹“å±•åˆ°å¤šå¤„ç†å™¨çš„ç³»ç»Ÿï¼Œå¹¶å®žçŽ°ä¸€äº›system callæ¥è®©user-level environmentsåˆ›å»ºæ–°çš„çŽ¯å¢ƒã€‚ç„¶åŽè¿˜éœ€è¦å®žçŽ°cooperativeçš„round-robinï¼Œä¹Ÿå°±æ˜¯è®©å½“å‰çš„ç”¨æˆ·çŽ¯å¢ƒå¯ä»¥ä¸»åŠ¨çš„é€€å‡ºã€‚ä¹‹åŽçš„part Cä¼šå®žçŽ°pre-emptiveçš„ç‰ˆæœ¬ã€‚</p>
<h3>Multiprocessor Support</h3>
<p>æˆ‘ä»¬é¦–å…ˆæ¥å®žçŽ°symmetric multiprocessing (SMP)ã€‚è¿™æ˜¯ä¸€ä¸ªå¤šå¤„ç†å™¨çš„æ¨¡åž‹ï¼Œæ‰€æœ‰çš„CPUéƒ½æœ‰åŒæ ·çš„ç³»ç»Ÿèµ„æºæƒé™ï¼Œå¦‚å†…å­˜å’ŒI/Oã€‚å› ä¸ºåœ¨SMPä¸­æ‰€æœ‰çš„å¤„ç†å™¨éƒ½ä¸€æ ·ï¼Œåœ¨bootçš„è¿‡ç¨‹ä¸­ï¼ŒCPUè¢«åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>the bootstrap processor (BSP): ç”¨äºŽåˆå§‹åŒ–ç³»ç»Ÿå¹¶bootæ“ä½œç³»ç»Ÿã€‚</li>
<li>the application processors (APs): åœ¨æ“ä½œç³»ç»Ÿæ­£å¸¸è¿è¡Œä¹‹åŽç”±BSPæ¿€æ´»ã€‚</li>
</ul>
<p>å“ªä¸ªCPUæ˜¯BSPæ˜¯ç”±ç¡¬ä»¶å’ŒBIOSå†³å®šçš„ã€‚æˆªæ­¢åˆ°çŽ°åœ¨ï¼ŒJOSéƒ½è¿è¡Œåœ¨BSPä¸Šã€‚</p>
<p>åœ¨ä¸€ä¸ªSMPç³»ç»Ÿé‡Œï¼Œæ¯ä¸ªCPUéƒ½æœ‰an accompanying local APIC (LAPIC) unit. ä¹‹å‰æåˆ°è¿‡ï¼ŒLAPICæ˜¯ç”¨äºŽåœ¨ç³»ç»Ÿä¸­deliver interruptã€‚LAPICåŒæ—¶è¿˜æ˜¯å…¶å¯¹åº”çš„CPUçš„unique identifierã€‚è¿™æ¬¡çš„labé‡Œé¢æˆ‘ä»¬ä¼šç”¨LAPIC unitçš„ä¸€äº›åŸºæœ¬çš„åŠŸèƒ½ï¼ˆåœ¨<code class="language-text">kern/lapic.c</code>ï¼‰ã€‚</p>
<ul>
<li>
<p><code class="language-text">cpunum()</code>å‡½æ•°é‡Œç”¨LAPICçš„identifieræ¥èŽ·å¾—å½“å‰çš„ä»£ç è¿è¡Œåœ¨å“ªä¸ªCPUä¸Šï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> ID      (0x0020/4)   </span><span class="token comment">// ID</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">int</span>
<span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>lapic<span class="token punctuation">)</span>
		<span class="token keyword">return</span> lapic<span class="token punctuation">[</span>ID<span class="token punctuation">]</span> <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
</li>
<li>
<p><code class="language-text">lapic_startap()</code>å‡½æ•°æ¥è®©BSPç»™APså‘é€STARTUP interprocessor interrupt (IPI)æ¥å¯åŠ¨å…¶ä»–çš„CPU</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> IO_RTC  0x70</span>

<span class="token comment">// Start additional processor running entry code at addr.</span>
<span class="token comment">// See Appendix B of MultiProcessor Specification.</span>
<span class="token keyword">void</span>
<span class="token function">lapic_startap</span><span class="token punctuation">(</span>uint8_t apicid<span class="token punctuation">,</span> uint32_t addr<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	uint16_t <span class="token operator">*</span>wrv<span class="token punctuation">;</span>

	<span class="token comment">// "The BSP must initialize CMOS shutdown code to 0AH</span>
	<span class="token comment">// and the warm reset vector (DWORD based at 40:67) to point at</span>
	<span class="token comment">// the AP startup code prior to the [universal startup algorithm]."</span>
	<span class="token function">outb</span><span class="token punctuation">(</span>IO_RTC<span class="token punctuation">,</span> <span class="token number">0xF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// offset 0xF is shutdown code</span>
	<span class="token function">outb</span><span class="token punctuation">(</span>IO_RTC<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0x0A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	wrv <span class="token operator">=</span> <span class="token punctuation">(</span>uint16_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">KADDR</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0x40</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span> <span class="token operator">|</span> <span class="token number">0x67</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Warm reset vector</span>
	wrv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	wrv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> addr <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">;</span>

	<span class="token comment">// "Universal startup algorithm."</span>
	<span class="token comment">// Send INIT (level-triggered) interrupt to reset other CPU.</span>
	<span class="token function">lapicw</span><span class="token punctuation">(</span>ICRHI<span class="token punctuation">,</span> apicid <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">lapicw</span><span class="token punctuation">(</span>ICRLO<span class="token punctuation">,</span> INIT <span class="token operator">|</span> LEVEL <span class="token operator">|</span> ASSERT<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">microdelay</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">lapicw</span><span class="token punctuation">(</span>ICRLO<span class="token punctuation">,</span> INIT <span class="token operator">|</span> LEVEL<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">microdelay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// should be 10ms, but too slow in Bochs!</span>

	<span class="token comment">// Send startup IPI (twice!) to enter code.</span>
	<span class="token comment">// Regular hardware is supposed to only accept a STARTUP</span>
	<span class="token comment">// when it is in the halted state due to an INIT.  So the second</span>
	<span class="token comment">// should be ignored, but it is part of the official Intel algorithm.</span>
	<span class="token comment">// Bochs complains about the second one.  Too bad for Bochs.</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">lapicw</span><span class="token punctuation">(</span>ICRHI<span class="token punctuation">,</span> apicid <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">lapicw</span><span class="token punctuation">(</span>ICRLO<span class="token punctuation">,</span> STARTUP <span class="token operator">|</span> <span class="token punctuation">(</span>addr <span class="token operator">>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">microdelay</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
</li>
<li>åœ¨PART Cä¸­ï¼Œæˆ‘ä»¬ä¼šç»™LAPICçš„å†…ç½®timeræ¥trigger clock interruptä»¥å®žçŽ°preemptive multitaskingï¼Œåœ¨<code class="language-text">apic_init()</code>ä¸­ã€‚</li>
</ul>
<p>ä¸€ä¸ªå¤„ç†å™¨é€šè¿‡memory-mapping I/O (MMIOï¼Œä¹‹å‰note2ä¸­æåˆ°è¿‡)æ¥è®¿é—®å…¶LAPICã€‚åœ¨MMIOä¸­ï¼Œä¸€éƒ¨è·Ÿç‰©ç†å†…å­˜æ˜¯hardwiredåˆ°ä¸€äº›I/Oè®¾å¤‡çš„å¯„å­˜å™¨ä¸Šï¼Œæ‰€ä»¥ç”¨æ¥è®¿é—®å†…å­˜çš„æŒ‡ä»¤ä¹Ÿå¯ä»¥ç”¨æ¥è®¿é—®device registersã€‚æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡åœ¨ç‰©ç†åœ°å€<code class="language-text">0xa0000</code>ä¸Šæœ‰ä¸€ä¸ªIO hole(è§ä¹‹å‰note2çš„ç‰©ç†åœ°å€layout)ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥å†™å…¥VGAæ˜¾ç¤ºbufferçš„ã€‚LAPICç±»ä¼¼ï¼Œå…¶PAåœ¨<code class="language-text">0xfe000000</code>å¼€å§‹çš„32MBã€‚å› ä¸ºæˆ‘ä»¬çš„è™šæ‹Ÿå†…å­˜åªæ˜ å°„åˆ°<code class="language-text">KERNBASE</code>ï¼Œä¹Ÿå°±æ˜¯<code class="language-text">0xf0000000</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬æˆ‘ä»¬ä¸èƒ½ç›´æŽ¥è®¿é—®ã€‚åœ¨JOSçš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œæœ‰ä»Ž<code class="language-text">MMIOBASE</code>å¼€å§‹çš„4MBçš„gapï¼Œä»¥æ˜ å°„LAPICè¿™æ ·çš„è®¾å¤‡ã€‚å› ä¸ºä¹‹åŽçš„ä¹‹åŽéœ€è¦ä½¿ç”¨æ›´å¤šçš„MMIOï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªå‡½æ•°æ¥ä»Žè¿™ä¸ªåŒºåŸŸä¸­åˆ†é…å†…å­˜ä»¥æ˜ å°„device memoryã€‚</p>
<h3>Exercise 1</h3>
<p>å®žçŽ°<code class="language-text">kern/lapic.c</code>ä¸­çš„<code class="language-text">mmio_map_region</code>ã€‚éœ€è¦åšå®Œä¸‹ä¸€ä¸ªexerciseæ‰èƒ½æµ‹è¯•ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">//</span>
<span class="token comment">// Reserve size bytes in the MMIO region and map [pa,pa+size) at this</span>
<span class="token comment">// location.  Return the base of the reserved region.  size does *not*</span>
<span class="token comment">// have to be multiple of PGSIZE.</span>
<span class="token comment">//</span>
<span class="token keyword">void</span> <span class="token operator">*</span>
<span class="token function">mmio_map_region</span><span class="token punctuation">(</span>physaddr_t pa<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Where to start the next region.  Initially, this is the</span>
	<span class="token comment">// beginning of the MMIO region.  Because this is static, its</span>
	<span class="token comment">// value will be preserved between calls to mmio_map_region</span>
	<span class="token comment">// (just like nextfree in boot_alloc).</span>
	<span class="token keyword">static</span> uintptr_t base <span class="token operator">=</span> MMIOBASE<span class="token punctuation">;</span>

	<span class="token comment">// Reserve size bytes of virtual memory starting at base and</span>
	<span class="token comment">// map physical pages [pa,pa+size) to virtual addresses</span>
	<span class="token comment">// [base,base+size).  Since this is device memory and not</span>
	<span class="token comment">// regular DRAM, you'll have to tell the CPU that it isn't</span>
	<span class="token comment">// safe to cache access to this memory.  Luckily, the page</span>
	<span class="token comment">// tables provide bits for this purpose; simply create the</span>
	<span class="token comment">// mapping with PTE_PCD|PTE_PWT (cache-disable and</span>
	<span class="token comment">// write-through) in addition to PTE_W.  (If you're interested</span>
	<span class="token comment">// in more details on this, see section 10.5 of IA32 volume</span>
	<span class="token comment">// 3A.)</span>
	<span class="token comment">//</span>
	<span class="token comment">// Be sure to round size up to a multiple of PGSIZE and to</span>
	<span class="token comment">// handle if this reservation would overflow MMIOLIM (it's</span>
	<span class="token comment">// okay to simply panic if this happens).</span>
	<span class="token comment">//</span>
	<span class="token comment">// Hint: The staff solution uses boot_map_region.</span>
	<span class="token comment">//</span>
	<span class="token comment">// Your code here:</span>
	size <span class="token operator">=</span> <span class="token function">ROUNDUP</span><span class="token punctuation">(</span>size<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>base <span class="token operator">+</span> size<span class="token punctuation">)</span> <span class="token operator">></span> MMIOLIM <span class="token operator">||</span> <span class="token punctuation">(</span>base <span class="token operator">+</span> size <span class="token operator">&lt;</span> base<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"overflow MMIOLIM"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">boot_map_region</span><span class="token punctuation">(</span>kern_pgdir<span class="token punctuation">,</span> base<span class="token punctuation">,</span> size<span class="token punctuation">,</span> pa<span class="token punctuation">,</span> PTE_W <span class="token operator">|</span> PTE_PCD <span class="token operator">|</span> PTE_PWT<span class="token punctuation">)</span><span class="token punctuation">;</span>
	base <span class="token operator">+=</span> size<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>base <span class="token operator">-</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æŒ‰ç…§æ³¨é‡Šè¦æ±‚å†™å°±è¡Œäº†ï¼Œå”¯ä¸€éœ€è¦æ³¨æ„çš„å°±æ˜¯<code class="language-text">base + size</code>å¯èƒ½ä¼šoverflowï¼Œæ‰€ä»¥éœ€è¦æ£€æŸ¥<code class="language-text">base + size &gt;= base</code>ã€‚</p>
<h3>Application Processor Bootstrap</h3>
<p>åœ¨å¯åŠ¨APsä¹‹å‰ï¼ŒBSPåº”è¯¥é¦–å…ˆæ”¶é›†å¤šå¤„ç†å™¨ç³»ç»Ÿçš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚CPUæ€»æ•°ï¼Œä»–ä»¬çš„APIC IDä»¥åŠä»–ä»¬çš„LAPICåœ¨MMIOé‡Œçš„åœ°å€ã€‚<code class="language-text">kern/mpconfig.c</code>ä¸­çš„<code class="language-text">mp_init()</code>å°±é€šè¿‡è¯»MP configuration tableä¸­çš„ä¿¡æ¯æ¥å¾—åˆ°è¿™äº›ä¿¡æ¯ï¼Œè¿™ä¸ªè¡¨åœ¨BIOS' s region of memoryã€‚</p>
<p><code class="language-text">kern/init.c</code>ä¸­çš„<code class="language-text">boot_aps()</code>è¿›è¡ŒAP bootstrap processã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Start the non-boot (AP) processors.</span>
<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">boot_aps</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">extern</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> mpentry_start<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> mpentry_end<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>code<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">CpuInfo</span> <span class="token operator">*</span>c<span class="token punctuation">;</span>

	<span class="token comment">// Write entry code to unused memory at MPENTRY_PADDR</span>
	code <span class="token operator">=</span> <span class="token function">KADDR</span><span class="token punctuation">(</span>MPENTRY_PADDR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memmove</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> mpentry_start<span class="token punctuation">,</span> mpentry_end <span class="token operator">-</span> mpentry_start<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Boot each AP one at a time</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>c <span class="token operator">=</span> cpus<span class="token punctuation">;</span> c <span class="token operator">&lt;</span> cpus <span class="token operator">+</span> ncpu<span class="token punctuation">;</span> c<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> cpus <span class="token operator">+</span> <span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// We've started already.</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>

		<span class="token comment">// Tell mpentry.S what stack to use </span>
		mpentry_kstack <span class="token operator">=</span> percpu_kstacks<span class="token punctuation">[</span>c <span class="token operator">-</span> cpus<span class="token punctuation">]</span> <span class="token operator">+</span> KSTKSIZE<span class="token punctuation">;</span>
		<span class="token comment">// Start the CPU at mpentry_start</span>
		<span class="token function">lapic_startap</span><span class="token punctuation">(</span>c<span class="token operator">-></span>cpu_id<span class="token punctuation">,</span> <span class="token function">PADDR</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Wait for the CPU to finish some basic setup in mp_main()</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span>c<span class="token operator">-></span>cpu_status <span class="token operator">!=</span> CPU_STARTED<span class="token punctuation">)</span>
			<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å°±åƒæ˜¯<code class="language-text">boot/boot.S</code>ä¸­çš„ï¼Œæ‰€ä»¥<code class="language-text">boot_aps()</code>æŠŠAP entry code(åœ¨<code class="language-text">kern/mpentry.S</code>ä¸­)ç§»åˆ°a memory location that is addressable in the real modeã€‚ä¸åƒbootloaderï¼Œæˆ‘ä»¬å¯¹APåœ¨å“ªé‡Œä¼šè¿è¡ŒAPçš„ä»£ç ï¼Œæˆ‘ä»¬æŠŠentry codeå¤åˆ¶åˆ° <code class="language-text">0x7000</code> (<code class="language-text">MPENTRY_PADDR</code>)ï¼Œä½†å®žé™…ä¸Šä»»ä½•640KBä»¥ä¸‹çš„åœ°å€éƒ½è¡Œã€‚</p>
<p>åœ¨å®Œæˆä¸Šè¿°çš„è¿™ä¸ª<code class="language-text">memmove</code>ä¹‹åŽï¼Œ<code class="language-text">boot_aps()</code>ä¸€ä¸ªä¸€ä¸ªé€šè¿‡å‘STARTUP IPIsåˆ°LAPIC unitæ¥æ¿€æ´»APï¼ˆä¹Ÿå°±æ˜¯è¿è¡Œ<code class="language-text">lapic_startap</code>ï¼‰ã€‚å¯åŠ¨ä¹‹åŽï¼Œä¼šè¿”å›žä¸€ä¸ªåˆå§‹çš„<code class="language-text">CS:IP</code>ï¼ŒAPå°±ä¼šä»Žè¿™ä¸ªåœ°å€å¼€å§‹è¿è¡Œentry codeï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯<code class="language-text">MPENTRY_PADDR</code>ã€‚</p>
<p>è¿™ä¸ªentry codeå°±æ˜¯<code class="language-text">kern/mpentry.S</code>ã€‚å®ƒä¹‹ä¸­çš„ä»£ç å’Œ<code class="language-text">boot/boot.S</code>å¾ˆåƒï¼Œå…ˆåšä¸€äº›è®¾ç½®ä¹‹åŽï¼Œå°±ä¼šè®©APè½¬åˆ°protected modeï¼Œç„¶åŽè¿è¡Œ<code class="language-text">kern/init.c</code>ä¸­çš„<code class="language-text">mp_main()</code>ã€‚<code class="language-text">boot_aps()</code>ä¼šç­‰å¾…<code class="language-text">c-&gt;cpu_status != CPU_STARTED</code>ï¼Œè¿™æ ·è¿™ä¸€ä¸ªAPå°±è¢«å¯åŠ¨äº†ï¼Œç„¶åŽåœ¨<code class="language-text">boot_aps</code>çš„å¾ªçŽ¯é‡Œé¢å°±å¯ä»¥è¿›è¡Œä¸‹ä¸€ä¸ªAPäº†ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Setup code for APs</span>
<span class="token keyword">void</span>
<span class="token function">mp_main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// We are in high EIP now, safe to switch to kern_pgdir </span>
	<span class="token function">lcr3</span><span class="token punctuation">(</span><span class="token function">PADDR</span><span class="token punctuation">(</span>kern_pgdir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"SMP: CPU %d starting\n"</span><span class="token punctuation">,</span> <span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">lapic_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">env_init_percpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">trap_init_percpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">xchg</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thiscpu<span class="token operator">-></span>cpu_status<span class="token punctuation">,</span> CPU_STARTED<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tell boot_aps() we're up</span>

	<span class="token comment">// Now that we have finished some basic setup, call sched_yield()</span>
	<span class="token comment">// to start running processes on this CPU.  But make sure that</span>
	<span class="token comment">// only one CPU can enter the scheduler at a time!</span>
	<span class="token comment">//</span>
	<span class="token comment">// Your code here:</span>

	<span class="token comment">// Remove this after you finish Exercise 6</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Exercise 2</h3>
<p>ä¿®æ”¹<code class="language-text">page_init()</code>ä»¥è…¾ç©º<code class="language-text">MPENTRY_PADDR</code>ã€‚æ˜¯çš„æˆ‘ä»¬å¯ä»¥å®‰å…¨çš„æŠŠAP bootstrap codeå¤åˆ¶åˆ°å¯¹åº”çš„ä½ç½®ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">//</span>
<span class="token comment">// Initialize page structure and memory free list.</span>
<span class="token comment">// After this is done, NEVER use boot_alloc again.  ONLY use the page</span>
<span class="token comment">// allocator functions below to allocate and deallocate physical</span>
<span class="token comment">// memory via the page_free_list.</span>
<span class="token comment">//</span>
<span class="token keyword">void</span>
<span class="token function">page_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4:</span>
	<span class="token comment">// Change your code to mark the physical page at MPENTRY_PADDR</span>
	<span class="token comment">// as in use</span>
	<span class="token keyword">struct</span> <span class="token class-name">PageInfo</span> <span class="token operator">*</span>mpentry_page <span class="token operator">=</span> <span class="token function">pa2page</span><span class="token punctuation">(</span>MPENTRY_PADDR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// The example code here marks all physical pages as free.</span>
	<span class="token comment">// However this is not truly the case.  What memory is free?</span>
	<span class="token comment">//  1) Mark physical page 0 as in use.</span>
	<span class="token comment">//     This way we preserve the real-mode IDT and BIOS structures</span>
	<span class="token comment">//     in case we ever need them.  (Currently we don't, but...)</span>
	<span class="token comment">//  2) The rest of base memory, [PGSIZE, npages_basemem * PGSIZE)</span>
	<span class="token comment">//     is free.</span>
	<span class="token comment">//  3) Then comes the IO hole [IOPHYSMEM, EXTPHYSMEM), which must</span>
	<span class="token comment">//     never be allocated.</span>
	<span class="token comment">//  4) Then extended memory [EXTPHYSMEM, ...).</span>
	<span class="token comment">//     Some of it is in use, some is free. Where is the kernel</span>
	<span class="token comment">//     in physical memory?  Which pages are already in use for</span>
	<span class="token comment">//     page tables and other data structures?</span>
	<span class="token comment">//</span>
	<span class="token comment">// Change the code to reflect this.</span>
	<span class="token comment">// NB: DO NOT actually touch the physical memory corresponding to</span>
	<span class="token comment">// free pages!</span>
	size_t i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> npages_basemem<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pages <span class="token operator">+</span> i <span class="token operator">==</span> mpentry_page<span class="token punctuation">)</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		pages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pp_ref <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		pages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pp_link <span class="token operator">=</span> page_free_list<span class="token punctuation">;</span>
		page_free_list <span class="token operator">=</span> <span class="token operator">&amp;</span>pages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token function">PADDR</span><span class="token punctuation">(</span><span class="token function">boot_alloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>PGSIZE<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> npages<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pp_ref <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		pages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>pp_link <span class="token operator">=</span> page_free_list<span class="token punctuation">;</span>
		page_free_list <span class="token operator">=</span> <span class="token operator">&amp;</span>pages<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>åŠ ä¸Šè¿™ä¸ªä¹‹åŽï¼Œæµ‹è¯•å¯ä»¥æœ‰ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> qemu-nox
<span class="token punctuation">..</span>.
check_page_free_list<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_alloc<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
kernel panic on CPU 0 at kern/pmap.c:813: assertion failed: check_va2pa<span class="token punctuation">(</span>pgdir, KERNBASE + i<span class="token punctuation">)</span> <span class="token operator">==</span> i
Welcome to the JOS kernel monitor<span class="token operator">!</span>
Type <span class="token string">'help'</span> <span class="token keyword">for</span> a list of commands.
K<span class="token operator">></span></code></pre></div>
<ul>
<li>
<p>æ¯”è¾ƒ<code class="language-text">kern/mpentry.S</code> å’Œ<code class="language-text">boot/boot.S</code>. ç‰¢è®°<code class="language-text">kern/mpentry.S</code>å’Œkernelä¸­çš„å…¶ä»–ä»£ç ä¸€æ ·ï¼Œæ˜¯è¢«ç¼–è¯‘ä¸Žé“¾æŽ¥åœ¨<code class="language-text">KERNBASE</code>ä¹‹ä¸Šçš„ã€‚<code class="language-text">mpentry.S</code>ä¸­<code class="language-text">MPBOOTPHYS</code>è¿™ä¸ªå®æ¥?ä¸ºä»€ä¹ˆ<code class="language-text">boot.S</code>ä¸éœ€è¦ï¼Ÿæ¢å¥è¯è¯´ï¼Œå¦‚æžœæˆ‘ä»¬ä¸ç”¨è¿™ä¸ªå®ï¼Œä¼šå‡ºä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ </p>
<p>åœ¨<code class="language-text">mpentry.S</code>çš„æ³¨é‡Šé‡Œé¢æœ‰å†™è¿™ä¸¤è€…çš„åŒºåˆ«ï¼Œé‚£å°±æ˜¯ï¼š</p>
<blockquote>
<p>This code is similar to boot/boot.S except that</p>
<ul>
<li>it does not need to enable A20</li>
<li>
<p>it uses MPBOOTPHYS to calculate absolute addresses of its</p>
<p>symbols, rather than relying on the linker to fill them</p>
</li>
</ul>
</blockquote>
<p>è¿™ç§è½¬æ¢æ˜¯å› ä¸ºbootloaderçš„LMAå’ŒVMAéƒ½åœ¨<code class="language-text">0x7c00</code>ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œä»€ä¹ˆæ˜ å°„ï¼Œæ‰€ä»¥è¿è¡Œ<code class="language-text">boot.S</code>æ—¶è™šæ‹Ÿåœ°å€å°±æ˜¯ç‰©ç†åœ°å€ï¼Œä¸éœ€è¦è½¬æ¢ã€‚ä½†æ˜¯kernelä¸­çš„åˆ™ä¸ç„¶ï¼Œå·²ç»è¿›è¡Œäº†è½¬æ¢äº†ï¼Œä½†æ˜¯åœ¨åŠ è½½GDTçš„æ—¶å€™éœ€è¦ç‰©ç†åœ°å€ã€‚å…·ä½“æ¥çœ‹ï¼Œ<code class="language-text">MPBOOTPHYS</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> MPBOOTPHYS(s) ((s) - mpentry_start + MPENTRY_PADDR)</span></code></pre></div>
<p><code class="language-text">mpentry-start</code>å°±æ˜¯è¿™ä¸ªå‡½æ•°çš„åœ°å€ï¼Œè€Œ<code class="language-text">MPENTRY_PADDR</code>æ˜¯APsçš„startup codeçš„ç‰©ç†åœ°å€ã€‚ç›¸å½“äºŽæ˜¯æŠŠ<code class="language-text">gdt</code>çš„ä½ç½®ç›¸å¯¹äºŽ<code class="language-text">mpentry_start</code>è¿™ä¸ªå‡½æ•°çš„åœ°å€çš„å¯¹åº”åˆ°<code class="language-text">MPENTRY_PADDR + gdt - mpentry_start</code>ï¼Œå°±å¦‚åŒ<code class="language-text">boot.S</code>ä¸­<code class="language-text">gdt</code>å¯¹åº”åˆ°åœ¨<code class="language-text">start + gdt - start</code>æ˜¯ä¸€æ ·çš„ï¼ˆ<code class="language-text">start</code>æ˜¯<code class="language-text">boot.S</code>çš„é‚£ä¸ªå‡½æ•°çš„åœ°å€ï¼‰ã€‚</p>
</li>
</ul>
<h3>Per-CPU State and Initialization</h3>
<p>å½“å†™ä¸€ä¸ªå¤šå¤„ç†å™¨çš„OSçš„æ—¶å€™ï¼ŒåŒºåˆ†per-CPU state that is private to each processorä¸Žglobal state that the whole system sharesæ˜¯éžå¸¸é‡è¦çš„ã€‚<code class="language-text">kern/cpu.h</code>ä¸­å®šä¹‰äº†å¤§å¤šæ•°per-CPU stateï¼ŒåŒ…æ‹¬äº†<code class="language-text">CpuInfo</code>ï¼Œå…¶å­˜å‚¨äº†per-CPUå˜é‡ã€‚<code class="language-text">cpunum()</code>æ€»ä¼šè¿”å›žCPUçš„IDï¼Œè¿™ä¸ªIDå¯ä»¥ç”¨æ¥ä½œä¸º<code class="language-text">cpus</code>è¿™æ ·çš„æ•°ç»„çš„indexã€‚<code class="language-text">thiscpu</code>è¡¨ç¤ºå½“å‰çš„CPUå¯¹åº”çš„<code class="language-text">struct CpuInfo</code>ã€‚</p>
<p>ä¸€äº›å€¼å¾—æ³¨æ„çš„per-CPU stateï¼š</p>
<ul>
<li>
<p>per-CPU kernel stack</p>
<p>å› ä¸ºå¤šä¸ªCPUå¯èƒ½ä¼šåŒæ—¶trapè¿›kernelï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç»™æ¯ä¸ªCPUä¸€ä¸ªå•ç‹¬çš„kernel stackã€‚<code class="language-text">percpu_kstacks[NCPU][KSTKSIZE]</code>è¿™ä¸ªæ•°ç»„å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚</p>
<p>åœ¨lab2ä¸­ï¼Œæˆ‘ä»¬æŠŠ<code class="language-text">bootstack</code>å¯¹åº”çš„BSPçš„kernel stackæ˜ å°„åˆ°äº†<code class="language-text">KSTACKTOP</code>ä¸‹é¢ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">	<span class="token comment">//////////////////////////////////////////////////////////////////////</span>
	<span class="token comment">// Use the physical memory that 'bootstack' refers to as the kernel</span>
	<span class="token comment">// stack.  The kernel stack grows down from virtual address KSTACKTOP.</span>
	<span class="token comment">// We consider the entire range from [KSTACKTOP-PTSIZE, KSTACKTOP)</span>
	<span class="token comment">// to be the kernel stack, but break this into two pieces:</span>
	<span class="token comment">//     * [KSTACKTOP-KSTKSIZE, KSTACKTOP) -- backed by physical memory</span>
	<span class="token comment">//     * [KSTACKTOP-PTSIZE, KSTACKTOP-KSTKSIZE) -- not backed; so if</span>
	<span class="token comment">//       the kernel overflows its stack, it will fault rather than</span>
	<span class="token comment">//       overwrite memory.  Known as a "guard page".</span>
	<span class="token comment">//     Permissions: kernel RW, user NONE</span>
	<span class="token comment">// Your code goes here:</span>
	<span class="token function">boot_map_region</span><span class="token punctuation">(</span>kern_pgdir<span class="token punctuation">,</span> KSTACKTOP<span class="token operator">-</span>KSTKSIZE<span class="token punctuation">,</span> KSTKSIZE<span class="token punctuation">,</span> <span class="token function">PADDR</span><span class="token punctuation">(</span>bootstack<span class="token punctuation">)</span><span class="token punctuation">,</span> 
                  PTE_W <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>åœ¨lab4ä¸­ï¼Œæˆ‘ä»¬ä¼šæŠŠæ‰€æœ‰çš„kernel stackéƒ½æ˜ å°„åˆ°è¿™ä¸ªåŒºåŸŸï¼Œå¹¶åŒ…å«ä¸€ä¸ªguard pageã€‚CPU 0çš„stackä¼šä»Ž<code class="language-text">KSTACKTOP</code>å¼€å§‹ï¼ŒCPU 1ä¼šåœ¨CPU 0çš„stackå†å‘ä¸‹<code class="language-text">KSTGAP</code>ã€‚åœ¨æ›´æ–°äº†ä¸ª<code class="language-text">inc/memorylayout.h</code>ä¸­æœ‰è¯¦ç»†çš„ä½“çŽ°ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">/*
* Virtual memory map:                                Permissions
*                                                    kernel/user
*
*    4 Gig -------->  +------------------------------+
*                     |                              | RW/--
*                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*                     :              .               :
*                     :              .               :
*                     :              .               :
*                     |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~| RW/--
*                     |                              | RW/--
*                     |   Remapped Physical Memory   | RW/--
*                     |                              | RW/--
*    KERNBASE, ---->  +------------------------------+ 0xf0000000      --+
*    KSTACKTOP        |     CPU0's Kernel Stack      | RW/--  KSTKSIZE   |
*                     | - - - - - - - - - - - - - - -|                   |
*                     |      Invalid Memory (*)      | --/--  KSTKGAP    |
*                     +------------------------------+                   |
*                     |     CPU1's Kernel Stack      | RW/--  KSTKSIZE   |
*                     | - - - - - - - - - - - - - - -|                 PTSIZE
*                     |      Invalid Memory (*)      | --/--  KSTKGAP    |
*                     +------------------------------+                   |
*                     :              .               :                   |
*                     :              .               :                   |
*    MMIOLIM ------>  +------------------------------+ 0xefc00000      --+
*                     |       Memory-mapped I/O      | RW/--  PTSIZE
* ULIM, MMIOBASE -->  +------------------------------+ 0xef800000
*                     |  Cur. Page Table (User R-)   | R-/R-  PTSIZE
*    UVPT      ---->  +------------------------------+ 0xef400000
*                     |          RO PAGES            | R-/R-  PTSIZE
*    UPAGES    ---->  +------------------------------+ 0xef000000
*                     |           RO ENVS            | R-/R-  PTSIZE
* UTOP,UENVS ------>  +------------------------------+ 0xeec00000
* UXSTACKTOP -/       |     User Exception Stack     | RW/RW  PGSIZE
*                     +------------------------------+ 0xeebff000
*                     |       Empty Memory (*)       | --/--  PGSIZE
*    USTACKTOP  --->  +------------------------------+ 0xeebfe000
*                     |      Normal User Stack       | RW/RW  PGSIZE
*                     +------------------------------+ 0xeebfd000
*                     |                              |
*                     |                              |
*                     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*                     .                              .
*                     .                              .
*                     .                              .
*                     |~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~|
*                     |     Program Data &amp; Heap      |
*    UTEXT -------->  +------------------------------+ 0x00800000
*    PFTEMP ------->  |       Empty Memory (*)       |        PTSIZE
*                     |                              |
*    UTEMP -------->  +------------------------------+ 0x00400000      --+
*                     |       Empty Memory (*)       |                   |
*                     | - - - - - - - - - - - - - - -|                   |
*                     |  User STAB Data (optional)   |                 PTSIZE
*    USTABDATA ---->  +------------------------------+ 0x00200000        |
*                     |       Empty Memory (*)       |                   |
*    0 ------------>  +------------------------------+                 --+
*
* (*) Note: The kernel ensures that "Invalid Memory" is *never* mapped.
*     "Empty Memory" is normally unmapped, but user programs may map pages
*     there if desired.  JOS user programs map pages temporarily at UTEMP.
*/</span></code></pre></div>
</li>
<li>
<p>per-CPU TSS and TSS descriptor</p>
<p>é¦–å…ˆå…ˆè¯´ä¸€ä¸‹ä»€ä¹ˆæ˜¯TSS:</p>
<blockquote>
<p>The <strong>task state segment</strong> (<strong>TSS</strong>) is a special structure on <a href="https://en.wikipedia.org/wiki/X86">x86</a>-based computers which holds information about a <a href="https://en.wikipedia.org/wiki/Task_(computers)">task</a>. It is used by the <a href="https://en.wikipedia.org/wiki/Operating_system">operating system</a> <a href="https://en.wikipedia.org/wiki/Kernel_(computer_science)">kernel</a> for task management. Specifically, the following information is stored in the TSS:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Processor_register">Processor register</a> state</li>
<li>I/O port permissions</li>
<li>Inner-level stack pointers</li>
<li>Previous TSS link</li>
</ul>
<p>The TSS may reside anywhere in <a href="https://en.wikipedia.org/wiki/Memory">memory</a>. A special segment register called the task register (TR) holds a <a href="https://en.wikipedia.org/wiki/X86_memory_segmentation">segment selector</a> that points to a valid TSS segment descriptor which resides in the <a href="https://en.wikipedia.org/wiki/Global_Descriptor_Table">GDT</a> (a TSS descriptor may not reside in the <a href="https://en.wikipedia.org/wiki/Local_Descriptor_Table">LDT</a>). Therefore, to use a TSS the following must be done by the operating system kernel:</p>
<ol>
<li>Create a TSS descriptor entry in the GDT</li>
<li>Load the TR with the segment selector for that segment</li>
<li>Add information to the TSS in memory as needed</li>
</ol>
<p>For security purposes, the TSS should be placed in memory that is accessible only to the <a href="https://en.wikipedia.org/wiki/Kernel_(computer_science)">kernel</a>.</p>
<p>quote from <a href="https://en.wikipedia.org/wiki/Task_state_segment">https://en.wikipedia.org/wiki/Task_state_segment</a></p>
</blockquote>
<p>æ‰€ä»¥è¯´ï¼ŒTSSå°±æ˜¯ä¸€ä¸ªç”¨æ¥ä¿å­˜ä¸€ä¸ªtask (åœ¨schedulingä¸­æŒ‡ä¸€ä¸ªthreadæˆ–è€…ä¸€ä¸ªprocess)çš„ç›¸å…³ä¿¡æ¯çš„ã€‚è€ŒTSS descriptorä¼šè¢«åœ¨GDTä¸­åˆ†é…ï¼Œå› ä¸ºGDTå°±æ˜¯ç”¨æ¥ç®¡ç†æ¯ä¸ªsegmentæ˜¯åšä»€ä¹ˆçš„ç”¨çš„ã€‚</p>
<p>å› ä¸ºéœ€è¦æ˜Žç¡®æ¯ä¸ªCPUçš„stackåœ¨å“ªé‡Œï¼Œæ‰€ä»¥éœ€è¦per-CPU TSSã€‚CPU içš„TSSè¢«å­˜åœ¨<code class="language-text">cpus[i].cpu_ts</code>ä¸­ï¼Œå¯¹åº”çš„TSS descriptoråœ¨<code class="language-text">gdt[(GDT_TSS0 &gt;&gt; 3) + i]</code>ã€‚åœ¨<code class="language-text">kern/trap.c</code>ä¸­ä½¿ç”¨ä¸ªå…¨å±€å˜é‡<code class="language-text">struct Taskstate ts</code> å°†å˜å¾—æ²¡ä»€ä¹ˆç”¨ã€‚</p>
</li>
<li>
<p>per-CPU current environment pointer</p>
<p>å› ä¸ºCPUä»¬å¯ä»¥åŒæ—¶è·‘ä¸åŒçš„è¿›ç¨‹ï¼Œæ‰€ä»¥ä¸èƒ½åªæœ‰ä¸€ä¸ª<code class="language-text">curenv</code>äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒæ”¹ä¸º<code class="language-text">cpus[cpunum()].cpu_env</code>ï¼ˆæˆ–è€…<code class="language-text">thiscpu-&gt;cpu_env</code>ï¼‰ã€‚è¿™æŒ‡å‘å½“å‰CPUæ­£åœ¨æ‰§è¡Œçš„çŽ¯å¢ƒã€‚</p>
</li>
<li>
<p>per-CPU system register</p>
<p>æ‰€æœ‰çš„å¯„å­˜å™¨ï¼ŒåŒ…æ‹¬ç³»ç»Ÿå¯„å­˜å™¨éƒ½æ˜¯private to CPUã€‚æ‰€ä»¥å¯¹äºŽå¯„å­˜å™¨çš„åˆå§‹åŒ–å‡½æ•°ï¼Œå¦‚<code class="language-text">lcr3()</code>, <code class="language-text">ltr()</code>, <code class="language-text">lgdt()</code>, <code class="language-text">lidt()</code>éƒ½éœ€è¦åœ¨æ¯ä¸ªCPUä¸Šè¿è¡Œä¸€ä¸‹ã€‚</p>
</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹³æ²Ÿè¿˜æœ‰åŠ å…¥ä»»ä½•per-CPU stateï¼Œæˆ–è€…å’ŒCPUç›¸å…³çš„åˆå§‹åŒ–ï¼Œæ³¨æ„éƒ½è¦è½¬åŒ–ä¸ºåœ¨CPUä¸Šè¿è¡Œã€‚</p>
<h3>Exercise 3</h3>
<p>ä¿®æ”¹<code class="language-text">kern.pmap.c</code>ä¸­çš„<code class="language-text">mem_init_mp()</code>æ¥æŠŠå¤šä¸ªCPUçš„stackæŒ‰ç…§ä¸Šé¢æ‰€è¯´çš„æ˜ å°„ä¸Šã€‚</p>
<p>å†™æ³•å°±æ˜¯æŒ‰ç…§æ³¨é‡Šçš„è¦æ±‚ï¼Œæ³¨æ„stacktopæ˜¯æœ€ä¸Šé¢ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Modify mappings in kern_pgdir to support SMP</span>
<span class="token comment">//   - Map the per-CPU stacks in the region [KSTACKTOP-PTSIZE, KSTACKTOP)</span>
<span class="token comment">//</span>
<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">mem_init_mp</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Map per-CPU stacks starting at KSTACKTOP, for up to 'NCPU' CPUs.</span>
	<span class="token comment">//</span>
	<span class="token comment">// For CPU i, use the physical memory that 'percpu_kstacks[i]' refers</span>
	<span class="token comment">// to as its kernel stack. CPU i's kernel stack grows down from virtual</span>
	<span class="token comment">// address kstacktop_i = KSTACKTOP - i * (KSTKSIZE + KSTKGAP), and is</span>
	<span class="token comment">// divided into two pieces, just like the single stack you set up in</span>
	<span class="token comment">// mem_init:</span>
	<span class="token comment">//     * [kstacktop_i - KSTKSIZE, kstacktop_i)</span>
	<span class="token comment">//          -- backed by physical memory</span>
	<span class="token comment">//     * [kstacktop_i - (KSTKSIZE + KSTKGAP), kstacktop_i - KSTKSIZE)</span>
	<span class="token comment">//          -- not backed; so if the kernel overflows its stack,</span>
	<span class="token comment">//             it will fault rather than overwrite another CPU's stack.</span>
	<span class="token comment">//             Known as a "guard page".</span>
	<span class="token comment">//     Permissions: kernel RW, user NONE</span>
	<span class="token comment">//</span>
	<span class="token comment">// LAB 4: Your code here:</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>NCPU<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		uintptr_t kstacktop_i <span class="token operator">=</span> KSTACKTOP <span class="token operator">-</span> i <span class="token operator">*</span> <span class="token punctuation">(</span>KSTKSIZE <span class="token operator">+</span> KSTKGAP<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">boot_map_region</span><span class="token punctuation">(</span>kern_pgdir<span class="token punctuation">,</span> kstacktop_i <span class="token operator">-</span> KSTKSIZE<span class="token punctuation">,</span> KSTKSIZE<span class="token punctuation">,</span> 
                        <span class="token function">PADDR</span><span class="token punctuation">(</span>percpu_kstacks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PTE_W <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿è¡Œä¹‹åŽçš„ç»“æžœä¸ºï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> qemu-nox
<span class="token punctuation">..</span>.
check_page_free_list<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_alloc<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_kern_pgdir<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_free_list<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_installed_pgdir<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
SMP: CPU 0 found 1 CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
enabled interrupts: 1 2
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
kernel panic on CPU 0 at kern/trap.c:220: page fault <span class="token keyword">in</span> kernel
Welcome to the JOS kernel monitor<span class="token operator">!</span>
Type <span class="token string">'help'</span> <span class="token keyword">for</span> a list of commands.
K<span class="token operator">></span></code></pre></div>
<h3>Exercise 4</h3>
<p>ä¿®æ”¹<code class="language-text">kern/trap.c</code>ä¸­çš„<code class="language-text">trap_init_percpu()</code>ï¼Œä»¥åˆå§‹åŒ–BSPçš„TSSå’ŒTSS descriptorã€‚æ³¨æ„ï¼Œæ”¹å®Œä¹‹åŽçš„ä»£ç åº”è¯¥ä¸åŒ…å«<code class="language-text">ts</code>è¿™ä¸ªå…¨å±€å˜é‡äº†ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Initialize and load the per-CPU TSS and IDT</span>
<span class="token keyword">void</span>
<span class="token function">trap_init_percpu</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// The example code here sets up the Task State Segment (TSS) and</span>
	<span class="token comment">// the TSS descriptor for CPU 0. But it is incorrect if we are</span>
	<span class="token comment">// running on other CPUs because each CPU has its own kernel stack.</span>
	<span class="token comment">// Fix the code so that it works for all CPUs.</span>
	<span class="token comment">//</span>
	<span class="token comment">// Hints:</span>
	<span class="token comment">//   - The macro "thiscpu" always refers to the current CPU's</span>
	<span class="token comment">//     struct CpuInfo;</span>
	<span class="token comment">//   - The ID of the current CPU is given by cpunum() or</span>
	<span class="token comment">//     thiscpu->cpu_id;</span>
	<span class="token comment">//   - Use "thiscpu->cpu_ts" as the TSS for the current CPU,</span>
	<span class="token comment">//     rather than the global "ts" variable;</span>
	<span class="token comment">//   - Use gdt[(GD_TSS0 >> 3) + i] for CPU i's TSS descriptor;</span>
	<span class="token comment">//   - You mapped the per-CPU kernel stacks in mem_init_mp()</span>
	<span class="token comment">//   - Initialize cpu_ts.ts_iomb to prevent unauthorized environments</span>
	<span class="token comment">//     from doing IO (0 is not the correct value!)</span>
	<span class="token comment">//</span>
	<span class="token comment">// ltr sets a 'busy' flag in the TSS selector, so if you</span>
	<span class="token comment">// accidentally load the same TSS on more than one CPU, you'll</span>
	<span class="token comment">// get a triple fault.  If you set up an individual CPU's TSS</span>
	<span class="token comment">// wrong, you may not get a fault until you try to return from</span>
	<span class="token comment">// user space on that CPU.</span>
	<span class="token comment">//</span>
	<span class="token comment">// LAB 4: Your code here:</span>

	<span class="token comment">// Setup a TSS so that we get the right stack</span>
	<span class="token comment">// when we trap to the kernel.</span>
	thiscpu<span class="token operator">-></span>cpu_ts<span class="token punctuation">.</span>ts_esp0 <span class="token operator">=</span> KSTACKTOP <span class="token operator">-</span> <span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>KSTKSIZE <span class="token operator">+</span> KSTKGAP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	thiscpu<span class="token operator">-></span>cpu_ts<span class="token punctuation">.</span>ts_ss0 <span class="token operator">=</span> GD_KD<span class="token punctuation">;</span>
	thiscpu<span class="token operator">-></span>cpu_ts<span class="token punctuation">.</span>ts_iomb <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Taskstate</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Initialize the TSS slot of the gdt.</span>
	gdt<span class="token punctuation">[</span><span class="token punctuation">(</span>GD_TSS0 <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">SEG16</span><span class="token punctuation">(</span>STS_T32A<span class="token punctuation">,</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>thiscpu<span class="token operator">-></span>cpu_ts<span class="token punctuation">)</span><span class="token punctuation">,</span>
					<span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Taskstate</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gdt<span class="token punctuation">[</span><span class="token punctuation">(</span>GD_TSS0 <span class="token operator">>></span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>sd_s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token comment">// Load the TSS selector (like other segment selectors, the</span>
	<span class="token comment">// bottom three bits are special; we leave them 0)</span>
	<span class="token function">ltr</span><span class="token punctuation">(</span>GD_TSS0 <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Load the IDT</span>
	<span class="token function">lidt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>idt_pd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æµ‹è¯•ç»“æžœå¦‚ä¸‹ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> qemu-nox CPUS<span class="token operator">=</span>4
<span class="token punctuation">..</span>.
Physical memory: 131072K available, base <span class="token operator">=</span> 640K, extended <span class="token operator">=</span> 130432K
check_page_free_list<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_alloc<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_kern_pgdir<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_free_list<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
check_page_installed_pgdir<span class="token punctuation">(</span><span class="token punctuation">)</span> succeeded<span class="token operator">!</span>
SMP: CPU 0 found 4 CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
enabled interrupts: 1 2
SMP: CPU 1 starting
SMP: CPU 2 starting
SMP: CPU 3 starting
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
<span class="token punctuation">..</span>.</code></pre></div>
<h3>Locking</h3>
<p>çŽ°åœ¨å½“åœ¨<code class="language-text">mp_main()</code>åˆå§‹åŒ–APä¹‹åŽè¿›å…¥spin:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Setup code for APs</span>
<span class="token keyword">void</span>
<span class="token function">mp_main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// We are in high EIP now, safe to switch to kern_pgdir </span>
	<span class="token function">lcr3</span><span class="token punctuation">(</span><span class="token function">PADDR</span><span class="token punctuation">(</span>kern_pgdir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"SMP: CPU %d starting\n"</span><span class="token punctuation">,</span> <span class="token function">cpunum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">lapic_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">env_init_percpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">trap_init_percpu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">xchg</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>thiscpu<span class="token operator">-></span>cpu_status<span class="token punctuation">,</span> CPU_STARTED<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// tell boot_aps() we're up</span>

	<span class="token comment">// Now that we have finished some basic setup, call sched_yield()</span>
	<span class="token comment">// to start running processes on this CPU.  But make sure that</span>
	<span class="token comment">// only one CPU can enter the scheduler at a time!</span>
	<span class="token comment">//</span>
	<span class="token comment">// Your code here:</span>

	<span class="token comment">// Remove this after you finish Exercise 6</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å†è®©APè¿›è¡Œæ›´å¤æ‚çš„æ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³è¿™é‡Œé¢å¯èƒ½æœ‰çš„ä¸€äº›raceã€‚ï¼ˆè¿™é‡Œä¸å¤ªæ˜Žç™½ï¼Œæ˜Žæ˜Ž<code class="language-text">boot_aps</code>æ˜¯ä¸€ä¸ªCPUä¸€ä¸ªCPUå¤„ç†çš„ï¼Œä¸ºå•¥ä¼šæœ‰race...ï¼‰æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç”¨ä¸€ä¸ª<em>big kernel lock</em>ã€‚big kernel lockæ˜¯ä¸€ä¸ªå…¨å±€é”ï¼Œå½“ä¸€ä¸ªçŽ¯å¢ƒè¿›å…¥kernel modeçš„æ—¶å€™å°±ä¼šèŽ·å–è¿™ä¸ªé”ï¼Œå½“çŽ¯å¢ƒè¿”å›žuser modeçš„æ—¶å€™å°±ä¼šé‡Šæ”¾ã€‚è¿™æ ·è®©use modeçš„çŽ¯å¢ƒä»¬å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œä½†æ˜¯å¦‚æžœè¦è¿›å…¥kernelå°±åªèƒ½æœ‰ä¸€ä¸ªäº†ã€‚</p>
<p><code class="language-text">kern/spinlock.h</code>ä¸­å£°æ˜Žäº†big kernel lockï¼Œåä¸º<code class="language-text">kernel_lock</code>ï¼Œå…¶æŽ¥å£ä¸º<code class="language-text">lock_kernel()</code>ä¸Ž<code class="language-text">unlock_kernel()</code>ã€‚æˆ‘ä»¬éœ€è¦åœ¨ä»¥ä¸‹çš„4ä¸ªåœ°æ–¹åŠ å…¥è¿™ä¸ªé”ç›¸å…³çš„ä»£ç ï¼š</p>
<ul>
<li>åœ¨<code class="language-text">i386_init()</code>, BSPå”¤é†’å…¶ä»–CPUsä¹‹å‰acquireã€‚</li>
<li>åœ¨<code class="language-text">mp_main()</code>, åˆå§‹åŒ–APåŽacquire, ä¹‹åŽè°ƒç”¨<code class="language-text">sched_yield()</code>æ¥åœ¨è¿™ä¸ªAPä¸Šè¿è¡ŒçŽ¯å¢ƒã€‚</li>
<li>åœ¨<code class="language-text">trap()</code>, å½“trapæ˜¯æ¥è‡ªuser modeçš„æ—¶å€™acquireã€‚</li>
<li>åœ¨<code class="language-text">env_run()</code>, release the lock <em>right before</em> switching to user mode. æˆ–æ—©æˆ–æ™šéƒ½ä¼šå¯¼è‡´races or deadlocks.</li>
</ul>
<h3>Exercise 5</h3>
<p>æ ¹æ®ä¸Šé¢çš„4æ¡ä¿®æ”¹ä»£ç ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// i386_init()</span>
	<span class="token comment">// Acquire the big kernel lock before waking up APs</span>
	<span class="token comment">// Your code here:</span>
	<span class="token function">lock_kernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Starting non-boot CPUs</span>
	<span class="token function">boot_aps</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// mp_main()</span>
	<span class="token comment">// Now that we have finished some basic setup, call sched_yield()</span>
	<span class="token comment">// to start running processes on this CPU.  But make sure that</span>
	<span class="token comment">// only one CPU can enter the scheduler at a time!</span>
	<span class="token comment">//</span>
	<span class="token comment">// Your code here:</span>
	<span class="token function">lock_kernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sched_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Remove this after you finish Exercise 6</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// trap()</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tf<span class="token operator">-></span>tf_cs <span class="token operator">&amp;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Trapped from user mode.</span>
		<span class="token comment">// Acquire the big kernel lock before doing any</span>
		<span class="token comment">// serious kernel work.</span>
		<span class="token comment">// LAB 4: Your code here.</span>
        <span class="token function">lock_kernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">assert</span><span class="token punctuation">(</span>curenv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token comment">// env_run()</span>
<span class="token keyword">void</span>
<span class="token function">env_run</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Step 1: If this is a context switch (a new environment is running):</span>
	<span class="token comment">//	   1. Set the current environment (if any) back to</span>
	<span class="token comment">//	      ENV_RUNNABLE if it is ENV_RUNNING (think about</span>
	<span class="token comment">//	      what other states it can be in),</span>
	<span class="token comment">//	   2. Set 'curenv' to the new environment,</span>
	<span class="token comment">//	   3. Set its status to ENV_RUNNING,</span>
	<span class="token comment">//	   4. Update its 'env_runs' counter,</span>
	<span class="token comment">//	   5. Use lcr3() to switch to its address space.</span>
	<span class="token comment">// Step 2: Use env_pop_tf() to restore the environment's</span>
	<span class="token comment">//	   registers and drop into user mode in the</span>
	<span class="token comment">//	   environment.</span>

	<span class="token comment">// Hint: This function loads the new environment's state from</span>
	<span class="token comment">//	e->env_tf.  Go back through the code you wrote above</span>
	<span class="token comment">//	and make sure you have set the relevant parts of</span>
	<span class="token comment">//	e->env_tf to sensible values.</span>

	<span class="token comment">// LAB 3: Your code here.</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>curenv <span class="token operator">&amp;&amp;</span> curenv<span class="token operator">-></span>env_status <span class="token operator">==</span> ENV_RUNNING<span class="token punctuation">)</span>
		curenv<span class="token operator">-></span>env_status <span class="token operator">=</span> ENV_RUNNABLE<span class="token punctuation">;</span>
	curenv <span class="token operator">=</span> e<span class="token punctuation">;</span>
	curenv<span class="token operator">-></span>env_status <span class="token operator">=</span> ENV_RUNNING<span class="token punctuation">;</span>
	curenv<span class="token operator">-></span>env_runs<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token function">lcr3</span><span class="token punctuation">(</span><span class="token function">PADDR</span><span class="token punctuation">(</span>curenv<span class="token operator">-></span>env_pgdir<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">unlock_kernel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">env_pop_tf</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>curenv<span class="token operator">-></span>env_tf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// panic("env_run not yet implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æœ€åŽçš„è¿™ä¸ª<code class="language-text">env_run</code>æ˜¯é€šè¿‡ä¸Šé¢çš„æ³¨é‡ŠåŠ åœ¨äº†step 1å’Œstep 2ä¹‹é—´äº†ã€‚</p>
<p>éœ€è¦åšå®Œä¸‹ä¸€ä¸ªexercise æ‰èƒ½æµ‹è¯•è¿™ä¸€ä¸ªã€‚</p>
<ul>
<li>
<p>å¦‚æžœbig kernel lockä¿è¯äº†åªèƒ½æœ‰ä¸€ä¸ªçŽ¯å¢ƒè¿è¡Œåœ¨kernel modeï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜éœ€è¦ä¸åŒçš„kernel stackå‘¢ï¼Ÿ</p>
<p>å›žå¿†è¿›å…¥<code class="language-text">trap</code>å‡½æ•°ä¹‹å‰ï¼Œåœ¨<code class="language-text">trapentry.S</code>çš„<code class="language-text">_alltraps</code>ä¸­æ˜¯éœ€è¦å­˜å…¥å½“å‰çš„<code class="language-text">esp</code>ç­‰çŠ¶æ€ä¿¡æ¯çš„ã€‚å¦‚æžœå…ˆåŽæœ‰ä¸¤ä¸ªä¸åŒCPUçš„è§¦å‘ä»Žuser modeåˆ°kernel modeçš„ä¸­æ–­ï¼Œé‚£ä¹ˆä¼šå…ˆåŽæŽ¨å…¥<code class="language-text">esp</code>ç­‰ä¿¡æ¯ï¼Œå¦‚CPU 0å…ˆæŽ¨å…¥ï¼Œç„¶åŽCPU 1å†æŽ¨å…¥ï¼Œä½†æ˜¯å¦‚æžœCPU 0å…ˆè¿”å›žäº†ï¼Œå°±ä¼šæ¢å¤æˆCPU 0çš„çŠ¶æ€äº†ï¼Œå°±å‡ºé—®é¢˜äº†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œåœ¨è¿›å…¥<code class="language-text">trap()</code>ä¹‹å‰ä»ç„¶æ˜¯æœ‰å…³äºŽæ ˆçš„æ“ä½œçš„ï¼Œæ‰€ä»¥åªç”¨åœ¨<code class="language-text">trap</code>é‡Œçš„é”æ˜¯åˆå‘é¿å…raceçš„ã€‚</p>
</li>
</ul>
<h3>Round-Robin Scheduling</h3>
<p>ä¸‹ä¸€ä¸ªä»»åŠ¡å°±æ˜¯å®žçŽ°Round-Robinã€‚å…¶åœ¨ROSä¸­çš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨<code class="language-text">kern/sched.c</code>ä¸­çš„<code class="language-text">sched_yield()</code>å‡½æ•°ä¼šå¾ªçŽ¯æœç´¢<code class="language-text">envs[]</code>ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªçŠ¶æ€ä¸º<code class="language-text">ENV_RUNNABLE</code>çš„çŽ¯å¢ƒå°±è°ƒç”¨<code class="language-text">env_run()</code>æ¥è¿›å…¥è¿™ä¸ªçŽ¯å¢ƒã€‚</li>
<li><code class="language-text">sched_yield()</code>éœ€è¦ä¿è¯ä¸€ä¸ªçŽ¯å¢ƒåŒæ—¶åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªCPUä¸Šã€‚å·²ç»è¢«è¿è¡Œäº†çš„çŽ¯å¢ƒçš„çŠ¶æ€ä¸º<code class="language-text">ENV_RUNNING</code>ã€‚</li>
<li>æˆ‘ä»¬å®žçŽ°äº†ä¸€ä¸ªæ–°çš„system callï¼Œåä¸º<code class="language-text">sys_yield()</code>ï¼Œå…¶è®©ç”¨æˆ·çŽ¯å¢ƒå¯ä»¥ä¸»åŠ¨çš„è°ƒç”¨<code class="language-text">sched_yield()</code>æ¥è®©å‡ºCPUã€‚</li>
</ul>
<h3>Exercise 6</h3>
<p>å®žçŽ°<code class="language-text">sched_yield()</code>ï¼Œå¹¶æŠŠ<code class="language-text">sys_yield()</code>åŠ å…¥<code class="language-text">syscall()</code>ã€‚ä¿®æ”¹<code class="language-text">kern/init.c</code>æ¥åˆ›å»º3ä¸ªçŽ¯å¢ƒï¼Œè®©ä»–ä»¬éƒ½è¿è¡Œ<code class="language-text">user/yield.c</code>ã€‚</p>
<p>é¦–å…ˆæ˜¯<code class="language-text">sched_yield()</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Choose a user environment to run and run it.</span>
<span class="token keyword">void</span>
<span class="token function">sched_yield</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>idle<span class="token punctuation">;</span>

	<span class="token comment">// Implement simple round-robin scheduling.</span>
	<span class="token comment">//</span>
	<span class="token comment">// Search through 'envs' for an ENV_RUNNABLE environment in</span>
	<span class="token comment">// circular fashion starting just after the env this CPU was</span>
	<span class="token comment">// last running.  Switch to the first such environment found.</span>
	<span class="token comment">//</span>
	<span class="token comment">// If no envs are runnable, but the environment previously</span>
	<span class="token comment">// running on this CPU is still ENV_RUNNING, it's okay to</span>
	<span class="token comment">// choose that environment.</span>
	<span class="token comment">//</span>
	<span class="token comment">// Never choose an environment that's currently running on</span>
	<span class="token comment">// another CPU (env_status == ENV_RUNNING). If there are</span>
	<span class="token comment">// no runnable environments, simply drop through to the code</span>
	<span class="token comment">// below to halt the cpu.</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	idle <span class="token operator">=</span> curenv <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">?</span> envs <span class="token operator">:</span> <span class="token punctuation">(</span>curenv <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!=</span> NENV<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e <span class="token operator">=</span> envs <span class="token operator">+</span> <span class="token punctuation">(</span>idle <span class="token operator">-</span> envs <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">%</span> NENV<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token operator">-></span>env_status <span class="token operator">!=</span> ENV_RUNNABLE<span class="token punctuation">)</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token function">env_run</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">==</span> NENV <span class="token operator">&amp;&amp;</span> curenv <span class="token operator">&amp;&amp;</span> curenv<span class="token operator">-></span>env_status <span class="token operator">==</span> ENV_RUNNING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">env_run</span><span class="token punctuation">(</span>curenv<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// sched_halt never returns</span>
	<span class="token function">sched_halt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽåœ¨<code class="language-text">syscall()</code>é‡Œé¢åŠ ä¸Š<code class="language-text">sys_yield</code>ã€‚æ³¨æ„<code class="language-text">SYS_yield</code>å·²ç»åœ¨<code class="language-text">inc/syscall.h</code>é‡Œé¢è¢«åŠ ä¸Šäº†ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">		<span class="token keyword">case</span> SYS_yield<span class="token operator">:</span>
			<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p>æœ€åŽåœ¨<code class="language-text">init()</code>ä¸­åŠ å…¥3ä¸ªyieldï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">if</span> defined(TEST)</span>
	<span class="token comment">// Don't touch -- used by grading script!</span>
	<span class="token function">ENV_CREATE</span><span class="token punctuation">(</span>TEST<span class="token punctuation">,</span> ENV_TYPE_USER<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
	<span class="token comment">// Touch all you want.</span>
	<span class="token function">ENV_CREATE</span><span class="token punctuation">(</span>user_yield<span class="token punctuation">,</span> ENV_TYPE_USER<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ENV_CREATE</span><span class="token punctuation">(</span>user_yield<span class="token punctuation">,</span> ENV_TYPE_USER<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">ENV_CREATE</span><span class="token punctuation">(</span>user_yield<span class="token punctuation">,</span> ENV_TYPE_USER<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//ENV_CREATE(user_primes, ENV_TYPE_USER);</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">// TEST*</span>
	<span class="token comment">// Schedule and run the first user environment!</span>
	<span class="token function">sched_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿è¡Œå¯ä»¥å¾—åˆ°ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> qemu-nox
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001001
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001002
Hello, I am environment 00001000.
Hello, I am environment 00001001.
Hello, I am environment 00001002.
Back <span class="token keyword">in</span> environment 00001000, iteration 0.
Back <span class="token keyword">in</span> environment 00001001, iteration 0.
Back <span class="token keyword">in</span> environment 00001002, iteration 0.
Back <span class="token keyword">in</span> environment 00001000, iteration 1.
Back <span class="token keyword">in</span> environment 00001001, iteration 1.
Back <span class="token keyword">in</span> environment 00001002, iteration 1.
Back <span class="token keyword">in</span> environment 00001000, iteration 2.
Back <span class="token keyword">in</span> environment 00001001, iteration 2.
Back <span class="token keyword">in</span> environment 00001002, iteration 2.
Back <span class="token keyword">in</span> environment 00001000, iteration 3.
Back <span class="token keyword">in</span> environment 00001001, iteration 3.
Back <span class="token keyword">in</span> environment 00001002, iteration 3.
Back <span class="token keyword">in</span> environment 00001000, iteration 4.
All <span class="token keyword">done</span> <span class="token keyword">in</span> environment 00001000.
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
Back <span class="token keyword">in</span> environment 00001001, iteration 4.
All <span class="token keyword">done</span> <span class="token keyword">in</span> environment 00001001.
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001001
Back <span class="token keyword">in</span> environment 00001002, iteration 4.
All <span class="token keyword">done</span> <span class="token keyword">in</span> environment 00001002.
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001002
No runnable environments <span class="token keyword">in</span> the system<span class="token operator">!</span>
<span class="token punctuation">..</span>.</code></pre></div>
<p>å¦‚æžœè®¾ç½®CPUS=2ä¼šæœ‰ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> qemu-nox CPUS<span class="token operator">=</span>2
***
*** Use Ctrl-a x to <span class="token keyword">exit</span> qemu
***
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001001
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001002
Hello, I am environment 00001000.
Hello, I am environment 00001001.
Back <span class="token keyword">in</span> environment 00001000, iteration 0.
Hello, I am environment 00001002.
Back <span class="token keyword">in</span> environment 00001001, iteration 0.
Back <span class="token keyword">in</span> environment 00001000, iteration 1.
Back <span class="token keyword">in</span> environment 00001002, iteration 0.
Back <span class="token keyword">in</span> environment 00001001, iteration 1.
Back <span class="token keyword">in</span> environment 00001000, iteration 2.
Back <span class="token keyword">in</span> environment 00001002, iteration 1.
Back <span class="token keyword">in</span> environment 00001001, iteration 2.
Back <span class="token keyword">in</span> environment 00001000, iteration 3.
Back <span class="token keyword">in</span> environment 00001001, iteration 3.
Back <span class="token keyword">in</span> environment 00001002, iteration 2.
Back <span class="token keyword">in</span> environment 00001000, iteration 4.
Back <span class="token keyword">in</span> environment 00001001, iteration 4.
All <span class="token keyword">done</span> <span class="token keyword">in</span> environment 00001000.
All <span class="token keyword">done</span> <span class="token keyword">in</span> environment 00001001.
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001001
Back <span class="token keyword">in</span> environment 00001002, iteration 3.
Back <span class="token keyword">in</span> environment 00001002, iteration 4.
All <span class="token keyword">done</span> <span class="token keyword">in</span> environment 00001002.
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001002
No runnable environments <span class="token keyword">in</span> the system<span class="token operator">!</span>
<span class="token punctuation">..</span>.</code></pre></div>
<ul>
<li>
<p>åœ¨çŽ°åœ¨çš„<code class="language-text">env_run()</code>ä¸­ï¼Œä¸ºä»€ä¹ˆåœ¨è¿›è¡Œcontext switchå‰åŽéƒ½å¯ä»¥dereference <code class="language-text">e</code>ï¼Ÿ</p>
<p>å› ä¸º<code class="language-text">e</code>åœ¨kerneléƒ¨åˆ†ï¼Œæ‰€æœ‰çš„çŽ¯å¢ƒçš„é‡Œå¯¹åº”çš„åœ°å€æ˜¯ä¸€æ ·çš„ã€‚</p>
</li>
<li>
<p>å†åˆ‡æ¢çš„æ—¶å€™æ˜¯åœ¨å“ªé‡Œä¿å­˜çš„æ—§çš„å¯„å­˜å™¨çŠ¶æ€çš„ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Ÿ</p>
<p>å¦‚æžœä¸è¿™ä¹ˆåšåˆ‡æ¢å›žæ¥å°±ä¸èƒ½ç»§ç»­è¿è¡Œäº†...ä¿å­˜æ˜¯åœ¨<code class="language-text">_alltraps</code>ä¸­åšçš„ï¼Œæ¢å¤æ˜¯åœ¨<code class="language-text">env_run</code>çš„<code class="language-text">env_pop_tf()</code>åšçš„ã€‚</p>
</li>
</ul>
<h3>System Calls for Environment Creation</h3>
<p>å°½ç®¡çŽ°åœ¨å¯ä»¥å­å•Šç”¨æˆ·çŽ¯å¢ƒä¹‹é—´ç›¸äº’åˆ‡æ¢äº†ï¼Œåˆ›å»ºçŽ¯å¢ƒä»ç„¶éœ€è¦åœ¨kernelåˆå§‹åŒ–çš„æ—¶å€™è¿›è¡Œã€‚çŽ°åœ¨å¼€å§‹éœ€è¦å®žçŽ°system callsæ¥è®©ç”¨æˆ·çŽ¯å¢ƒå¯ä»¥åˆ›å»ºæ–°çš„ç”¨æˆ·çŽ¯å¢ƒã€‚</p>
<p>Unixç”¨<code class="language-text">fork()</code>ä½œä¸ºprocess creation primitiveã€‚å…¶ä¼šå¤åˆ¶æ•´ä¸ªaddress spaceã€‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹çš„å”¯ä¸€åŒºåˆ«åœ¨äºŽå…¶process IDä¸Žparent process IDã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œ<code class="language-text">fork()</code>è¿”å›žå­è¿›ç¨‹IDï¼Œå­è¿›ç¨‹ä¸­è¿”å›ž0ã€‚åœ¨é»˜è®¤è®¾ç½®ä¸‹ï¼Œè¿™ä¸¤ä¸ªè¿›ç¨‹ä¹‹åŽå¯¹å†…å­˜çš„ä¿®æ”¹äº’ä¸å½±å“ã€‚</p>
<p>æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªä¸åŒçš„ï¼Œæ›´primitiveçš„ä¸€ç»„system callã€‚ç”¨è¿™äº›system callæˆ‘ä»¬å°†å¯ä»¥å®Œå…¨åœ¨ç”¨æˆ·çŽ¯å¢ƒä¸‹å®žçŽ°<code class="language-text">fork</code>ã€‚æ–°çš„system callæœ‰ï¼š</p>
<ul>
<li>
<p><code class="language-text">sys_exofork</code></p>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„å‡ ä¹Žå®Œå…¨æ˜¯ç©ºç™½çš„çŽ¯å¢ƒã€‚è¿™ä¸ªçŽ¯å¢ƒçš„address spaceåœ¨ç”¨æˆ·éƒ¨åˆ†ä»€ä¹ˆéƒ½æ²¡æœ‰æ˜ å°„ï¼Œä¸”çŽ¯å¢ƒä¸èƒ½è¿è¡Œã€‚ä½†æ˜¯å…¶å¯„å­˜å™¨çŠ¶æ€ä¼šå’Œçˆ¶è¿›ç¨‹ç›¸åŒã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œ<code class="language-text">sys_exofork</code>ä¼šè¿”å›žå­è¿›ç¨‹çš„<code class="language-text">envid_t</code>ï¼Œå­è¿›ç¨‹ä¸­è¿”å›ž0ï¼ˆå› ä¸ºå­è¿›ç¨‹ä¸èƒ½è¿è¡Œï¼Œæ‰€ä»¥ç›´åˆ°parentæŠŠchildæ ‡è®°ä¸ºrunnableä¹‹åŽæ‰ä¼šè¿”å›žè¿™ä¸ª0ï¼‰ã€‚</p>
</li>
<li>
<p><code class="language-text">sys_env_set_status</code></p>
<p>æŠŠæŸä¸€ä¸ªçŽ¯å¢ƒçš„çŠ¶æ€è®¾ç½®ä¸º<code class="language-text">ENV_RUNNABLE</code>æˆ–<code class="language-text">ENV_NOT_RUNNABLE</code>ã€‚åŸºæœ¬ä¸Šæ˜¯ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªæ–°çŽ¯å¢ƒå¯ä»¥è¿è¡Œäº†ã€‚</p>
</li>
<li>
<p><code class="language-text">sys_page_alloc</code></p>
<p>æŠŠæŸä¸€pageçš„ç‰©ç†å†…å­˜æ˜ å°„åˆ°åˆ¶å®šaddress spaceçš„è™šæ‹Ÿåœ°å€ã€‚</p>
</li>
<li>
<p><code class="language-text">sys_page_map</code></p>
<p>æŠŠä¸€ä¸ªpageï¼ˆæ³¨æ„ä¸æ˜¯pageçš„å†…å®¹ï¼‰ä»Žä¸€ä¸ªåœ°å€ç©ºé—´æ˜ å°„åˆ°å¦ä¸€ä¸ªã€‚ä¿å­˜memory sharing arrangement inplaceä½¿å¾—ä¸¤è€…ä¼šæŒ‡å‘åŒæ ·çš„ç‰©ç†å†…å­˜ã€‚</p>
</li>
<li>
<p><code class="language-text">sys_page_unmap</code></p>
<p>åœ¨æŸä¸€ç»™å®šåœ°å€ç©ºé—´ä¸­ï¼Œunmap a page mapped at a given VAã€‚</p>
</li>
</ul>
<p>å¯¹äºŽä»¥ä¸Šè¿™äº›è¾“å…¥ä¸­åŒ…å«environment IDçš„system callï¼ŒJOSæ”¯æŒ0è¡¨ç¤ºå½“å‰çŽ¯å¢ƒã€‚è¿™ä¸€æ”¯æŒåœ¨<code class="language-text">envid2env()</code>ä¸­è¢«å®žçŽ°äº†ã€‚</p>
<p>åœ¨<code class="language-text">user/dumbfork.c</code>ä¸­å·²ç»å®žçŽ°äº†ä¸€ä¸ªæ¯”è¾ƒè ¢çš„<code class="language-text">fork</code>ï¼Œæµ‹è¯•ç¨‹åºä¼šä½¿ç”¨ä¸Šè¿°system callæ¥åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚ç„¶åŽçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šç›¸äº’è°ƒç”¨<code class="language-text">sys_yield</code>ï¼Œ10ä¸ªå¾ªçŽ¯ä¹‹åŽparent exitï¼Œ20ä¸ªä¹‹åŽchildé€€å‡ºã€‚</p>
<h3>Exercise 7</h3>
<p>åœ¨<code class="language-text">kern/syscall.c</code>ä¸­å®žçŽ°ä¸Šè¿°system callã€‚</p>
<p>é¦–å…ˆæ˜¯<code class="language-text">sys_exofork</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Allocate a new environment.</span>
<span class="token comment">// Returns envid of new environment, or &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_NO_FREE_ENV if no free environment is available.</span>
<span class="token comment">//	-E_NO_MEM on memory exhaustion.</span>
<span class="token keyword">static</span> envid_t
<span class="token function">sys_exofork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Create the new environment with env_alloc(), from kern/env.c.</span>
	<span class="token comment">// It should be left as env_alloc created it, except that</span>
	<span class="token comment">// status is set to ENV_NOT_RUNNABLE, and the register set is copied</span>
	<span class="token comment">// from the current environment -- but tweaked so sys_exofork</span>
	<span class="token comment">// will appear to return 0.</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">env_alloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>e<span class="token punctuation">,</span> curenv<span class="token operator">-></span>env_id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_status <span class="token operator">=</span> ENV_NOT_RUNNABLE<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_tf <span class="token operator">=</span> curenv<span class="token operator">-></span>env_tf<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_tf<span class="token punctuation">.</span>tf_regs<span class="token punctuation">.</span>reg_eax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> e<span class="token operator">-></span>env_id<span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_exofork not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">sys_env_set_status</code>:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Set envid's env_status to status, which must be ENV_RUNNABLE</span>
<span class="token comment">// or ENV_NOT_RUNNABLE.</span>
<span class="token comment">//</span>
<span class="token comment">// Returns 0 on success, &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_BAD_ENV if environment envid doesn't currently exist,</span>
<span class="token comment">//		or the caller doesn't have permission to change envid.</span>
<span class="token comment">//	-E_INVAL if status is not a valid status for an environment.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_env_set_status</span><span class="token punctuation">(</span>envid_t envid<span class="token punctuation">,</span> <span class="token keyword">int</span> status<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Hint: Use the 'envid2env' function from kern/env.c to translate an</span>
	<span class="token comment">// envid to a struct Env.</span>
	<span class="token comment">// You should set envid2env's third argument to 1, which will</span>
	<span class="token comment">// check whether the current environment has permission to set</span>
	<span class="token comment">// envid's status.</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">!=</span> ENV_NOT_RUNNABLE <span class="token operator">&amp;&amp;</span> status <span class="token operator">!=</span> ENV_RUNNABLE<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_status <span class="token operator">=</span> status<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_env_set_status not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">sys_page_alloc</code>:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Allocate a page of memory and map it at 'va' with permission</span>
<span class="token comment">// 'perm' in the address space of 'envid'.</span>
<span class="token comment">// The page's contents are set to 0.</span>
<span class="token comment">// If a page is already mapped at 'va', that page is unmapped as a</span>
<span class="token comment">// side effect.</span>
<span class="token comment">//</span>
<span class="token comment">// perm -- PTE_U | PTE_P must be set, PTE_AVAIL | PTE_W may or may not be set,</span>
<span class="token comment">//         but no other bits may be set.  See PTE_SYSCALL in inc/mmu.h.</span>
<span class="token comment">//</span>
<span class="token comment">// Return 0 on success, &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_BAD_ENV if environment envid doesn't currently exist,</span>
<span class="token comment">//		or the caller doesn't have permission to change envid.</span>
<span class="token comment">//	-E_INVAL if va >= UTOP, or va is not page-aligned.</span>
<span class="token comment">//	-E_INVAL if perm is inappropriate (see above).</span>
<span class="token comment">//	-E_NO_MEM if there's no memory to allocate the new page,</span>
<span class="token comment">//		or to allocate any necessary page tables.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_page_alloc</span><span class="token punctuation">(</span>envid_t envid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>va<span class="token punctuation">,</span> <span class="token keyword">int</span> perm<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Hint: This function is a wrapper around page_alloc() and</span>
	<span class="token comment">//   page_insert() from kern/pmap.c.</span>
	<span class="token comment">//   Most of the new code you write should be to check the</span>
	<span class="token comment">//   parameters for correctness.</span>
	<span class="token comment">//   If page_insert() fails, remember to free the page you</span>
	<span class="token comment">//   allocated!</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">PageInfo</span> <span class="token operator">*</span>pp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>va <span class="token operator">>=</span> UTOP <span class="token operator">||</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>va<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>va<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> <span class="token punctuation">(</span>PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> <span class="token operator">~</span>PTE_SYSCALL<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pp <span class="token operator">=</span> <span class="token function">page_alloc</span><span class="token punctuation">(</span>ALLOC_ZERO<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_NO_MEM<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">page_insert</span><span class="token punctuation">(</span>e<span class="token operator">-></span>env_pgdir<span class="token punctuation">,</span> pp<span class="token punctuation">,</span> va<span class="token punctuation">,</span> perm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">page_free</span><span class="token punctuation">(</span>pp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_page_alloc not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">sys_page_map</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Map the page of memory at 'srcva' in srcenvid's address space</span>
<span class="token comment">// at 'dstva' in dstenvid's address space with permission 'perm'.</span>
<span class="token comment">// Perm has the same restrictions as in sys_page_alloc, except</span>
<span class="token comment">// that it also must not grant write access to a read-only</span>
<span class="token comment">// page.</span>
<span class="token comment">//</span>
<span class="token comment">// Return 0 on success, &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_BAD_ENV if srcenvid and/or dstenvid doesn't currently exist,</span>
<span class="token comment">//		or the caller doesn't have permission to change one of them.</span>
<span class="token comment">//	-E_INVAL if srcva >= UTOP or srcva is not page-aligned,</span>
<span class="token comment">//		or dstva >= UTOP or dstva is not page-aligned.</span>
<span class="token comment">//	-E_INVAL is srcva is not mapped in srcenvid's address space.</span>
<span class="token comment">//	-E_INVAL if perm is inappropriate (see sys_page_alloc).</span>
<span class="token comment">//	-E_INVAL if (perm &amp; PTE_W), but srcva is read-only in srcenvid's</span>
<span class="token comment">//		address space.</span>
<span class="token comment">//	-E_NO_MEM if there's no memory to allocate any necessary page tables.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_page_map</span><span class="token punctuation">(</span>envid_t srcenvid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>srcva<span class="token punctuation">,</span>
	     envid_t dstenvid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>dstva<span class="token punctuation">,</span> <span class="token keyword">int</span> perm<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Hint: This function is a wrapper around page_lookup() and</span>
	<span class="token comment">//   page_insert() from kern/pmap.c.</span>
	<span class="token comment">//   Again, most of the new code you write should be to check the</span>
	<span class="token comment">//   parameters for correctness.</span>
	<span class="token comment">//   Use the third argument to page_lookup() to</span>
	<span class="token comment">//   check the current permissions on the page.</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>srce <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>dste <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">PageInfo</span> <span class="token operator">*</span>pp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	pte_t <span class="token operator">*</span>src_pte <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>srcenvid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>srce<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>dstenvid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dste<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>srcva <span class="token operator">>=</span> UTOP <span class="token operator">||</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>srcva<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>srcva<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>dstva <span class="token operator">>=</span> UTOP <span class="token operator">||</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>dstva<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>dstva<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> <span class="token punctuation">(</span>PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> <span class="token operator">~</span>PTE_SYSCALL<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pp <span class="token operator">=</span> <span class="token function">page_lookup</span><span class="token punctuation">(</span>srce<span class="token operator">-></span>env_pgdir<span class="token punctuation">,</span> srcva<span class="token punctuation">,</span> <span class="token operator">&amp;</span>src_pte<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>src_pte <span class="token operator">&amp;</span> PTE_W<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> PTE_W<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">page_insert</span><span class="token punctuation">(</span>dste<span class="token operator">-></span>env_pgdir<span class="token punctuation">,</span> pp<span class="token punctuation">,</span> dstva<span class="token punctuation">,</span> perm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_page_map not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æœ€åŽæ˜¯<code class="language-text">sys_page_unmap</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Unmap the page of memory at 'va' in the address space of 'envid'.</span>
<span class="token comment">// If no page is mapped, the function silently succeeds.</span>
<span class="token comment">//</span>
<span class="token comment">// Return 0 on success, &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_BAD_ENV if environment envid doesn't currently exist,</span>
<span class="token comment">//		or the caller doesn't have permission to change envid.</span>
<span class="token comment">//	-E_INVAL if va >= UTOP, or va is not page-aligned.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_page_unmap</span><span class="token punctuation">(</span>envid_t envid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>va<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Hint: This function is a wrapper around page_remove().</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>va <span class="token operator">>=</span> UTOP <span class="token operator">||</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>va<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>va<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token function">page_remove</span><span class="token punctuation">(</span>e<span class="token operator">-></span>env_pgdir<span class="token punctuation">,</span> va<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_page_unmap not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æœ€åŽæŠŠè¿™äº›system calléƒ½æ”¾åˆ°<code class="language-text">syscall()</code>å‡½æ•°ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Dispatches to the correct kernel function, passing the arguments.</span>
int32_t
<span class="token function">syscall</span><span class="token punctuation">(</span>uint32_t syscallno<span class="token punctuation">,</span> uint32_t a1<span class="token punctuation">,</span> uint32_t a2<span class="token punctuation">,</span> uint32_t a3<span class="token punctuation">,</span> uint32_t a4<span class="token punctuation">,</span> uint32_t a5<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// Call the function corresponding to the 'syscallno' parameter.</span>
	<span class="token comment">// Return any appropriate return value.</span>
	<span class="token comment">// LAB 3: Your code here.</span>
	<span class="token comment">// panic("syscall not implemented");</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>syscallno<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> SYS_cputs<span class="token operator">:</span>
			<span class="token function">sys_cputs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>a1<span class="token punctuation">,</span> <span class="token punctuation">(</span>size_t<span class="token punctuation">)</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_cgetc<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_cgetc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_getenvid<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_getenvid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_env_destroy<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_env_destroy</span><span class="token punctuation">(</span><span class="token function">sys_getenvid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_yield<span class="token operator">:</span>
			<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_page_alloc<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_page_alloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span>envid_t<span class="token punctuation">)</span>a1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>a2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a3<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_page_map<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_page_map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>envid_t<span class="token punctuation">)</span>a1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>a2<span class="token punctuation">,</span> <span class="token punctuation">(</span>envid_t<span class="token punctuation">)</span>a3<span class="token punctuation">,</span> 
			                    <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>a4<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a5<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_page_unmap<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_page_unmap</span><span class="token punctuation">(</span><span class="token punctuation">(</span>envid_t<span class="token punctuation">)</span>a1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_exofork<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_exofork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> SYS_env_set_status<span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token function">sys_env_set_status</span><span class="token punctuation">(</span><span class="token punctuation">(</span>envid_t<span class="token punctuation">)</span>a1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>a2<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽå°±å¯ä»¥è¿è¡Œ<code class="language-text">make grade</code>äº†ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> grade
<span class="token punctuation">..</span>.
dumbfork: OK <span class="token punctuation">(</span>1.1s<span class="token punctuation">)</span>
Part A score: 5/5</code></pre></div>
<h2>Part B: Copy-on-Write Fork</h2>
<p>xv6ä¸­å®žçŽ°çš„<code class="language-text">fork()</code>å°±æ˜¯åŸºæœ¬ä¸Šå’Œ<code class="language-text">dumbfork()</code>ä¸€æ ·çš„ï¼ŒæŠŠparentçš„address spaceå¤åˆ¶åˆ°childã€‚è€Œè¿™ä¸ªèµ‹å€¼æ“ä½œä¹Ÿå°±æ˜¯<code class="language-text">fork</code>å¼€é”€æœ€å¤§çš„åœ°æ–¹ã€‚</p>
<p>ç„¶è€Œï¼Œå¾ˆå¤šæ—¶å€™<code class="language-text">fork</code>åŽé¢éƒ½ç›´æŽ¥ä¼šè·Ÿç€<code class="language-text">exec</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤åˆ¶å°±æ˜¾å¾—å¾ˆæµªè´¹äº†ã€‚</p>
<p>åŸºäºŽè¿™ä¸ªåŽŸå› ï¼ŒUnixçš„åŽç»­ç‰ˆæœ¬åˆ©ç”¨virtual memory hardwareæ¥å…è®¸parentå’Œchildå…±äº«å†…å­˜ï¼Œç›´åˆ°æŸä¸€ä¸ªè¿›è¡Œä¿®æ”¹å†…å­˜ã€‚è¿™ä¸ªæŠ€æœ¯è¢«ç§°ä¸º<em>copy-on-write</em>ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œ<code class="language-text">fork</code>çš„æ—¶å€™ç³»ç»Ÿå¤åˆ¶çš„æ—¶å€™address space <em>mappings</em> è€Œä¸æ˜¯pageé‡Œå…·ä½“çš„å†…å®¹ï¼Œå¹¶æ ‡è®°è¿™äº›pageä¸ºread-onlyã€‚å½“ä»»æ„ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œå†™å…¥çš„æ—¶å€™å°±ä¼šè§¦å‘page faultï¼Œè¿™æ—¶åœ¨ç»™è¿™ä¸ªå‡ºå‘äº†faultçš„è¿›ç¨‹åˆ†é…ä¸€ä¸ªnew, private, writable copy of the pageã€‚è¿™æ ·ç›´åˆ°å†™å…¥æ‰ä¼šçœŸæ­£è¿›è¡Œå¤åˆ¶ï¼Œä»Žè€Œä½¿å¾—<code class="language-text">fork</code>ä¹‹åŽç›´æŽ¥<code class="language-text">exec</code>çš„å¼€é”€å°äº†å¾ˆå¤šï¼šchildå¾ˆå¯èƒ½åªéœ€è¦å¤åˆ¶1ä¸ªpageï¼ˆthe current page of its stackï¼Œè¿™ä¸ªæ²¡æ˜Žç™½...ï¼‰</p>
<p>æˆ‘ä»¬æŽ¥ä¸‹æ¥å°±æ¥å®žçŽ°<em>copy-on-wirte</em> <code class="language-text">fork</code>ã€‚</p>
<h3>User-level page fault handling</h3>
<p>ä¸€ä¸ªuser-level copy-on-write <code class="language-text">fork</code>éœ€è¦èŽ·å–åœ¨write-protected pagesä¸Šçš„page faultsã€‚æ³¨æ„copy-on-writeåªæ˜¯user-level page fault handlingçš„ä¼—å¤šåº”ç”¨ä¹‹ä¸€ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªaddress spaceç„¶åŽç”¨page faultsæ¥è¿›è¡ŒåŽç»­æ“ä½œæ˜¯éžå¸¸å¸¸è§çš„ã€‚å¦‚å¤§å¤šæ•°Unix kernelæœ€å¼€å§‹éƒ½åªä¼šåˆ†é…1ä¸ªpageä½œä¸ºstackï¼Œä¹‹åŽéšç€éœ€æ±‚å†æ‰©å¢žï¼ˆlazy allocationï¼‰ã€‚ä¸€ä¸ªå…¸åž‹çš„Unix kerneléœ€è¦keep track of what action to take when a page fault occers in each <em>region</em> of a process's space.æ¯”å¦‚è¯´ï¼Œå†stackè§¦æ³•çš„ä¸€èˆ¬ä¼šéœ€è¦åˆ†é…å¹¶æ˜ å°„ä¸€ä¸ªæ–°çš„physical pageï¼Œåœ¨BSSï¼ˆå­˜å‚¨æœªåˆå§‹åŒ–å…¨å±€å˜é‡çš„segmentï¼‰ä¸­çš„å¾€å¾€éœ€è¦åˆ†é…ä¸€ä¸ªæ–°çš„pageï¼Œå…¨éƒ¨å¡«å……ä¸º0ï¼Œç„¶åŽå†æ˜ å°„ã€‚åœ¨ystem with demand-paged executablesï¼ˆè¿™å•¥...ï¼‰ï¼Œåœ¨text regionè§¦æ³•çš„ä¼šä»Žç¡¬ç›˜è¯»å…¥å¯¹åº”pageçš„binaryï¼Œå¹¶è¿›è¡Œæ˜ å°„ã€‚</p>
<p>kerneléœ€è¦trackå¾ˆå¤šä¿¡æ¯ã€‚äºŽå…¶é‡‡ç”¨ä¼ ç»ŸUnixçš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°†åœ¨user spaceé‡Œé¢å†³å®šä¸åŒçš„page faultè¦åšä»€ä¹ˆï¼Œè¿™æ ·bugs are less damagingã€‚è¿™ç§è®¾è®¡è®©åº”ç”¨å®šä¹‰å…¶å†…å­˜åŒºåŸŸçš„è‡ªåŠ¨åº¦æ›´å¤§äº†ï¼šæˆ‘ä»¬å°†åœ¨åŽç»­çš„disk-based file systemä¸­ä½¿ç”¨user-level page fault handlingã€‚</p>
<h3>Setting the Page Fault Handler</h3>
<p>ä¸ºäº†handleè‡ªå·±çš„page faultï¼Œä¸€ä¸ªç”¨æˆ·çŽ¯å¢ƒéœ€è¦åœ¨JOS kernelä¸­æ³¨å†Œä¸€ä¸ª<em>page fault handler entrypoint</em>ã€‚ç”¨æˆ·çŽ¯å¢ƒä¼šç”¨<code class="language-text">sys_env_set_pgfault_upcall</code>è¿™ä¸ªsystem callæ¥æ³¨å†Œå…¶page fault entrypointã€‚æˆ‘ä»¬å·²ç»åœ¨<code class="language-text">Env</code>ä¸­åŠ å…¥äº†<code class="language-text">env_pgfault_upcall</code>æ¥è¿›è¡Œè®°å½•äº†ã€‚</p>
<h3>Exercise 8</h3>
<p>å®žçŽ°<code class="language-text">sys_env_set_pgfault_upcall</code>ã€‚æ³¨æ„åœ¨æŸ¥è¯¢environment idçš„æ—¶å€™è¦è¿›è¡Œpermission checking(å¯¹åº”å‚æ•°è®¾ä¸º1)ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªå¾ˆå±é™©çš„system callã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Set the page fault upcall for 'envid' by modifying the corresponding struct</span>
<span class="token comment">// Env's 'env_pgfault_upcall' field.  When 'envid' causes a page fault, the</span>
<span class="token comment">// kernel will push a fault record onto the exception stack, then branch to</span>
<span class="token comment">// 'func'.</span>
<span class="token comment">//</span>
<span class="token comment">// Returns 0 on success, &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_BAD_ENV if environment envid doesn't currently exist,</span>
<span class="token comment">//		or the caller doesn't have permission to change envid.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_env_set_pgfault_upcall</span><span class="token punctuation">(</span>envid_t envid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>func<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_pgfault_upcall <span class="token operator">=</span> func<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_env_set_pgfault_upcall not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>Normal and Exception Stacks in User Environments</h3>
<p>åœ¨æ­£å¸¸(normal)çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒJOSçš„ä¸€ä¸ªç”¨æˆ·çŽ¯å¢ƒä¼šæ­£å¸¸åœ°è¿è¡Œåœ¨user stackä¸Šï¼šå…¶<code class="language-text">ESP</code>å¯„å­˜å™¨æœ€å¼€å§‹ä¼šä¸º<code class="language-text">USTACKTOP</code>ï¼Œä¸”å…¶æ ˆçš„æ•°æ®ä¼šåœ¨<code class="language-text">USTACKTOP-PGSIZE</code>å’Œ<code class="language-text">USTACKTOP-1</code>ä¹‹é—´ã€‚ç„¶è€Œï¼Œå½“å‘ç”Ÿäº†page faultçš„æ—¶å€™ï¼Œkernelä¼šé‡å¯ç”¨æˆ·çŽ¯å¢ƒï¼Œè®©å…¶è¿è¡Œa designated user-level page fault handleråœ¨ä¸€ä¸ªä¸åŒçš„stackä¸Šâ€”â€”<em>user exception</em> stackã€‚æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è®©JOSä»£è¡¨ç”¨æˆ·çŽ¯å¢ƒå®žçŽ°è¿™ä¸ªè‡ªåŠ¨çš„"stack switch"ï¼Œå’Œx86å¤„ç†å™¨ä»£è¡¨JOSä»Žuser modeè½¬æ¢åˆ°kernel modeä¸€æ ·ã€‚</p>
<p>JOSçš„user exception stackä¹Ÿæ˜¯1 pageå¤§ï¼Œåœ¨<code class="language-text">UXSTACKTOP-PGSIZE</code>å’Œ<code class="language-text">USTACKTOP-1</code>ä¹‹é—´ã€‚å½“åœ¨è¿™ä¸ªæ ˆä¸Šè¿è¡Œçš„æ—¶å€™ï¼Œuser-level page fault handlerå¯ä»¥ç”¨JOSçš„regular system callæ¥æ˜ å°„æ–°pageæˆ–è§£å†³page faultå¯¹åº”çš„é—®é¢˜ã€‚ç„¶åŽé€šè¿‡ä¸€ä¸ªassemble language stubï¼Œuser-level page fault handler è¿”å›žåˆ°origin stackçš„é”™è¯¯ä»£ç å¤„ã€‚</p>
<p>æ¯ä¸ªæƒ³è¦æ”¯æŒuser-level page fault handlingçš„ç”¨æˆ·çŽ¯å¢ƒéƒ½éœ€è¦ä½¿ç”¨<code class="language-text">sys-page_alloc()</code>æ¥ç»™å…¶exception stackåˆ†é…å†…å­˜ã€‚</p>
<h3>Invoking the User Page Fault Handler</h3>
<p>æˆ‘ä»¬å°†éœ€è¦æ”¹å˜<code class="language-text">kern/trap.c</code>ä¸­çš„page fault handling codeä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹æ³•åœ¨user modeå¤„ç†page faultã€‚æˆ‘ä»¬å°†æŠŠfaultå‡ºçŽ°äº†æ—¶å€™çš„ç”¨æˆ·çŽ¯å¢ƒçš„çŠ¶æ€ç§°ä¸º<em>trap-time</em> stateã€‚</p>
<p>å¦‚æžœæ²¡æœ‰æ³¨å†Œpage fault handlerï¼ŒJOSä¼šå’Œä»¥å‰ä¸€æ ·destroy the user environmentã€‚å¦‚è‹¥ä¸ç„¶ï¼Œkernelä¼šåœ¨exception stackä¸Šåˆ›å»ºä¸€ä¸ªç±»ä¼¼äºŽ<code class="language-text">inc/trap.h</code>ä¸­çš„<code class="language-text">struct UTrapframe</code>çš„trap frameã€‚</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">                    &lt;-- UXSTACKTOP
trap-time esp
trap-time eflags
trap-time eip
trap-time eax       start of struct PushRegs
trap-time ecx
trap-time edx
trap-time ebx
trap-time esp
trap-time ebp
trap-time esi
trap-time edi       end of struct PushRegs
tf_err (error code)
fault_va            &lt;-- %esp when handler is run</code></pre></div>
<p><code class="language-text">UTrapframe</code>çš„ç»“æž„å¦‚ä¸‹ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token punctuation">{</span>
	<span class="token comment">/* information about the fault */</span>
	uint32_t utf_fault_va<span class="token punctuation">;</span>	<span class="token comment">/* va for T_PGFLT, 0 otherwise */</span>
	uint32_t utf_err<span class="token punctuation">;</span>
	<span class="token comment">/* trap-time return state */</span>
	<span class="token keyword">struct</span> <span class="token class-name">PushRegs</span> utf_regs<span class="token punctuation">;</span>
	uintptr_t utf_eip<span class="token punctuation">;</span>
	uint32_t utf_eflags<span class="token punctuation">;</span>
	<span class="token comment">/* the trap-time stack to return to */</span>
	uintptr_t utf_esp<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token function">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>packed<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>kernelä¹‹åŽä¼šç”¨è¿™ä¸ªstackå’Œpage fault handleræ¥è®©user environmentç»§ç»­è¿è¡Œã€‚æ³¨æ„ï¼Œ<code class="language-text">fault_va</code>å°±æ˜¯å‡ºäº†é”™è¯¯çš„VAã€‚</p>
<p>å¦‚æžœç”¨æˆ·çŽ¯å¢ƒå·²ç»è¿è¡Œåœ¨exception stackçš„æƒ…å†µä¸‹å‡ºçŽ°äº†è¦ç»™exceptionï¼Œé‚£ä¹ˆè¯´æ˜Žpage fault handlerå‡ºé”™äº†ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šåœ¨çŽ°åœ¨çš„<code class="language-text">tf-&gt;tf_esp</code>ä¸‹é‡æ–°åˆ›å»ºä¸€ä¸ªstack frameã€‚æˆ‘ä»¬éœ€è¦å…ˆæ”¾å…¥ä¸€ä¸ªç©ºçš„32-bit wordï¼Œç„¶åŽåˆ›å»ºä¸€ä¸ª<code class="language-text">struct UTrapframe</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥<code class="language-text">tf-&gt;tf_esp</code>æ˜¯å¦åœ¨<code class="language-text">UXSTACKTOP-PGSIZE</code>å’Œ<code class="language-text">USTACKTOP-1</code>ä¹‹é—´æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å·²ç»åœ¨exception stackä¸Šäº†ã€‚</p>
<h3>Exercise 9</h3>
<p>å®žçŽ°<code class="language-text">kern/trap.c</code>ä¸­çš„<code class="language-text">page_fault_handler</code>ã€‚å¦‚æžœexception stack runs out of spaceäº†æ€Žä¹ˆåŠžï¼Ÿ</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span>
<span class="token function">page_fault_handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">Trapframe</span> <span class="token operator">*</span>tf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	uint32_t fault_va<span class="token punctuation">;</span>

	<span class="token comment">// Read processor's CR2 register to find the faulting address</span>
	fault_va <span class="token operator">=</span> <span class="token function">rcr2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Handle kernel-mode page faults.</span>

	<span class="token comment">// LAB 3: Your code here.</span>

	<span class="token comment">// We've already handled kernel-mode exceptions, so if we get here,</span>
	<span class="token comment">// the page fault happened in user mode.</span>

	<span class="token comment">// Call the environment's page fault upcall, if one exists.  Set up a</span>
	<span class="token comment">// page fault stack frame on the user exception stack (below</span>
	<span class="token comment">// UXSTACKTOP), then branch to curenv->env_pgfault_upcall.</span>
	<span class="token comment">//</span>
	<span class="token comment">// The page fault upcall might cause another page fault, in which case</span>
	<span class="token comment">// we branch to the page fault upcall recursively, pushing another</span>
	<span class="token comment">// page fault stack frame on top of the user exception stack.</span>
	<span class="token comment">//</span>
	<span class="token comment">// It is convenient for our code which returns from a page fault</span>
	<span class="token comment">// (lib/pfentry.S) to have one word of scratch space at the top of the</span>
	<span class="token comment">// trap-time stack; it allows us to more easily restore the eip/esp. In</span>
	<span class="token comment">// the non-recursive case, we don't have to worry about this because</span>
	<span class="token comment">// the top of the regular user stack is free.  In the recursive case,</span>
	<span class="token comment">// this means we have to leave an extra word between the current top of</span>
	<span class="token comment">// the exception stack and the new stack frame because the exception</span>
	<span class="token comment">// stack _is_ the trap-time stack.</span>
	<span class="token comment">//</span>
	<span class="token comment">// If there's no page fault upcall, the environment didn't allocate a</span>
	<span class="token comment">// page for its exception stack or can't write to it, or the exception</span>
	<span class="token comment">// stack overflows, then destroy the environment that caused the fault.</span>
	<span class="token comment">// Note that the grade script assumes you will first check for the page</span>
	<span class="token comment">// fault upcall and print the "user fault va" message below if there is</span>
	<span class="token comment">// none.  The remaining three checks can be combined into a single test.</span>
	<span class="token comment">//</span>
	<span class="token comment">// Hints:</span>
	<span class="token comment">//   user_mem_assert() and env_run() are useful here.</span>
	<span class="token comment">//   To change what the user environment runs, modify 'curenv->env_tf'</span>
	<span class="token comment">//   (the 'tf' variable points at 'curenv->env_tf').</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	bool flag <span class="token operator">=</span> true<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>curenv<span class="token operator">-></span>env_pgfault_upcall <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		flag <span class="token operator">=</span> false<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fault_va <span class="token operator">&lt;</span> UXSTACKTOP <span class="token operator">&amp;&amp;</span> fault_va <span class="token operator">>=</span> UXSTACKTOP <span class="token operator">-</span> PGSIZE<span class="token punctuation">)</span>
		flag <span class="token operator">=</span> false<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// this makes sure it's from user mode</span>
		<span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span>utf <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>curenv<span class="token operator">-></span>env_tf<span class="token punctuation">.</span>tf_esp <span class="token operator">&lt;</span> UXSTACKTOP <span class="token operator">&amp;&amp;</span> curenv<span class="token operator">-></span>env_tf<span class="token punctuation">.</span>tf_esp <span class="token operator">>=</span> UXSTACKTOP <span class="token operator">-</span> PGSIZE<span class="token punctuation">)</span>
			utf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>curenv<span class="token operator">-></span>env_tf<span class="token punctuation">.</span>tf_esp <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			utf <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UXSTACKTOP <span class="token operator">-</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// check the overflow and write permission</span>
		<span class="token function">user_mem_assert</span><span class="token punctuation">(</span>curenv<span class="token punctuation">,</span> utf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PTE_W<span class="token punctuation">)</span><span class="token punctuation">;</span>

		utf<span class="token operator">-></span>utf_fault_va <span class="token operator">=</span> fault_va<span class="token punctuation">;</span>
		utf<span class="token operator">-></span>utf_err <span class="token operator">=</span> tf<span class="token operator">-></span>tf_err<span class="token punctuation">;</span>
		utf<span class="token operator">-></span>utf_regs <span class="token operator">=</span> tf<span class="token operator">-></span>tf_regs<span class="token punctuation">;</span>
		utf<span class="token operator">-></span>utf_eip <span class="token operator">=</span> tf<span class="token operator">-></span>tf_eip<span class="token punctuation">;</span>
		utf<span class="token operator">-></span>utf_eflags <span class="token operator">=</span> tf<span class="token operator">-></span>tf_eflags<span class="token punctuation">;</span>
		utf<span class="token operator">-></span>utf_esp <span class="token operator">=</span> tf<span class="token operator">-></span>tf_esp<span class="token punctuation">;</span>
		tf<span class="token operator">-></span>tf_eip <span class="token operator">=</span> <span class="token punctuation">(</span>uintptr_t<span class="token punctuation">)</span>curenv<span class="token operator">-></span>env_pgfault_upcall<span class="token punctuation">;</span>
		tf<span class="token operator">-></span>tf_esp <span class="token operator">=</span> <span class="token punctuation">(</span>uintptr_t<span class="token punctuation">)</span>utf<span class="token punctuation">;</span>
		<span class="token function">env_run</span><span class="token punctuation">(</span>curenv<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Destroy the environment that caused the fault.</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"[%08x] user fault va %08x ip %08x\n"</span><span class="token punctuation">,</span>
		curenv<span class="token operator">-></span>env_id<span class="token punctuation">,</span> fault_va<span class="token punctuation">,</span> tf<span class="token operator">-></span>tf_eip<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">print_trapframe</span><span class="token punctuation">(</span>tf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">env_destroy</span><span class="token punctuation">(</span>curenv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h3>User-mode Page Fault Entrypoint</h3>
<p>Next, you need to implement the assembly routine that will take care of calling the C page fault handler and resume execution at the original faulting instruction. This assembly routine is the handler that will be registered with the kernel using <code class="language-text">sys_env_set_pgfault_upcall()</code>.</p>
<h3>Exercise 10</h3>
<p>å®žçŽ°<code class="language-text">lib/pfentry.S</code>ä¸­çš„<code class="language-text">_pgfault_upcall</code>ã€‚</p>
<div class="gatsby-highlight" data-language="assembly"><pre class="language-assembly"><code class="language-assembly">.text
.globl _pgfault_upcall
_pgfault_upcall:
	// Call the C page fault handler.
	pushl %esp			// function argument: pointer to UTF
	movl _pgfault_handler, %eax
	call *%eax
	addl $4, %esp			// pop function argument
	
	// Now the C page fault handler has returned and you must return
	// to the trap time state.
	// Push trap-time %eip onto the trap-time stack.
	//
	// Explanation:
	//   We must prepare the trap-time stack for our eventual return to
	//   re-execute the instruction that faulted.
	//   Unfortunately, we can&#39;t return directly from the exception stack:
	//   We can&#39;t call &#39;jmp&#39;, since that requires that we load the address
	//   into a register, and all registers must have their trap-time
	//   values after the return.
	//   We can&#39;t call &#39;ret&#39; from the exception stack either, since if we
	//   did, %esp would have the wrong value.
	//   So instead, we push the trap-time %eip onto the *trap-time* stack!
	//   Below we&#39;ll switch to that stack and call &#39;ret&#39;, which will
	//   restore %eip to its pre-fault value.
	//
	//   In the case of a recursive fault on the exception stack,
	//   note that the word we&#39;re pushing now will fit in the
	//   blank word that the kernel reserved for us.
	//
	// Throughout the remaining code, think carefully about what
	// registers are available for intermediate calculations.  You
	// may find that you have to rearrange your code in non-obvious
	// ways as registers become unavailable as scratch space.
	//
	// LAB 4: Your code here.
	movl 0x28(%esp), %edx # trap-time eip
	subl $0x4, 0x30(%esp) # we have to use subl now because we can&#39;t use after popfl
	movl 0x30(%esp), %eax # trap-time esp-4
	movl %edx, (%eax)
	addl $0x8, %esp

	// Restore the trap-time registers.  After you do this, you
	// can no longer modify any general-purpose registers.
	// LAB 4: Your code here.
	popal

	// Restore eflags from the stack.  After you do this, you can
	// no longer use arithmetic operations or anything else that
	// modifies eflags.
	// LAB 4: Your code here.
	addl $0x4, %esp #eip
	popfl

	// Switch back to the adjusted trap-time stack.
	// LAB 4: Your code here.
	popl %esp

	// Return to re-execute the instruction that faulted.
	// LAB 4: Your code here.
	ret</code></pre></div>
<p>ç„¶åŽæ˜¯å®Œæˆ<code class="language-text">lib/pgfault.c</code>ä¸­çš„<code class="language-text">set_pgfault_handler()</code></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">//</span>
<span class="token comment">// Set the page fault handler function.</span>
<span class="token comment">// If there isn't one yet, _pgfault_handler will be 0.</span>
<span class="token comment">// The first time we register a handler, we need to</span>
<span class="token comment">// allocate an exception stack (one page of memory with its top</span>
<span class="token comment">// at UXSTACKTOP), and tell the kernel to call the assembly-language</span>
<span class="token comment">// _pgfault_upcall routine when a page fault occurs.</span>
<span class="token comment">//</span>
<span class="token keyword">void</span>
<span class="token function">set_pgfault_handler</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span>utf<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>_pgfault_handler <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// First time through!</span>
		<span class="token comment">// LAB 4: Your code here.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_alloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UXSTACKTOP <span class="token operator">-</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> PTE_W <span class="token operator">|</span> PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"fail to allocate exception stack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sys_env_set_pgfault_upcall</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> _pgfault_upcall<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//panic("set_pgfault_handler not implemented");</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Save handler pointer for assembly to call.</span>
	_pgfault_handler <span class="token operator">=</span> handler<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽå°±æ˜¯è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬æ¥ä¸€æ¬¡çœ‹è¿™äº›ä¸ªæµ‹è¯•æ ·ä¾‹ã€‚</p>
<p>é¦–å…ˆæ˜¯<code class="language-text">user_faultread</code>:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span>
<span class="token function">umain</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"I read %08x from location 0!\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å•çº¯çš„å°±æ˜¯è®¿é—®äº†ä¸€ä¸ªæ²¡æœ‰è¢«åˆ†é…çš„å†…å­˜ï¼Œæ²¡æœ‰è®¾ç½®<code class="language-text">_pgfault_upcall</code>ï¼Œæ‰€ä»¥ç›´æŽ¥destroyï¼Œè¾“å‡ºä¸ºï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> run-faultread-nox
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> user fault va 00000000 <span class="token function">ip</span> 00800039
TRAP frame at 0xf02b0000 from CPU 0
  edi  0x00000000
  esi  0x00000000
  ebp  0xeebfdfd0
  oesp 0xf0235fdc
  ebx  0x00000000
  edx  0x00000000
  ecx  0x00000000
  eax  0xeec00000
  es   0x----0023
  ds   0x----0023
  <span class="token function">trap</span> 0x0000000e Page Fault
  cr2  0x00000000
  err  0x00000004 <span class="token punctuation">[</span>user, read, not-present<span class="token punctuation">]</span>
  eip  0x00800039
  cs   0x----001b
  flag 0x00000086
  esp  0xeebfdfc0
  ss   0x----0023
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
No runnable environments <span class="token keyword">in</span> the system<span class="token operator">!</span>
<span class="token punctuation">..</span>.</code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">user_faultdie</code>:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span>
<span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span>utf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>utf<span class="token operator">-></span>utf_fault_va<span class="token punctuation">;</span>
	uint32_t err <span class="token operator">=</span> utf<span class="token operator">-></span>utf_err<span class="token punctuation">;</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"i faulted at va %x, err %x\n"</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> err <span class="token operator">&amp;</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_env_destroy</span><span class="token punctuation">(</span><span class="token function">sys_getenvid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span>
<span class="token function">umain</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">set_pgfault_handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0xDeadBeef</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ä¼šè¾“å‡ºé”™è¯¯åœ°å€ä¸Žé”™è¯¯ä¿¡æ¯ï¼Œç„¶åŽdestroyã€‚æ‰€ä»¥ç»“æžœæ˜¯ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> run-faultdie-nox
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
i faulted at va deadbeef, err 6
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
No runnable environments <span class="token keyword">in</span> the system<span class="token operator">!</span>
<span class="token punctuation">..</span>.</code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">user_faultalloc</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span>
<span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span>utf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>utf<span class="token operator">-></span>utf_fault_va<span class="token punctuation">;</span>

	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"fault %x\n"</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_alloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">,</span>
				PTE_P<span class="token operator">|</span>PTE_U<span class="token operator">|</span>PTE_W<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"allocating at %x in page fault handler: %e"</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span> addr<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"this string was faulted in at %x"</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span>
<span class="token function">umain</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">set_pgfault_handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0xDeadBeef</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0xCafeBffe</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œå°è¯•åˆ†é…ä¸€ä¸ªpageï¼Œç„¶åŽè¾“å‡ºå‡ºé”™çš„ä½ç½®ã€‚<code class="language-text">snprintf</code>æ˜¯æŠŠå­—ç¬¦ä¸²å­˜åœ¨å¯¹åº”åœ°å€ç”¨çš„ã€‚æ‰€ä»¥è¾“å‡ºç»“æžœä¸ºï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> run-faultalloc-nox
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
fault deadbeef
this string was faulted <span class="token keyword">in</span> at deadbeef
fault cafebffe
fault cafec000
this string was faulted <span class="token keyword">in</span> at cafebffe
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
No runnable environments <span class="token keyword">in</span> the system<span class="token operator">!</span>
<span class="token punctuation">..</span>.</code></pre></div>
<p>ç»è¿‡æµ‹è¯•å¯ä»¥çŸ¥é“æ˜¯åœ¨è¿›è¡Œç¬¬äºŒæ¬¡<code class="language-text">snprintf</code>çš„æ—¶å€™åœ¨exception stacké‡Œé¢åˆè§¦å‘äº†ä¸­æ–­ã€‚è¿™æ˜¯å› ä¸ºåˆ†é…çš„bufferæ˜¯100 byteï¼Œè€Œ<code class="language-text">0xcafebffe + 100</code>å·²ç»åˆ°äº†ä¸‹ä¸€ä¸ªpageäº†ï¼Œæ‰€ä»¥å°±éœ€è¦å†è¿›è¡Œä¸€æ¬¡åˆ†é…ã€‚</p>
<p>æœ€åŽæ˜¯<code class="language-text">user_faultallocbad</code></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span>
<span class="token function">handler</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span>utf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>utf<span class="token operator">-></span>utf_fault_va<span class="token punctuation">;</span>

	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"fault %x\n"</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_alloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">,</span>
				PTE_P<span class="token operator">|</span>PTE_U<span class="token operator">|</span>PTE_W<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"allocating at %x in page fault handler: %e"</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span> addr<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"this string was faulted in at %x"</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span>
<span class="token function">umain</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">set_pgfault_handler</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_cputs</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0xDEADBEEF</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ³¨æ„å’Œä¸Šé¢çš„åŒºåˆ«æ˜¯æ²¡æœ‰ä½¿ç”¨<code class="language-text">cprintf</code>ï¼Œè€Œæ˜¯è°ƒç”¨äº†<code class="language-text">sys_cputs</code>è¿™ä¸€system callã€‚</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ make run-faultallocbad-nox
...
[00000000] new env 00001000
[00001000] user_mem_check assertion failure for va deadbeef
[00001000] free env 00001000
No runnable environments in the system!
...</code></pre></div>
<p>ç”¨<code class="language-text">cprintf</code>å’Œ<code class="language-text">sys_cputs</code>çš„åŒºåˆ«åœ¨äºŽï¼Œ<code class="language-text">cprintf</code>å†å®žçŽ°çš„æ—¶å€™å…ˆä½¿ç”¨äº†user libä¸­çš„<code class="language-text">vprintfmt</code>ï¼Œ<code class="language-text">vprintfmt</code>ä¼šè®¿é—®<code class="language-text">0xdeadbeef</code>é‡Œé¢å­˜å‚¨çš„å†…å®¹ï¼ˆæŠŠå†…å®¹å¤åˆ¶åˆ°bufferä¸­ï¼‰ï¼Œä»Žè€Œåœ¨åœ¨user modeè§¦æ³•page faultã€‚è€Œç›´æŽ¥è°ƒç”¨<code class="language-text">sys_cputs</code>ä¼šåœ¨è§¦æ³•page faultä¹‹å‰è§¦æ³•system callï¼Œç„¶åŽåœ¨<code class="language-text">sys_cputs</code>é‡Œé¢çš„<code class="language-text">user_mem_assert</code>ä¼šå‘çŽ°è¿™ä¸ªåœ°å€ä¸èƒ½è®¿é—®ï¼Œä»Žè€Œå¯¼è‡´destroyã€‚</p>
<h3>Implementing Copy-on-Write Fork</h3>
<p>çŽ°åœ¨æˆ‘ä»¬æ¥å®žçŽ°copy-on-write forkã€‚å…¶ä»£ç åœ¨<code class="language-text">lib/fork.c</code>ï¼Œä¸»è¦çš„æŽ§åˆ¶æµå¦‚ä¸‹ï¼š</p>
<ol>
<li>parentæŠŠ<code class="language-text">pgfault()</code>ä½œä¸ºpage fault handler</li>
<li>parentè°ƒç”¨<code class="language-text">set_exofork</code>æ¥åˆ›å»ºä¸€ä¸ªchild environment</li>
<li>
<p>å¯¹äºŽæ¯ä¸ªåœ¨<code class="language-text">UTOP</code>ä¹‹ä¸‹çš„writableæˆ–æ˜¯copy-on-write pageï¼Œparentè°ƒç”¨<code class="language-text">duppage</code>ã€‚å…¶ä¼šmapè¿™ä¸ªpageåˆ°childçš„å¯¹åº”ä½ç½®ï¼Œç„¶åŽå†mapåˆ°è‡ªå·±çš„ä½ç½®ï¼Œåªä¸è¿‡æ˜¯æŠŠæƒé™æ”¹ä¸ºcopy-on-writeã€‚ç”¨<code class="language-text">PTE_COW</code>è¡¨ç¤ºcopy-on-write pageã€‚</p>
<p>exception stackä¸ä¼šè¿™æ ·mapï¼Œchildéœ€è¦é‡æ–°åˆ†é…ä¸€ä¸ªæ–°çš„pageä½œä¸ºexception stackï¼Œä¸ç„¶å°±æ²¡æ³•æ­£å¸¸è¿è¡Œpage fault handleräº†ã€‚</p>
</li>
<li>parenté‡æ–°ä¸ºchildè®¾ç½®page fault entry point</li>
<li>æˆªæ­¢åˆ°è¿™ä¸ªæ—¶å€™ï¼Œchildå·²ç»å¯ä»¥è¿è¡Œäº†ï¼Œæ‰€ä»¥parentæŠŠchildè®¾ç½®ä¸º<code class="language-text">ENV_RUNNABLE</code></li>
</ol>
<p>æ¯æ¬¡ä¸€ä¸ªçŽ¯å¢ƒè®¿é—®è¦å‘ä¸€ä¸ªcopy-on-write pageå†™å…¥çš„æ—¶å€™å°±ä¼šè§¦æ³•page fault handlerï¼Œå…¶æŽ§åˆ¶æµå¦‚ä¸‹ï¼š</p>
<ol>
<li>kernelé€šè¿‡<code class="language-text">_pgfault_upcall</code>è°ƒç”¨<code class="language-text">pgfault()</code></li>
<li><code class="language-text">pgfault</code>æ£€æŸ¥page faultæ˜¯å¦ä¸ºä¸€ä¸ªå†™å…¥ï¼Œä»¥åŠpageæ˜¯<code class="language-text">PTE_COW</code></li>
<li><code class="language-text">pgfault</code>çŽ°åœ¨ä¸€ä¸ªä¸´æ—¶çš„åœ°æ–¹åˆ†é…ä¸€ä¸ªæ–°çš„pageï¼Œç„¶åŽæŠŠéœ€è¦å†™å…¥çš„pageçš„å†…å®¹å¤åˆ¶åˆ°è¿™ä¸ªä¸´æ—¶çš„pageä¸­ï¼Œç„¶åŽåœ¨æŠŠä¸´æ—¶page mapåˆ°å¯¹åº”çš„ä½ç½®ï¼Œç»™äºˆread/writeæƒé™ã€‚æœ€åŽunmapè¿™ä¸ªä¸´æ—¶çš„åœ°æ–¹ã€‚</li>
</ol>
<h3>Exercise 12</h3>
<p>æŒ‰ç…§ä¸Šè¿°çš„æµç¨‹è¡¥å…¨<code class="language-text">lib/fork.c</code>ã€‚</p>
<p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼Œå…¶ä¸­å¤§é‡å‚è€ƒäº†<code class="language-text">dumbfork</code>ï¼Œå°¤å…¶æ˜¯<code class="language-text">pgfault</code>ï¼Œå®žé™…ä¸Šå’Œ<code class="language-text">dumbfork</code>åšçš„äº‹æƒ…ä¸€æ ·ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// implement fork from user space</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;inc/string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;inc/lib.h></span></span>

<span class="token comment">// PTE_COW marks copy-on-write page table entries.</span>
<span class="token comment">// It is one of the bits explicitly allocated to user processes (PTE_AVAIL).</span>
<span class="token macro property">#<span class="token directive keyword">define</span> PTE_COW		0x800</span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">_pgfault_upcall</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//</span>
<span class="token comment">// Custom page fault handler - if faulting page is copy-on-write,</span>
<span class="token comment">// map in our own private writable copy.</span>
<span class="token comment">//</span>
<span class="token keyword">static</span> <span class="token keyword">void</span>
<span class="token function">pgfault</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">UTrapframe</span> <span class="token operator">*</span>utf<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> utf<span class="token operator">-></span>utf_fault_va<span class="token punctuation">;</span>
	uint32_t err <span class="token operator">=</span> utf<span class="token operator">-></span>utf_err<span class="token punctuation">;</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>

	<span class="token comment">// Check that the faulting access was (1) a write, and (2) to a</span>
	<span class="token comment">// copy-on-write page.  If not, panic.</span>
	<span class="token comment">// Hint:</span>
	<span class="token comment">//   Use the read-only page table mappings at uvpt</span>
	<span class="token comment">//   (see &lt;inc/memlayout.h>).</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err <span class="token operator">&amp;</span> FEC_WR<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	     <span class="token punctuation">(</span>uvpd<span class="token punctuation">[</span><span class="token function">PDX</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
		   <span class="token punctuation">(</span>uvpt<span class="token punctuation">[</span><span class="token function">PGNUM</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
		   <span class="token punctuation">(</span>uvpt<span class="token punctuation">[</span><span class="token function">PGNUM</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> PTE_COW<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"fault not on copy-on-write"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Allocate a new page, map it at a temporary location (PFTEMP),</span>
	<span class="token comment">// copy the data from the old page to the new page, then move the new</span>
	<span class="token comment">// page to the old page's address.</span>
	<span class="token comment">// Hint:</span>
	<span class="token comment">//   You should make three system calls.</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	addr <span class="token operator">=</span> <span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_alloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> PFTEMP<span class="token punctuation">,</span> PTE_W <span class="token operator">|</span> PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"fail to alloc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memmove</span><span class="token punctuation">(</span>PFTEMP<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> PFTEMP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> PTE_W <span class="token operator">|</span> PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"fail to map"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_unmap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> PFTEMP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"fail to umap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("pgfault not implemented");</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token comment">// Map our virtual page pn (address pn*PGSIZE) into the target envid</span>
<span class="token comment">// at the same virtual address.  If the page is writable or copy-on-write,</span>
<span class="token comment">// the new mapping must be created copy-on-write, and then our mapping must be</span>
<span class="token comment">// marked copy-on-write as well.  (Exercise: Why do we need to mark ours</span>
<span class="token comment">// copy-on-write again if it was already copy-on-write at the beginning of</span>
<span class="token comment">// this function?)</span>
<span class="token comment">//</span>
<span class="token comment">// Returns: 0 on success, &lt; 0 on error.</span>
<span class="token comment">// It is also OK to panic on error.</span>
<span class="token comment">//</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">duppage</span><span class="token punctuation">(</span>envid_t envid<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> pn<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>

	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>addr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>pn <span class="token operator">*</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>uvpd<span class="token punctuation">[</span><span class="token function">PDX</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span>uvpt<span class="token punctuation">[</span>pn<span class="token punctuation">]</span> <span class="token operator">&amp;</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>uvpt<span class="token punctuation">[</span>pn<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>PTE_W <span class="token operator">|</span> PTE_COW<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> envid<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> PTE_COW <span class="token operator">|</span> PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> r<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> PTE_COW <span class="token operator">|</span> PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_map</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> addr<span class="token punctuation">,</span> envid<span class="token punctuation">,</span> addr<span class="token punctuation">,</span> PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//panic("duppage not implemented");</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//</span>
<span class="token comment">// User-level fork with copy-on-write.</span>
<span class="token comment">// Set up our page fault handler appropriately.</span>
<span class="token comment">// Create a child.</span>
<span class="token comment">// Copy our address space and page fault handler setup to the child.</span>
<span class="token comment">// Then mark the child as runnable and return.</span>
<span class="token comment">//</span>
<span class="token comment">// Returns: child's envid to the parent, 0 to the child, &lt; 0 on error.</span>
<span class="token comment">// It is also OK to panic on error.</span>
<span class="token comment">//</span>
<span class="token comment">// Hint:</span>
<span class="token comment">//   Use uvpd, uvpt, and duppage.</span>
<span class="token comment">//   Remember to fix "thisenv" in the child process.</span>
<span class="token comment">//   Neither user exception stack should ever be marked copy-on-write,</span>
<span class="token comment">//   so you must allocate a new page for the child's user exception stack.</span>
<span class="token comment">//</span>
envid_t
<span class="token function">fork</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	envid_t envid<span class="token punctuation">;</span>
	uint8_t <span class="token operator">*</span>addr<span class="token punctuation">;</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	
	<span class="token function">set_pgfault_handler</span><span class="token punctuation">(</span>pgfault<span class="token punctuation">)</span><span class="token punctuation">;</span>
	envid <span class="token operator">=</span> <span class="token function">sys_exofork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>envid <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"sys_exofork: %e"</span><span class="token punctuation">,</span> envid<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>envid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		thisenv <span class="token operator">=</span> <span class="token operator">&amp;</span>envs<span class="token punctuation">[</span><span class="token function">ENVX</span><span class="token punctuation">(</span><span class="token function">sys_getenvid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_page_alloc</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>UXSTACKTOP <span class="token operator">-</span> PGSIZE<span class="token punctuation">)</span><span class="token punctuation">,</span> PTE_U <span class="token operator">|</span> PTE_W <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"fail to alloc for exception stack"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>addr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>addr <span class="token operator">&lt;</span> UTOP<span class="token punctuation">;</span> addr <span class="token operator">+=</span> PGSIZE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>addr <span class="token operator">==</span> UXSTACKTOP <span class="token operator">-</span> PGSIZE<span class="token punctuation">)</span>
			<span class="token keyword">continue</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uvpd<span class="token punctuation">[</span><span class="token function">PDX</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>uvpt<span class="token punctuation">[</span><span class="token function">PGNUM</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">duppage</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token function">PGNUM</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
				<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"duppage failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token function">sys_env_set_pgfault_upcall</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> _pgfault_upcall<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_env_set_status</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> ENV_RUNNABLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"sys_env_set_status: %e"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> envid<span class="token punctuation">;</span>
	<span class="token comment">//panic("fork not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>è¿è¡Œæµ‹è¯•ï¼Œæœ‰ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> run-forktree-nox
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
1000: I am <span class="token string">''</span>
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001001
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001002
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
1001: I am <span class="token string">'0'</span>
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> new <span class="token function">env</span> 00002000
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> new <span class="token function">env</span> 00001003
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001001<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001001
2000: I am <span class="token string">'00'</span>
<span class="token punctuation">[</span>00002000<span class="token punctuation">]</span> new <span class="token function">env</span> 00002001
<span class="token punctuation">[</span>00002000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001004
<span class="token punctuation">[</span>00002000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00002000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00002000
2001: I am <span class="token string">'000'</span>
<span class="token punctuation">[</span>00002001<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00002001<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00002001
1002: I am <span class="token string">'1'</span>
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> new <span class="token function">env</span> 00003001
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> new <span class="token function">env</span> 00003000
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001002<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001002
3000: I am <span class="token string">'11'</span>
<span class="token punctuation">[</span>00003000<span class="token punctuation">]</span> new <span class="token function">env</span> 00002002
<span class="token punctuation">[</span>00003000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001005
<span class="token punctuation">[</span>00003000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00003000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00003000
3001: I am <span class="token string">'10'</span>
<span class="token punctuation">[</span>00003001<span class="token punctuation">]</span> new <span class="token function">env</span> 00004000
<span class="token punctuation">[</span>00003001<span class="token punctuation">]</span> new <span class="token function">env</span> 00001006
<span class="token punctuation">[</span>00003001<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00003001<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00003001
4000: I am <span class="token string">'100'</span>
<span class="token punctuation">[</span>00004000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00004000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00004000
2002: I am <span class="token string">'110'</span>
<span class="token punctuation">[</span>00002002<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00002002<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00002002
1003: I am <span class="token string">'01'</span>
<span class="token punctuation">[</span>00001003<span class="token punctuation">]</span> new <span class="token function">env</span> 00003002
<span class="token punctuation">[</span>00001003<span class="token punctuation">]</span> new <span class="token function">env</span> 00005000
<span class="token punctuation">[</span>00001003<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001003<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001003
5000: I am <span class="token string">'011'</span>
<span class="token punctuation">[</span>00005000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00005000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00005000
3002: I am <span class="token string">'010'</span>
<span class="token punctuation">[</span>00003002<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00003002<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00003002
1004: I am <span class="token string">'001'</span>
<span class="token punctuation">[</span>00001004<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001004<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001004
1005: I am <span class="token string">'111'</span>
<span class="token punctuation">[</span>00001005<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001005<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001005
1006: I am <span class="token string">'101'</span>
<span class="token punctuation">[</span>00001006<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001006<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001006
<span class="token punctuation">..</span>.</code></pre></div>
<p>ç„¶åŽå°±å®Œæˆäº†Part B</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> grade
<span class="token punctuation">..</span>.
dumbfork: OK <span class="token punctuation">(</span>1.4s<span class="token punctuation">)</span>
Part A score: 5/5

faultread: OK <span class="token punctuation">(</span>0.9s<span class="token punctuation">)</span>
faultwrite: OK <span class="token punctuation">(</span>1.0s<span class="token punctuation">)</span>
faultdie: OK <span class="token punctuation">(</span>1.0s<span class="token punctuation">)</span>
faultregs: OK <span class="token punctuation">(</span>2.0s<span class="token punctuation">)</span>
faultalloc: OK <span class="token punctuation">(</span>1.0s<span class="token punctuation">)</span>
faultallocbad: OK <span class="token punctuation">(</span>1.9s<span class="token punctuation">)</span>
faultnostack: OK <span class="token punctuation">(</span>2.1s<span class="token punctuation">)</span>
faultbadhandler: OK <span class="token punctuation">(</span>2.0s<span class="token punctuation">)</span>
faultevilhandler: OK <span class="token punctuation">(</span>1.9s<span class="token punctuation">)</span>
forktree: OK <span class="token punctuation">(</span>2.1s<span class="token punctuation">)</span>
Part B score: 50/50</code></pre></div>
<h2>Part C Preemptive Multitasking and Inter-Process communication (IPC)</h2>
<p>è¿™éƒ¨åˆ†æˆ‘ä»¬ä¼šå®žçŽ°preempty uncooperative environmentä»¥åŠenvironmentä¹‹é—´çš„é€šä¿¡ã€‚</p>
<h3>Clock Interrupts and Preemption</h3>
<p>è¿è¡Œ<code class="language-text">user/spin</code>ï¼Œä¼šå‘çŽ°childé‡Œé¢çš„å¾ªçŽ¯ä¼šæ°¸ä¹…å¾—å æ®CPUï¼Œå¯¼è‡´parentæˆ–æ˜¯kernelæ²¡æœ‰åŠžæ³•è¿è¡Œã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// user/spin.c</span>
<span class="token keyword">void</span>
<span class="token function">umain</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	envid_t env<span class="token punctuation">;</span>

	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"I am the parent.  Forking the child...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>env <span class="token operator">=</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"I am the child.  Spinning...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
			<span class="token comment">/* do nothing */</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"I am the parent.  Running the child...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">cprintf</span><span class="token punctuation">(</span><span class="token string">"I am the parent.  Killing the child...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">sys_env_destroy</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ˜¾ç„¶è¿™ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ï¼Œå› ä¸ºuser-mode environmentå¯ä»¥ç›´æŽ¥å¯¼è‡´æ•´ä¸ªç³»ç»Ÿhaltã€‚ä¸ºäº†è®©kernelå¯ä»¥preempt a running environmentï¼Œæˆ‘ä»¬éœ€è¦è®©JOS kernelå®žçŽ°external hardware interrupt from the clock hardwareã€‚</p>
<h3>Interrupt discipline</h3>
<p>External interruptsè¢«ç§°ä¸ºIRQã€‚æœ‰16ä¸ªIRQï¼Œä»Ž0åˆ°15ã€‚IRQ numberåˆ°IDT entryçš„æ˜ å°„è¿˜æ²¡æœ‰å®žçŽ°ã€‚</p>
<p>åœ¨<code class="language-text">inc/trap.c</code>ä¸­å®šä¹‰äº†<code class="language-text">IRQ_OFFSET</code>ä¸º32ï¼Œæ‰€ä»¥IDTä¸­çš„32~47å¯¹åº”äº†IRQçš„0~15ã€‚æ¯”å¦‚<code class="language-text">IDT[IRQ_OFFSET + 0]</code>å¯¹åº”äº†å§‹ç»ˆä¸­æ–­çš„handlerã€‚é‡‡ç”¨è¿™ä¸ª<code class="language-text">IRQ_OFFSET</code>æ˜¯ä¸ºäº†è®©device interruptå’Œprocessor exceptionåˆ†å¼€ã€‚ï¼ˆæœ€æ—©ç‰ˆæœ¬çš„MS-DOSä¸è¿›è¡ŒåŒºåˆ†ï¼Œå¯¼è‡´äº†å¾ˆå¤šé—®é¢˜...ï¼‰</p>
<p>åœ¨JOSä¸­ï¼Œæˆ‘ä»¬ç›¸è¾ƒäºŽxv6åšäº†ç®€åŒ–ï¼Œåœ¨kernelé‡Œé¢externel device interruptéƒ½è¢«ç¦ç”¨äº†ã€‚åœ¨JOSä¸­externel device interruptæ˜¯ç”¨<code class="language-text">%eflags</code>çš„<code class="language-text">FL_IF</code>ä½æŽ§åˆ¶çš„ï¼Œä¸º1åˆ™å¼€å¯ã€‚å°½ç®¡æˆ‘ä»¬æœ‰å¾ˆå¤šç§æ–¹æ³•å¯ä»¥ä¿®æ”¹è¿™ä¸€ä½ï¼Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬ä»…ä»…åœ¨è¿›å…¥æˆ–ç¦»å¼€user modeçš„æ—¶å€™è¿›è¡Œ<code class="language-text">%eflags</code>çš„æ¢å¤æˆ–å­˜å‚¨ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦ä¿è¯åœ¨ç”¨æˆ·çŽ¯å¢ƒä¸­<code class="language-text">FL_IF</code>ä½ä¸º1ï¼Œä»Žè€Œèƒ½å¤ŸæŽ¥å—ä¸­æ–­ã€‚åœ¨bootloaderçš„æœ€åˆå¤„æˆ‘ä»¬åŠ è½½äº†ä»…ç”¨äº†æ‰€æœ‰ä¸­æ–­ï¼Œç„¶åŽæˆªæ­¢åˆ°çŽ°åœ¨æˆ‘ä»¬æ²¡æœ‰å¼€å¯è¿‡ä»–ä»¬ã€‚</p>
<h3>Exercise 13</h3>
<p>ä¿®æ”¹<code class="language-text">kern/trapentry.S</code>, <code class="language-text">kern/trap.c</code>æ¥åŠ å…¥IRQ 0~15ã€‚åŒæ—¶æ›´æ”¹<code class="language-text">env_alloc()</code>è®©ç”¨æˆ·çŽ¯å¢ƒå¼€å¯ä¸­æ–­ã€‚å¹¶ä¸”å–æ¶ˆ<code class="language-text">sched_halt</code>ä¸­<code class="language-text">sti</code>å‰é¢çš„æ³¨é‡Šã€‚è®©idle CPUå¯ç”¨ä¸­æ–­ã€‚</p>
<p>ä¸‹é¢æ˜¯å¯¹åº”çš„ä»£ç ã€‚é¦–å…ˆæ˜¯<code class="language-text">trapentry.S</code>ï¼Œæ³¨æ„æç¤ºä¸­åˆè¯´the processor never pushes an error code when invoking a hardware interrupt handlerï¼Œæ‰€ä»¥åº”è¯¥é‡‡ç”¨<code class="language-text">TRAPHANDLER_NOEC</code>ï¼ˆè‡³å°‘æˆ‘æ˜¯è¿™ä¹ˆè§‰å¾—çš„...ï¼‰</p>
<div class="gatsby-highlight" data-language="assembly"><pre class="language-assembly"><code class="language-assembly">TRAPHANDLER_NOEC(IRQ_0, IRQ_OFFSET + 0)
TRAPHANDLER_NOEC(IRQ_1, IRQ_OFFSET + 1)
TRAPHANDLER_NOEC(IRQ_2, IRQ_OFFSET + 2)
TRAPHANDLER_NOEC(IRQ_3, IRQ_OFFSET + 3)
TRAPHANDLER_NOEC(IRQ_4, IRQ_OFFSET + 4)
TRAPHANDLER_NOEC(IRQ_5, IRQ_OFFSET + 5)
TRAPHANDLER_NOEC(IRQ_6, IRQ_OFFSET + 6)
TRAPHANDLER_NOEC(IRQ_7, IRQ_OFFSET + 7)
TRAPHANDLER_NOEC(IRQ_8, IRQ_OFFSET + 8)
TRAPHANDLER_NOEC(IRQ_9, IRQ_OFFSET + 9)
TRAPHANDLER_NOEC(IRQ_10, IRQ_OFFSET + 10)
TRAPHANDLER_NOEC(IRQ_11, IRQ_OFFSET + 11)
TRAPHANDLER_NOEC(IRQ_12, IRQ_OFFSET + 12)
TRAPHANDLER_NOEC(IRQ_13, IRQ_OFFSET + 13)
TRAPHANDLER_NOEC(IRQ_14, IRQ_OFFSET + 14)
TRAPHANDLER_NOEC(IRQ_15, IRQ_OFFSET + 15)</code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">kern/trap.c</code>ï¼Œæ·»åŠ çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">	<span class="token comment">// IRQ</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_6</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_7</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_9</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_10</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_11</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_12</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_13</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_14</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">IRQ_15</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_4<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_5<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_6<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_7<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_8<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_9<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_10<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_11<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_12<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_13<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_14<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">SETGATE</span><span class="token punctuation">(</span>idt<span class="token punctuation">[</span>IRQ_OFFSET <span class="token operator">+</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> GD_KT<span class="token punctuation">,</span> IRQ_15<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>æœ€å¼€å§‹åœ¨å®žçŽ°çš„æ—¶å€™å‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯æ— æ³•é€šè¿‡<code class="language-text">trap()</code>ä¸­çš„ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">read_eflags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> FL_IF<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>ä¹Ÿå°±æ˜¯åœ¨trapçš„æ—¶å€™<code class="language-text">FL_IF</code>å¤„æœ‰å€¼ã€‚ç»è¿‡ç½‘ä¸Šæœç´¢è§£å†³æ–¹æ¡ˆï¼Œå‘çŽ°æ˜¯åœ¨lab 3ä¸­çš„<code class="language-text">SETGATE</code>ä½¿ç”¨å‡ºäº†é”™è¯¯ã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Set up a normal interrupt/trap gate descriptor.</span>
<span class="token comment">// - istrap: 1 for a trap (= exception) gate, 0 for an interrupt gate.</span>
    <span class="token comment">//   see section 9.6.1.3 of the i386 reference: "The difference between</span>
    <span class="token comment">//   an interrupt gate and a trap gate is in the effect on IF (the</span>
    <span class="token comment">//   interrupt-enable flag). An interrupt that vectors through an</span>
    <span class="token comment">//   interrupt gate resets IF, thereby preventing other interrupts from</span>
    <span class="token comment">//   interfering with the current interrupt handler. A subsequent IRET</span>
    <span class="token comment">//   instruction restores IF to the value in the EFLAGS image on the</span>
    <span class="token comment">//   stack. An interrupt through a trap gate does not change IF."</span>
<span class="token comment">// - sel: Code segment selector for interrupt/trap handler</span>
<span class="token comment">// - off: Offset in code segment for interrupt/trap handler</span>
<span class="token comment">// - dpl: Descriptor Privilege Level -</span>
<span class="token comment">//	  the privilege level required for software to invoke</span>
<span class="token comment">//	  this interrupt/trap gate explicitly using an int instruction.</span>
<span class="token macro property">#<span class="token directive keyword">define</span> SETGATE(gate, istrap, sel, off, dpl)			\
{								\
	(gate).gd_off_15_0 = (uint32_t) (off) &amp; 0xffff;		\
	(gate).gd_sel = (sel);					\
	(gate).gd_args = 0;					\
	(gate).gd_rsv1 = 0;					\
	(gate).gd_type = (istrap) ? STS_TG32 : STS_IG32;	\
	(gate).gd_s = 0;					\
	(gate).gd_dpl = (dpl);					\
	(gate).gd_p = 1;					\
	(gate).gd_off_31_16 = (uint32_t) (off) >> 16;		\
}</span></code></pre></div>
<p>é˜…è¯»<code class="language-text">SETGATE</code>çš„æ³¨é‡Šå¯ä»¥çœ‹åˆ°<code class="language-text">istrap</code>éƒ¨åˆ†å¦‚æžœè®¾ç½®ä¸º0æ‰èƒ½ä¿è¯åœ¨ä¸­æ–­çš„é‡Œé¢ä¸ä¼šæœ‰ä¸­æ–­ï¼Œè¿™ä¹Ÿæ˜¯JOSçš„è¦æ±‚ï¼ˆå’Œxv6ä¸åŒï¼‰ï¼Œæ‰€ä»¥æ‰€æœ‰çš„<code class="language-text">SETGATE</code>ï¼ˆåŒ…æ‹¬lab3çš„éƒ¨åˆ†ï¼‰éƒ½éœ€è¦é‡‡ç”¨<code class="language-text">istrap=0</code>ã€‚</p>
<p>ç„¶åŽåœ¨<code class="language-text">env_alloc()</code>ä¸­ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">	<span class="token comment">// Enable interrupts while in user mode.</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	e<span class="token operator">-></span>env_tf<span class="token punctuation">.</span>tf_eflags <span class="token operator">|=</span> FL_IF<span class="token punctuation">;</span></code></pre></div>
<p>æœ€åŽæ˜¯<code class="language-text">sched_halt()</code></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">	<span class="token comment">// Reset stack pointer, enable interrupts and then halt.</span>
	<span class="token keyword">asm</span> <span class="token keyword">volatile</span> <span class="token punctuation">(</span>
		<span class="token string">"movl $0, %%ebp\n"</span>
		<span class="token string">"movl %0, %%esp\n"</span>
		<span class="token string">"pushl $0\n"</span>
		<span class="token string">"pushl $0\n"</span>
		<span class="token comment">// Uncomment the following line after completing exercise 13</span>
		<span class="token string">"sti\n"</span>
		<span class="token string">"1:\n"</span>
		<span class="token string">"hlt\n"</span>
		<span class="token string">"jmp 1b\n"</span>
	<span class="token operator">:</span> <span class="token operator">:</span> <span class="token string">"a"</span> <span class="token punctuation">(</span>thiscpu<span class="token operator">-></span>cpu_ts<span class="token punctuation">.</span>ts_esp0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>å†ç”¨<code class="language-text">user/spin</code>æµ‹è¯•ä¼šå‘çŽ°ä¸­æ–­å·²ç»è¢«æ‰“å¼€äº†ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">$ make run<span class="token operator">-</span>spin<span class="token operator">-</span>nox
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">00000000</span><span class="token punctuation">]</span> new env <span class="token number">00001000</span>
I am the parent<span class="token punctuation">.</span>  Forking the child<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">00001000</span><span class="token punctuation">]</span> new env <span class="token number">00001001</span>
I am the parent<span class="token punctuation">.</span>  Running the child<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
I am the child<span class="token punctuation">.</span>  Spinning<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
TRAP frame at <span class="token number">0xf02b707c</span> from CPU <span class="token number">0</span>
  edi  <span class="token number">0x00000000</span>
  esi  <span class="token number">0x00000000</span>
  ebp  <span class="token number">0xeebfdfd0</span>
  oesp <span class="token number">0xf023cfdc</span>
  ebx  <span class="token number">0x00000000</span>
  edx  <span class="token number">0xeebfde88</span>
  ecx  <span class="token number">0x0000001d</span>
  eax  <span class="token number">0x0000001d</span>
  es   <span class="token number">0</span>x<span class="token operator">--</span><span class="token operator">--</span><span class="token number">0023</span>
  ds   <span class="token number">0</span>x<span class="token operator">--</span><span class="token operator">--</span><span class="token number">0023</span>
  trap <span class="token number">0x00000020</span> Hardware Interrupt
  err  <span class="token number">0x00000000</span>
  eip  <span class="token number">0x00800060</span>
  cs   <span class="token number">0</span>x<span class="token operator">--</span><span class="token operator">--</span><span class="token number">001</span>b
  flag <span class="token number">0x00000282</span>
  esp  <span class="token number">0xeebfdfc8</span>
  ss   <span class="token number">0</span>x<span class="token operator">--</span><span class="token operator">--</span><span class="token number">0023</span>
<span class="token punctuation">[</span><span class="token number">00001001</span><span class="token punctuation">]</span> free env <span class="token number">00001001</span>
I am the parent<span class="token punctuation">.</span>  Killing the child<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">[</span><span class="token number">00001000</span><span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span><span class="token number">00001000</span><span class="token punctuation">]</span> free env <span class="token number">00001000</span>
No runnable environments in the system<span class="token operator">!</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<h3>Handling Clock Interrupts</h3>
<p>æˆ‘ä»¬æŽ¥ä¸‹æ¥æ¥è®¾ç½®æ—¶é’Ÿä¸­æ–­çš„handlerã€‚<code class="language-text">lapic_init</code>å’Œ<code class="language-text">pic_init</code>å·²ç»è®¾ç½®äº†å§‹ç»ˆå’Œä¸­æ–­æŽ§åˆ¶å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦å†™handleräº†ã€‚</p>
<h3>Exercise 14</h3>
<p>ä¿®æ”¹<code class="language-text">trap_dispatch</code>ï¼Œæ·»åŠ timer interrupt handlerã€‚</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">		<span class="token comment">// Handle clock interrupts. Don't forget to acknowledge the</span>
		<span class="token comment">// interrupt using lapic_eoi() before calling the scheduler!</span>
		<span class="token comment">// LAB 4: Your code here.</span>
		<span class="token keyword">case</span> IRQ_OFFSET <span class="token operator">+</span> IRQ_TIMER<span class="token operator">:</span>
			<span class="token function">lapic_eoi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">sched_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥æ­£å¸¸è¿è¡Œ<code class="language-text">user/spin</code>äº†ã€‚</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> run-spin-nox
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00000000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001000
I am the parent.  Forking the child<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> new <span class="token function">env</span> 00001001
I am the parent.  Running the child<span class="token punctuation">..</span>.
I am the child.  Spinning<span class="token punctuation">..</span>.
I am the parent.  Killing the child<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> destroying 00001001
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001001
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> exiting gracefully
<span class="token punctuation">[</span>00001000<span class="token punctuation">]</span> <span class="token function">free</span> <span class="token function">env</span> 00001000
No runnable environments <span class="token keyword">in</span> the system<span class="token operator">!</span>
<span class="token punctuation">..</span>.</code></pre></div>
<h3>Inter-Process communication (IPC)</h3>
<p>æˆªæ­¢åˆ°çŽ°åœ¨ï¼Œæˆ‘ä»¬éžå¸¸é‡è§†isolationï¼Œä½†æ˜¯è®©ç¨‹åºå¯ä»¥ç›¸äº’ä¹‹é—´äº¤æµä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ã€‚è®©ç¨‹åºå¯ä»¥äº’åŠ¨å¯ä»¥å¸¦æ¥å¼ºå¤§çš„åŠŸèƒ½ã€‚interprocess communicationæœ‰å¾ˆå¤šçš„æ¨¡åž‹ï¼Œåˆ°ä»Šå¤©ä¸ºæ­¢å“ªä¸ªæ¨¡åž‹æœ€å¥½ä»ç„¶æ²¡æœ‰å®šè®ºã€‚æˆ‘ä»¬ä¼šå®žçŽ°ä¸€ä¸ªç®€å•çš„æ¨¡åž‹ã€‚</p>
<h3>IPC in JOS</h3>
<p>æˆ‘ä»¬ä¼šå®žçŽ°å‡ ä¸ªç®€å•çš„system callæ¥å®žçŽ°ä¸€ä¸ªç®€å•çš„interprocess communication mechanismã€‚ä¸¤ä¸ªsystem callåˆ†åˆ«å®ž<code class="language-text">sys_ipc_recv</code>å’Œ<code class="language-text">sys_ipc_try_send</code>ã€‚ä¹‹åŽæˆ‘ä»¬ä¼šæŠŠä»–ä»¬åŒ…è£…åœ¨<code class="language-text">ipc_recv</code>å’Œ<code class="language-text">ipc_send</code>é‡Œã€‚</p>
<p>åœ¨JOSçš„IPCä¸­ç›¸äº’ä¼ è¾“çš„ä¿¡æ¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€ä¸ª32ä½çš„å€¼å’Œä¸€ä¸ªå¯é€‰çš„single page mappingã€‚è®©çŽ¯å¢ƒå¯ä»¥ç›¸äº’ä¹‹é—´ä¼ page mappingæ˜¯ä¸€ç§ä¼ è¾“å¤§æ•°æ®é‡çš„é«˜æ•ˆæ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿè®©çŽ¯å¢ƒæ›´å¥½è®¾ç½®å…±äº«å†…å­˜ã€‚</p>
<h3>Sending and Receiving Messages</h3>
<p>å¦‚æžœè¦æŽ¥æ”¶åˆ°ä¿¡æ¯ï¼ŒçŽ¯å¢ƒéœ€è¦è°ƒç”¨<code class="language-text">sys_ipc_recv</code>ï¼Œè¿™ä¸ªsystem callä¼šde-scheduleså½“å‰çŽ¯å¢ƒå¹¶åªæœ‰æ”¶åˆ°ä¿¡æ¯ä¹‹åŽæ‰ä¼šç»§ç»­è¿è¡Œã€‚å½“ä¸€ä¸ªçŽ¯å¢ƒç­‰å¾…èŽ·å–ä¿¡æ¯çš„æ—¶å€™ï¼Œå…¶ä»–çš„çŽ¯å¢ƒå¯ä»¥å‘ä¿¡æ¯ã€‚æ³¨æ„æ˜¯æ˜¯ä»»ä½•çŽ¯å¢ƒï¼Œå› ä¸ºIPCçš„è®¾è®¡æœ¬èº«ç¡®ä¿äº†å®‰å…¨ï¼Œå‘ä¿¡æ¯ä¸ä¼šæžå´©æŽ¥å—çš„çŽ¯å¢ƒï¼Œæ‰€ä»¥ä¸éœ€è¦çŽ¯å¢ƒä¹‹é—´ç”±parent childè¿™æ ·çš„å…³ç³»ã€‚</p>
<p>å¦‚æžœè¦å‘é€ä¸€æ¡ä¿¡æ¯ï¼ŒçŽ¯å¢ƒéœ€è¦è°ƒç”¨<code class="language-text">sys_ipc_try_send</code>ï¼Œä»¥è‡ªå·±å’ŒæŽ¥å—çŽ¯å¢ƒä¸ºå‚æ•°ã€‚å¦‚æžœå¯¹åº”çš„çŽ¯å¢ƒç¡®å®žåœ¨å‡†å¤‡æŽ¥æ”¶ï¼Œé‚£ä¹ˆæ•°æ®ä¼šè¢«ä¼ è¿‡åŽ»å¹¶è¿”å›ž0ï¼Œä¸ç„¶è¿”å›ž<code class="language-text">-E_IPC_NOT_RECV</code>ã€‚</p>
<p>User spaceä¸­çš„åº“å‡½æ•°<code class="language-text">ipc_recv</code>ä¼šè´Ÿè´£è°ƒç”¨<code class="language-text">sys_ipc_recv</code>ä»¥åŠåœ¨<code class="language-text">struct Env</code>ä¸­æŸ¥è¯¢æŽ¥æ”¶åˆ°çš„æ•°æ®ã€‚</p>
<p>åŒæ ·<code class="language-text">ipc_send</code>ä¼šé‡å¤è°ƒç”¨<code class="language-text">sys_ipc_try_send</code>ç›´åˆ°æˆåŠŸå‘é€ã€‚</p>
<h3>Transferring Pages</h3>
<p>å½“ä¸€ä¸ªçŽ¯å¢ƒä»¥ä¸€ä¸ªåˆç†çš„<code class="language-text">dstva</code>ï¼ˆåœ¨<code class="language-text">UTOP</code>ä¹‹ä¸‹ï¼‰è°ƒç”¨<code class="language-text">sys_ipc_recv</code>çš„æ—¶å€™ï¼ŒçŽ¯å¢ƒè¡¨ç¤ºå…¶å¯ä»¥æŽ¥å—ä¸€ä¸ªmappingã€‚å¦‚æžœsenderå‘è¿‡æ¥ä¸€ä¸ªpageï¼Œé‚£ä¹ˆè¿™ä¸ªpageå°±ä¼šè¢«mapåœ¨<code class="language-text">dstva</code>å¤„ã€‚å¦‚æžœ<code class="language-text">dstva</code>åŽŸæ¥å°±æœ‰ä¸€ä¸ªmappingï¼Œè¿™ä¸ªmappingä¼šè¢«unmapã€‚</p>
<p>å½“ä¸€ä¸ªçŽ¯å¢ƒä»¥ä¸€ä¸ªåˆç†çš„<code class="language-text">srcva</code>ï¼ˆåœ¨<code class="language-text">UTOP</code>ä¹‹ä¸‹ï¼‰è°ƒç”¨<code class="language-text">sys_ipc_try_send</code>çš„æ—¶å€™ï¼ŒçŽ¯å¢ƒè¡¨ç¤ºå…¶æƒ³è¦å‘é€ä¸€ä¸ªmapåœ¨<code class="language-text">srcva</code>çš„pageï¼Œå…¶permissionä¸º<code class="language-text">perm</code>ã€‚IPCæˆåŠŸä¹‹åŽï¼Œsenderä¼šä¿ç•™åŽŸå§‹çš„mappingï¼Œä½†æ˜¯receiverå’Œå®ƒä¼šshareè¿™ä¸ªpageã€‚</p>
<p>å¦‚æžœsenderå’Œreceiveä¸­çš„ä¸€ä¸ªä¸æ„¿æ„å‘é€æˆ–æ˜¯æŽ¥å—pageï¼Œé‚£ä¹ˆå°±ä¸ä¼šæœ‰pageè¢«ä¼ è¾“ã€‚IPCä¹‹åŽï¼Œ<code class="language-text">Env</code>ä¸­çš„<code class="language-text">env_ipc_perm</code>ä¼šä¸ºæŽ¥æ”¶åˆ°çš„pageçš„permissionæˆ–0ã€‚</p>
<h3>Implementing IPC</h3>
<h3>Exercise 15</h3>
<p>å®Œæˆ<code class="language-text">sys_ipc_recv</code>, <code class="language-text">sys_ipc_try_send</code>ä»¥åŠ<code class="language-text">ipc_recv</code>å’Œ<code class="language-text">ipc_send</code>ã€‚æ³¨æ„åœ¨ä½¿ç”¨<code class="language-text">envid2env</code>çš„æ—¶å€™<code class="language-text">checkperm</code>åº”è®¾ä¸º0ï¼ŒåŽŸå› ä¸Šé¢æåˆ°äº†ã€‚</p>
<p>æŒ‰ç…§è¯¦ç»†çš„æ³¨é‡Šä¸€ç‚¹ä¸€ç‚¹åŠ ä¸Šå°±å¥½äº†ï¼Œé¦–å…ˆæ˜¯<code class="language-text">sys_ipc_recv</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Block until a value is ready.  Record that you want to receive</span>
<span class="token comment">// using the env_ipc_recving and env_ipc_dstva fields of struct Env,</span>
<span class="token comment">// mark yourself not runnable, and then give up the CPU.</span>
<span class="token comment">//</span>
<span class="token comment">// If 'dstva' is &lt; UTOP, then you are willing to receive a page of data.</span>
<span class="token comment">// 'dstva' is the virtual address at which the sent page should be mapped.</span>
<span class="token comment">//</span>
<span class="token comment">// This function only returns on error, but the system call will eventually</span>
<span class="token comment">// return 0 on success.</span>
<span class="token comment">// Return &lt; 0 on error.  Errors are:</span>
<span class="token comment">//	-E_INVAL if dstva &lt; UTOP but dstva is not page-aligned.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_ipc_recv</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>dstva<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>dstva <span class="token operator">&lt;</span> UTOP<span class="token punctuation">)</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>dstva<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>dstva<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
	curenv<span class="token operator">-></span>env_ipc_recving <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	curenv<span class="token operator">-></span>env_ipc_dstva <span class="token operator">=</span> dstva<span class="token punctuation">;</span>
	curenv<span class="token operator">-></span>env_status <span class="token operator">=</span> ENV_NOT_RUNNABLE<span class="token punctuation">;</span>
	<span class="token function">sched_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_ipc_recv not implemented");</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>ç„¶åŽæ˜¯<code class="language-text">sys_ipc_try_send</code></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Try to send 'value' to the target env 'envid'.</span>
<span class="token comment">// If srcva &lt; UTOP, then also send page currently mapped at 'srcva',</span>
<span class="token comment">// so that receiver gets a duplicate mapping of the same page.</span>
<span class="token comment">//</span>
<span class="token comment">// The send fails with a return value of -E_IPC_NOT_RECV if the</span>
<span class="token comment">// target is not blocked, waiting for an IPC.</span>
<span class="token comment">//</span>
<span class="token comment">// The send also can fail for the other reasons listed below.</span>
<span class="token comment">//</span>
<span class="token comment">// Otherwise, the send succeeds, and the target's ipc fields are</span>
<span class="token comment">// updated as follows:</span>
<span class="token comment">//    env_ipc_recving is set to 0 to block future sends;</span>
<span class="token comment">//    env_ipc_from is set to the sending envid;</span>
<span class="token comment">//    env_ipc_value is set to the 'value' parameter;</span>
<span class="token comment">//    env_ipc_perm is set to 'perm' if a page was transferred, 0 otherwise.</span>
<span class="token comment">// The target environment is marked runnable again, returning 0</span>
<span class="token comment">// from the paused sys_ipc_recv system call.  (Hint: does the</span>
<span class="token comment">// sys_ipc_recv function ever actually return?)</span>
<span class="token comment">//</span>
<span class="token comment">// If the sender wants to send a page but the receiver isn't asking for one,</span>
<span class="token comment">// then no page mapping is transferred, but no error occurs.</span>
<span class="token comment">// The ipc only happens when no errors occur.</span>
<span class="token comment">//</span>
<span class="token comment">// Returns 0 on success, &lt; 0 on error.</span>
<span class="token comment">// Errors are:</span>
<span class="token comment">//	-E_BAD_ENV if environment envid doesn't currently exist.</span>
<span class="token comment">//		(No need to check permissions.)</span>
<span class="token comment">//	-E_IPC_NOT_RECV if envid is not currently blocked in sys_ipc_recv,</span>
<span class="token comment">//		or another environment managed to send first.</span>
<span class="token comment">//	-E_INVAL if srcva &lt; UTOP but srcva is not page-aligned.</span>
<span class="token comment">//	-E_INVAL if srcva &lt; UTOP and perm is inappropriate</span>
<span class="token comment">//		(see sys_page_alloc).</span>
<span class="token comment">//	-E_INVAL if srcva &lt; UTOP but srcva is not mapped in the caller's</span>
<span class="token comment">//		address space.</span>
<span class="token comment">//	-E_INVAL if (perm &amp; PTE_W), but srcva is read-only in the</span>
<span class="token comment">//		current environment's address space.</span>
<span class="token comment">//	-E_NO_MEM if there's not enough memory to map srcva in envid's</span>
<span class="token comment">//		address space.</span>
<span class="token keyword">static</span> <span class="token keyword">int</span>
<span class="token function">sys_ipc_try_send</span><span class="token punctuation">(</span>envid_t envid<span class="token punctuation">,</span> uint32_t value<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>srcva<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> perm<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">Env</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">PageInfo</span> <span class="token operator">*</span>pp <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	pte_t <span class="token operator">*</span>pte <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">envid2env</span><span class="token punctuation">(</span>envid<span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token operator">-></span>env_ipc_recving<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token operator">-</span>E_IPC_NOT_RECV<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>srcva <span class="token operator">&lt;</span> UTOP <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>e<span class="token operator">-></span>env_ipc_dstva <span class="token operator">&lt;</span> UTOP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ROUNDDOWN</span><span class="token punctuation">(</span><span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>srcva<span class="token punctuation">,</span> PGSIZE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>uint32_t<span class="token punctuation">)</span>srcva<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> <span class="token punctuation">(</span>PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token punctuation">(</span>PTE_U <span class="token operator">|</span> PTE_P<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> <span class="token operator">~</span>PTE_SYSCALL<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pp <span class="token operator">=</span> <span class="token function">page_lookup</span><span class="token punctuation">(</span>curenv<span class="token operator">-></span>env_pgdir<span class="token punctuation">,</span> srcva<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pte<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>pte <span class="token operator">&amp;</span> perm<span class="token punctuation">)</span> <span class="token operator">!=</span> perm<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>perm <span class="token operator">&amp;</span> PTE_W<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token operator">*</span>pte <span class="token operator">&amp;</span> PTE_W<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>E_INVAL<span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">page_insert</span><span class="token punctuation">(</span>e<span class="token operator">-></span>env_pgdir<span class="token punctuation">,</span> pp<span class="token punctuation">,</span> e<span class="token operator">-></span>env_ipc_dstva<span class="token punctuation">,</span> perm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">return</span> r<span class="token punctuation">;</span>
		e<span class="token operator">-></span>env_ipc_perm <span class="token operator">=</span> perm<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	e<span class="token operator">-></span>env_ipc_recving <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_ipc_from <span class="token operator">=</span> curenv<span class="token operator">-></span>env_id<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_ipc_value <span class="token operator">=</span> value<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_status <span class="token operator">=</span> ENV_RUNNABLE<span class="token punctuation">;</span>
	e<span class="token operator">-></span>env_tf<span class="token punctuation">.</span>tf_regs<span class="token punctuation">.</span>reg_eax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//panic("sys_ipc_try_send not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æ³¨æ„å†™å®Œè¿™ä¸¤ä¸ªä¹‹åŽåˆ«å¿˜äº†åœ¨<code class="language-text">syscall()</code>é‡Œé¢åŠ ä¸Šè¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<p>ç„¶åŽæ˜¯<code class="language-text">ipc_recv</code>ï¼š</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Receive a value via IPC and return it.</span>
<span class="token comment">// If 'pg' is nonnull, then any page sent by the sender will be mapped at</span>
<span class="token comment">//	that address.</span>
<span class="token comment">// If 'from_env_store' is nonnull, then store the IPC sender's envid in</span>
<span class="token comment">//	*from_env_store.</span>
<span class="token comment">// If 'perm_store' is nonnull, then store the IPC sender's page permission</span>
<span class="token comment">//	in *perm_store (this is nonzero iff a page was successfully</span>
<span class="token comment">//	transferred to 'pg').</span>
<span class="token comment">// If the system call fails, then store 0 in *fromenv and *perm (if</span>
<span class="token comment">//	they're nonnull) and return the error.</span>
<span class="token comment">// Otherwise, return the value sent by the sender</span>
<span class="token comment">//</span>
<span class="token comment">// Hint:</span>
<span class="token comment">//   Use 'thisenv' to discover the value and who sent it.</span>
<span class="token comment">//   If 'pg' is null, pass sys_ipc_recv a value that it will understand</span>
<span class="token comment">//   as meaning "no page".  (Zero is not the right value, since that's</span>
<span class="token comment">//   a perfectly valid place to map a page.)</span>
int32_t
<span class="token function">ipc_recv</span><span class="token punctuation">(</span>envid_t <span class="token operator">*</span>from_env_store<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pg<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>perm_store<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>dstva <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>UTOP<span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>pg<span class="token punctuation">)</span>
		dstva <span class="token operator">=</span> pg<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>from_env_store<span class="token punctuation">)</span>
			<span class="token operator">*</span>from_env_store <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>perm_store<span class="token punctuation">)</span>
		<span class="token operator">*</span>perm_store <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_ipc_recv</span><span class="token punctuation">(</span>dstva<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> r<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>from_env_store<span class="token punctuation">)</span>
		<span class="token operator">*</span>from_env_store <span class="token operator">=</span> thisenv<span class="token operator">-></span>env_ipc_from<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>perm_store<span class="token punctuation">)</span>
		<span class="token operator">*</span>perm_store <span class="token operator">=</span> thisenv<span class="token operator">-></span>env_ipc_perm<span class="token punctuation">;</span>
	<span class="token keyword">return</span> thisenv<span class="token operator">-></span>env_ipc_value<span class="token punctuation">;</span>
	<span class="token comment">//panic("ipc_recv not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>æœ€åŽæ˜¯<code class="language-text">ipc_send</code></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token comment">// Send 'val' (and 'pg' with 'perm', if 'pg' is nonnull) to 'toenv'.</span>
<span class="token comment">// This function keeps trying until it succeeds.</span>
<span class="token comment">// It should panic() on any error other than -E_IPC_NOT_RECV.</span>
<span class="token comment">//</span>
<span class="token comment">// Hint:</span>
<span class="token comment">//   Use sys_yield() to be CPU-friendly.</span>
<span class="token comment">//   If 'pg' is null, pass sys_ipc_try_send a value that it will understand</span>
<span class="token comment">//   as meaning "no page".  (Zero is not the right value.)</span>
<span class="token keyword">void</span>
<span class="token function">ipc_send</span><span class="token punctuation">(</span>envid_t to_env<span class="token punctuation">,</span> uint32_t val<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pg<span class="token punctuation">,</span> <span class="token keyword">int</span> perm<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// LAB 4: Your code here.</span>
	<span class="token keyword">int</span> r<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token operator">*</span>srcva <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>UTOP<span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pg<span class="token punctuation">)</span>
		srcva <span class="token operator">=</span> pg<span class="token punctuation">;</span>

	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token function">sys_ipc_try_send</span><span class="token punctuation">(</span>to_env<span class="token punctuation">,</span> val<span class="token punctuation">,</span> pg<span class="token punctuation">,</span> perm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token operator">-</span>E_IPC_NOT_RECV<span class="token punctuation">)</span>
			<span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">"ipc send fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sys_yield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//panic("ipc_send not implemented");</span>
<span class="token punctuation">}</span></code></pre></div>
<p>å®Œæˆäº†ä¹‹åŽå°±å¯ä»¥ç”¨<code class="language-text">user/pingpong</code>æˆ–è€…æ˜¯<code class="language-text">user/primes</code>æ¥è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>æœ€åŽæ¥<code class="language-text">make grade</code>ä¸€ä¸‹ï¼š</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span> grade
<span class="token punctuation">..</span>.
dumbfork: OK <span class="token punctuation">(</span>2.5s<span class="token punctuation">)</span>
Part A score: 5/5

faultread: OK <span class="token punctuation">(</span>1.9s<span class="token punctuation">)</span>
faultwrite: OK <span class="token punctuation">(</span>2.1s<span class="token punctuation">)</span>
faultdie: OK <span class="token punctuation">(</span>2.0s<span class="token punctuation">)</span>
faultregs: OK <span class="token punctuation">(</span>2.1s<span class="token punctuation">)</span>
faultalloc: OK <span class="token punctuation">(</span>0.9s<span class="token punctuation">)</span>
faultallocbad: OK <span class="token punctuation">(</span>1.9s<span class="token punctuation">)</span>
faultnostack: OK <span class="token punctuation">(</span>2.0s<span class="token punctuation">)</span>
faultbadhandler: OK <span class="token punctuation">(</span>2.2s<span class="token punctuation">)</span>
faultevilhandler: OK <span class="token punctuation">(</span>1.9s<span class="token punctuation">)</span>
forktree: OK <span class="token punctuation">(</span>2.2s<span class="token punctuation">)</span>
Part B score: 50/50

spin: OK <span class="token punctuation">(</span>2.0s<span class="token punctuation">)</span>
stresssched: OK <span class="token punctuation">(</span>2.2s<span class="token punctuation">)</span>
sendpage: OK <span class="token punctuation">(</span>1.7s<span class="token punctuation">)</span>
pingpong: OK <span class="token punctuation">(</span>2.0s<span class="token punctuation">)</span>
primes: OK <span class="token punctuation">(</span>4.4s<span class="token punctuation">)</span>
Part C score: 25/25

Score: 80/80</code></pre></div>
<p>lab4å°±å®Œæˆäº†ã€‚</p></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/6.828-lab4/";window.webpackCompilationHash="479e52295e7541bcc551";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-e224b96ae8eed8904dc4.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-edb632f8e95dc6f71e05.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-6b37dd48edc6d9d3d267.js"],"component---src-pages-404-js":["/component---src-pages-404-js-ca63892b5cc72fe26b58.js"],"component---src-pages-about-js":["/component---src-pages-about-js-41d9fdd57d7b0e3783d6.js"],"component---src-pages-index-js":["/component---src-pages-index-js-71311d303da81c6137b9.js"],"component---src-pages-my-files-js":["/component---src-pages-my-files-js-1d1fb82e9b807b2c8f5d.js"],"component---src-pages-tags-js":["/component---src-pages-tags-js-6ced6d8035d332ecbae2.js"]};/*]]>*/</script><script src="/webpack-runtime-06fcd653e46f731a33d8.js" async=""></script><script src="/app-e224b96ae8eed8904dc4.js" async=""></script><script src="/0-e2dc2f855e44dc3424e8.js" async=""></script><script src="/2-4f864fc2dd9dc731be34.js" async=""></script><script src="/component---src-templates-blog-post-js-edb632f8e95dc6f71e05.js" async=""></script><script src="/styles-b3b9a98f1384a6f8783d.js" async=""></script></body></html>