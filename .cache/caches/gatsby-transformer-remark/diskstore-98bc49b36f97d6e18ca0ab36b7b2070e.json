{"expireTime":9007200818315815000,"key":"transformer-remark-markdown-html-ast-6661337214e61b323c7b44a8d5c9c82e-gatsby-remark-katexgatsby-remark-prismjs-","val":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"本文假设读者已经正确安装了docker。同时，下述指令运行的平台为RHEL 7（因为领英只给我配了这么台东西....）。以及基本指令来自于《第一本docker书——修订版》。","position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":2,"column":88,"offset":89}}}],"position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":2,"column":88,"offset":89}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"docker常用指令","position":{"start":{"line":4,"column":4,"offset":96},"end":{"line":4,"column":14,"offset":106}}}],"position":{"start":{"line":4,"column":1,"offset":93},"end":{"line":4,"column":14,"offset":106}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"检查是否正常工作。","position":{"start":{"line":6,"column":1,"offset":110},"end":{"line":6,"column":10,"offset":119}}}],"position":{"start":{"line":6,"column":1,"offset":110},"end":{"line":6,"column":10,"offset":119}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> docker info</code></pre></div>","position":{"start":{"line":8,"column":1,"offset":123},"end":{"line":10,"column":4,"offset":155}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查询系统的container列表：","position":{"start":{"line":12,"column":1,"offset":159},"end":{"line":12,"column":18,"offset":176}}}],"position":{"start":{"line":12,"column":1,"offset":159},"end":{"line":12,"column":18,"offset":176}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> docker <span class=\"token function\">ps</span> -a</code></pre></div>","position":{"start":{"line":14,"column":1,"offset":180},"end":{"line":16,"column":4,"offset":213}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查看所有容器的运行状态：","position":{"start":{"line":18,"column":1,"offset":217},"end":{"line":18,"column":13,"offset":229}}}],"position":{"start":{"line":18,"column":1,"offset":217},"end":{"line":18,"column":13,"offset":229}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> docker stats</code></pre></div>","position":{"start":{"line":20,"column":1,"offset":233},"end":{"line":22,"column":4,"offset":266}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这个指令可以后面跟一个或多个container名字来检测这些。","position":{"start":{"line":24,"column":1,"offset":270},"end":{"line":24,"column":32,"offset":301}}}],"position":{"start":{"line":24,"column":1,"offset":270},"end":{"line":24,"column":32,"offset":301}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"container相关","position":{"start":{"line":26,"column":4,"offset":308},"end":{"line":26,"column":15,"offset":319}}}],"position":{"start":{"line":26,"column":1,"offset":305},"end":{"line":26,"column":15,"offset":319}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"运行容器：","position":{"start":{"line":28,"column":1,"offset":323},"end":{"line":28,"column":6,"offset":328}}}],"position":{"start":{"line":28,"column":1,"offset":323},"end":{"line":28,"column":6,"offset":328}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> docker run --name terminal -i -t ubuntu /bin/bash\n$ /<span class=\"token comment\">#</span></code></pre></div>","position":{"start":{"line":30,"column":1,"offset":332},"end":{"line":33,"column":4,"offset":408}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">--name</code>","position":{"start":{"line":35,"column":1,"offset":412},"end":{"line":35,"column":9,"offset":420}}},{"type":"text","value":"给container命名","position":{"start":{"line":35,"column":9,"offset":420},"end":{"line":35,"column":21,"offset":432}}}],"position":{"start":{"line":35,"column":1,"offset":412},"end":{"line":35,"column":21,"offset":432}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">-i</code>","position":{"start":{"line":37,"column":1,"offset":436},"end":{"line":37,"column":5,"offset":440}}},{"type":"text","value":"保证容器中STDIN是开启的（不懂是什么意思）","position":{"start":{"line":37,"column":5,"offset":440},"end":{"line":37,"column":28,"offset":463}}}],"position":{"start":{"line":37,"column":1,"offset":436},"end":{"line":37,"column":28,"offset":463}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">-t</code>","position":{"start":{"line":39,"column":1,"offset":467},"end":{"line":39,"column":5,"offset":471}}},{"type":"text","value":"为容器分配一个伪tty终端（不懂什么意思）","position":{"start":{"line":39,"column":5,"offset":471},"end":{"line":39,"column":26,"offset":492}}}],"position":{"start":{"line":39,"column":1,"offset":467},"end":{"line":39,"column":26,"offset":492}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在推出了上面运行开启的ubuntu里的bash之后，在bash中运行","position":{"start":{"line":41,"column":1,"offset":496},"end":{"line":41,"column":35,"offset":530}}},{"type":"raw","value":"<code class=\"language-text\">exit</code>","position":{"start":{"line":41,"column":35,"offset":530},"end":{"line":41,"column":41,"offset":536}}},{"type":"text","value":"会推出这个bash，同时退出这个container。","position":{"start":{"line":41,"column":41,"offset":536},"end":{"line":41,"column":67,"offset":562}}}],"position":{"start":{"line":41,"column":1,"offset":496},"end":{"line":41,"column":67,"offset":562}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"重新启动：","position":{"start":{"line":43,"column":1,"offset":566},"end":{"line":43,"column":6,"offset":571}}}],"position":{"start":{"line":43,"column":1,"offset":566},"end":{"line":43,"column":6,"offset":571}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker start terminal</code></pre></div>","position":{"start":{"line":45,"column":1,"offset":575},"end":{"line":47,"column":4,"offset":615}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"重新启动会按照最开始","position":{"start":{"line":49,"column":1,"offset":619},"end":{"line":49,"column":11,"offset":629}}},{"type":"raw","value":"<code class=\"language-text\">docker run</code>","position":{"start":{"line":49,"column":11,"offset":629},"end":{"line":49,"column":23,"offset":641}}},{"type":"text","value":"的参数来运行，所以也会重新启动出一个交互式shell。如果需要连接这个shell，可以使用：","position":{"start":{"line":49,"column":23,"offset":641},"end":{"line":49,"column":69,"offset":687}}}],"position":{"start":{"line":49,"column":1,"offset":619},"end":{"line":49,"column":69,"offset":687}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker attach terminal</code></pre></div>","position":{"start":{"line":51,"column":1,"offset":691},"end":{"line":53,"column":4,"offset":732}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"来重新附着到容器的会话。","position":{"start":{"line":55,"column":1,"offset":736},"end":{"line":55,"column":13,"offset":748}}}],"position":{"start":{"line":55,"column":1,"offset":736},"end":{"line":55,"column":13,"offset":748}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果要使用守护进程（daemon），也就是没有交互，在后台运行的进程，那么要加入","position":{"start":{"line":57,"column":1,"offset":752},"end":{"line":57,"column":41,"offset":792}}},{"type":"raw","value":"<code class=\"language-text\">-d</code>","position":{"start":{"line":57,"column":41,"offset":792},"end":{"line":57,"column":45,"offset":796}}},{"type":"text","value":"标记","position":{"start":{"line":57,"column":45,"offset":796},"end":{"line":57,"column":47,"offset":798}}}],"position":{"start":{"line":57,"column":1,"offset":752},"end":{"line":57,"column":47,"offset":798}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker run --name daemon_hw -d ubuntu /bin/sh -c  <span class=\"token string\">\"while true; do echo hello world; sleep 1; done\"</span></code></pre></div>","position":{"start":{"line":59,"column":1,"offset":802},"end":{"line":61,"column":4,"offset":919}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"检查容器的log，可以：","position":{"start":{"line":63,"column":1,"offset":923},"end":{"line":63,"column":13,"offset":935}}}],"position":{"start":{"line":63,"column":1,"offset":923},"end":{"line":63,"column":13,"offset":935}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker logs daemon_hw</code></pre></div>","position":{"start":{"line":65,"column":1,"offset":939},"end":{"line":67,"column":4,"offset":979}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">logs</code>","position":{"start":{"line":69,"column":1,"offset":983},"end":{"line":69,"column":7,"offset":989}}},{"type":"text","value":"还有一些如","position":{"start":{"line":69,"column":7,"offset":989},"end":{"line":69,"column":12,"offset":994}}},{"type":"raw","value":"<code class=\"language-text\">-f</code>","position":{"start":{"line":69,"column":12,"offset":994},"end":{"line":69,"column":16,"offset":998}}},{"type":"text","value":"之类的flag。","position":{"start":{"line":69,"column":16,"offset":998},"end":{"line":69,"column":24,"offset":1006}}}],"position":{"start":{"line":69,"column":1,"offset":983},"end":{"line":69,"column":24,"offset":1006}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"查看容器内部进程可以用：","position":{"start":{"line":71,"column":1,"offset":1010},"end":{"line":71,"column":13,"offset":1022}}}],"position":{"start":{"line":71,"column":1,"offset":1010},"end":{"line":71,"column":13,"offset":1022}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker <span class=\"token function\">top</span> daemon_hw</code></pre></div>","position":{"start":{"line":73,"column":1,"offset":1026},"end":{"line":75,"column":4,"offset":1065}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"停止容器可以：","position":{"start":{"line":77,"column":1,"offset":1069},"end":{"line":77,"column":8,"offset":1076}}}],"position":{"start":{"line":77,"column":1,"offset":1069},"end":{"line":77,"column":8,"offset":1076}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker stop daemon_hw</code></pre></div>","position":{"start":{"line":79,"column":1,"offset":1080},"end":{"line":81,"column":4,"offset":1120}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"自动重启容器：","position":{"start":{"line":83,"column":1,"offset":1124},"end":{"line":83,"column":8,"offset":1131}}}],"position":{"start":{"line":83,"column":1,"offset":1124},"end":{"line":83,"column":8,"offset":1131}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker run --restart<span class=\"token operator\">=</span>always --name daemon_always -d ubuntu /bin/sh -c  <span class=\"token string\">\"while true; do echo hello world; sleep 1; done\"</span></code></pre></div>","position":{"start":{"line":85,"column":1,"offset":1135},"end":{"line":87,"column":4,"offset":1273}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这样的话不管出了什么问题，都会重启。attach之后ctrl+c或者","position":{"start":{"line":89,"column":1,"offset":1277},"end":{"line":89,"column":35,"offset":1311}}},{"type":"raw","value":"<code class=\"language-text\">docker stop</code>","position":{"start":{"line":89,"column":35,"offset":1311},"end":{"line":89,"column":48,"offset":1324}}},{"type":"text","value":"就不会restart了。","position":{"start":{"line":89,"column":48,"offset":1324},"end":{"line":89,"column":60,"offset":1336}}}],"position":{"start":{"line":89,"column":1,"offset":1277},"end":{"line":89,"column":60,"offset":1336}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"或者可以设置","position":{"start":{"line":91,"column":1,"offset":1340},"end":{"line":91,"column":7,"offset":1346}}},{"type":"raw","value":"<code class=\"language-text\">--restart=on-failure:5</code>","position":{"start":{"line":91,"column":7,"offset":1346},"end":{"line":91,"column":31,"offset":1370}}},{"type":"text","value":"，最多重启5次。","position":{"start":{"line":91,"column":31,"offset":1370},"end":{"line":91,"column":39,"offset":1378}}}],"position":{"start":{"line":91,"column":1,"offset":1340},"end":{"line":91,"column":39,"offset":1378}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在restarting状态下的container可以直接被删除。","position":{"start":{"line":93,"column":1,"offset":1382},"end":{"line":93,"column":33,"offset":1414}}}],"position":{"start":{"line":93,"column":1,"offset":1382},"end":{"line":93,"column":33,"offset":1414}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker container <span class=\"token function\">rm</span> daemon_always</code></pre></div>","position":{"start":{"line":95,"column":1,"offset":1418},"end":{"line":97,"column":4,"offset":1470}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"image相关","position":{"start":{"line":99,"column":4,"offset":1477},"end":{"line":99,"column":11,"offset":1484}}}],"position":{"start":{"line":99,"column":1,"offset":1474},"end":{"line":99,"column":11,"offset":1484}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在书的第四章最开头有对image和container的结构的简介。","position":{"start":{"line":101,"column":1,"offset":1488},"end":{"line":101,"column":34,"offset":1521}}}],"position":{"start":{"line":101,"column":1,"offset":1488},"end":{"line":101,"column":34,"offset":1521}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"本地的所有image和container都在","position":{"start":{"line":103,"column":1,"offset":1525},"end":{"line":103,"column":23,"offset":1547}}},{"type":"raw","value":"<code class=\"language-text\">/var/lib/docker</code>","position":{"start":{"line":103,"column":23,"offset":1547},"end":{"line":103,"column":40,"offset":1564}}},{"type":"text","value":"之下。","position":{"start":{"line":103,"column":40,"offset":1564},"end":{"line":103,"column":43,"offset":1567}}}],"position":{"start":{"line":103,"column":1,"offset":1525},"end":{"line":103,"column":43,"offset":1567}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"列出所有镜像：","position":{"start":{"line":105,"column":1,"offset":1571},"end":{"line":105,"column":8,"offset":1578}}}],"position":{"start":{"line":105,"column":1,"offset":1571},"end":{"line":105,"column":8,"offset":1578}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker image</code></pre></div>","position":{"start":{"line":107,"column":1,"offset":1582},"end":{"line":109,"column":4,"offset":1613}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"从registry获取image","position":{"start":{"line":111,"column":1,"offset":1617},"end":{"line":111,"column":17,"offset":1633}}}],"position":{"start":{"line":111,"column":1,"offset":1617},"end":{"line":111,"column":17,"offset":1633}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker pull ubuntu:12.04</code></pre></div>","position":{"start":{"line":113,"column":1,"offset":1637},"end":{"line":115,"column":4,"offset":1680}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用","position":{"start":{"line":117,"column":1,"offset":1684},"end":{"line":117,"column":2,"offset":1685}}},{"type":"raw","value":"<code class=\"language-text\">docker search</code>","position":{"start":{"line":117,"column":2,"offset":1685},"end":{"line":117,"column":17,"offset":1700}}},{"type":"text","value":"来检索镜像","position":{"start":{"line":117,"column":17,"offset":1700},"end":{"line":117,"column":22,"offset":1705}}}],"position":{"start":{"line":117,"column":1,"offset":1684},"end":{"line":117,"column":22,"offset":1705}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker search puppet</code></pre></div>","position":{"start":{"line":119,"column":1,"offset":1709},"end":{"line":121,"column":4,"offset":1748}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"构建image","position":{"start":{"line":123,"column":5,"offset":1756},"end":{"line":123,"column":12,"offset":1763}}}],"position":{"start":{"line":123,"column":1,"offset":1752},"end":{"line":123,"column":12,"offset":1763}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"可以先在container里面安装如说","position":{"start":{"line":125,"column":1,"offset":1767},"end":{"line":125,"column":20,"offset":1786}}},{"type":"raw","value":"<code class=\"language-text\">sudo apt-get -y install apache2</code>","position":{"start":{"line":125,"column":20,"offset":1786},"end":{"line":125,"column":53,"offset":1819}}},{"type":"text","value":"。然后退出container，再","position":{"start":{"line":125,"column":53,"offset":1819},"end":{"line":125,"column":69,"offset":1835}}}],"position":{"start":{"line":125,"column":1,"offset":1767},"end":{"line":125,"column":69,"offset":1835}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">sudo docker commit [container-id] [publish-name]</code>","position":{"start":{"line":127,"column":1,"offset":1839},"end":{"line":127,"column":52,"offset":1890}}}],"position":{"start":{"line":127,"column":1,"offset":1839},"end":{"line":127,"column":52,"offset":1890}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"不过更常见的是用","position":{"start":{"line":129,"column":1,"offset":1894},"end":{"line":129,"column":9,"offset":1902}}},{"type":"raw","value":"<code class=\"language-text\">Dockerfile</code>","position":{"start":{"line":129,"column":9,"offset":1902},"end":{"line":129,"column":21,"offset":1914}}}],"position":{"start":{"line":129,"column":1,"offset":1894},"end":{"line":129,"column":21,"offset":1914}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"首先在希望publish的文件夹中创建一个`Dockerfile，下面是一个Dockerfile的例子","position":{"start":{"line":131,"column":1,"offset":1918},"end":{"line":131,"column":52,"offset":1969}}}],"position":{"start":{"line":131,"column":1,"offset":1918},"end":{"line":131,"column":52,"offset":1969}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Version: 0.0.1</span>\n<span class=\"token keyword\">FROM</span> ubuntu<span class=\"token punctuation\">:</span>14.04\n<span class=\"token keyword\">MAINTAINER</span> zhuzilin <span class=\"token string\">\"zhuzilinallen@gmail.com\"</span>\n<span class=\"token keyword\">RUN</span> apt<span class=\"token punctuation\">-</span>get update &amp;&amp; apt<span class=\"token punctuation\">-</span>get install <span class=\"token punctuation\">-</span>y nginx\n<span class=\"token keyword\">RUN</span> echo <span class=\"token string\">'Hi, I am in your container'</span> \\\n    <span class=\"token punctuation\">></span>/user/share/nginx/html/index.html\n<span class=\"token keyword\">EXPOSE</span> 80</code></pre></div>","position":{"start":{"line":133,"column":1,"offset":1973},"end":{"line":141,"column":4,"offset":2215}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker会先","position":{"start":{"line":143,"column":1,"offset":2219},"end":{"line":143,"column":9,"offset":2227}}}],"position":{"start":{"line":143,"column":1,"offset":2219},"end":{"line":143,"column":9,"offset":2227}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"从基础镜像(ubuntu)运行一个容器","position":{"start":{"line":145,"column":3,"offset":2233},"end":{"line":145,"column":22,"offset":2252}}}],"position":{"start":{"line":145,"column":1,"offset":2231},"end":{"line":145,"column":22,"offset":2252}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"执行一条指令，对容器做出修改","position":{"start":{"line":146,"column":3,"offset":2256},"end":{"line":146,"column":17,"offset":2270}}}],"position":{"start":{"line":146,"column":1,"offset":2254},"end":{"line":146,"column":17,"offset":2270}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"执行类似","position":{"start":{"line":147,"column":3,"offset":2274},"end":{"line":147,"column":7,"offset":2278}}},{"type":"raw","value":"<code class=\"language-text\">docker commit</code>","position":{"start":{"line":147,"column":7,"offset":2278},"end":{"line":147,"column":22,"offset":2293}}},{"type":"text","value":"的指令，提交一个新的镜像层","position":{"start":{"line":147,"column":22,"offset":2293},"end":{"line":147,"column":35,"offset":2306}}}],"position":{"start":{"line":147,"column":1,"offset":2272},"end":{"line":147,"column":35,"offset":2306}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"基于新的镜像运行一个新容器","position":{"start":{"line":148,"column":3,"offset":2310},"end":{"line":148,"column":16,"offset":2323}}}],"position":{"start":{"line":148,"column":1,"offset":2308},"end":{"line":148,"column":16,"offset":2323}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"执行下一条指令","position":{"start":{"line":149,"column":3,"offset":2327},"end":{"line":149,"column":10,"offset":2334}}}],"position":{"start":{"line":149,"column":1,"offset":2325},"end":{"line":149,"column":10,"offset":2334}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"...","position":{"start":{"line":150,"column":3,"offset":2338},"end":{"line":150,"column":6,"offset":2341}}}],"position":{"start":{"line":150,"column":1,"offset":2336},"end":{"line":150,"column":6,"offset":2341}}},{"type":"text","value":"\n"}],"position":{"start":{"line":145,"column":1,"offset":2231},"end":{"line":150,"column":6,"offset":2341}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"所以即使build失败了，也会生成某个镜像，可以对这个镜像进行debug来查找错误。","position":{"start":{"line":152,"column":1,"offset":2345},"end":{"line":152,"column":43,"offset":2387}}}],"position":{"start":{"line":152,"column":1,"offset":2345},"end":{"line":152,"column":43,"offset":2387}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"默认会在","position":{"start":{"line":154,"column":1,"offset":2391},"end":{"line":154,"column":5,"offset":2395}}},{"type":"raw","value":"<code class=\"language-text\">/bin/sh -c</code>","position":{"start":{"line":154,"column":5,"offset":2395},"end":{"line":154,"column":17,"offset":2407}}},{"type":"text","value":"来执行","position":{"start":{"line":154,"column":17,"offset":2407},"end":{"line":154,"column":20,"offset":2410}}},{"type":"raw","value":"<code class=\"language-text\">RUN</code>","position":{"start":{"line":154,"column":20,"offset":2410},"end":{"line":154,"column":25,"offset":2415}}},{"type":"text","value":"的参数，如果平台不支持shell或者不希望用shell运行，可以使用","position":{"start":{"line":154,"column":25,"offset":2415},"end":{"line":154,"column":59,"offset":2449}}},{"type":"raw","value":"<code class=\"language-text\">exec</code>","position":{"start":{"line":154,"column":59,"offset":2449},"end":{"line":154,"column":65,"offset":2455}}},{"type":"text","value":"格式，如","position":{"start":{"line":154,"column":65,"offset":2455},"end":{"line":154,"column":69,"offset":2459}}}],"position":{"start":{"line":154,"column":1,"offset":2391},"end":{"line":154,"column":69,"offset":2459}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">RUN</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"apt-get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"install\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-y\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"nginx\"</span><span class=\"token punctuation\">]</span></code></pre></div>","position":{"start":{"line":156,"column":1,"offset":2463},"end":{"line":158,"column":4,"offset":2524}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">EXPOSE</code>","position":{"start":{"line":160,"column":1,"offset":2528},"end":{"line":160,"column":9,"offset":2536}}},{"type":"text","value":"会指令端口。但是出于安全按原因，docker并不会在运行镜像的时候自动打开这个端口，而是需要在","position":{"start":{"line":160,"column":9,"offset":2536},"end":{"line":160,"column":56,"offset":2583}}},{"type":"raw","value":"<code class=\"language-text\">docker run</code>","position":{"start":{"line":160,"column":56,"offset":2583},"end":{"line":160,"column":68,"offset":2595}}},{"type":"text","value":"中设置。","position":{"start":{"line":160,"column":68,"offset":2595},"end":{"line":160,"column":72,"offset":2599}}}],"position":{"start":{"line":160,"column":1,"offset":2528},"end":{"line":160,"column":72,"offset":2599}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"之后就可以build这个镜像了","position":{"start":{"line":162,"column":1,"offset":2603},"end":{"line":162,"column":16,"offset":2618}}}],"position":{"start":{"line":162,"column":1,"offset":2603},"end":{"line":162,"column":16,"offset":2618}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker build <span class=\"token keyword\">.</span></code></pre></div>","position":{"start":{"line":164,"column":1,"offset":2622},"end":{"line":166,"column":4,"offset":2655}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker会把中间过程中生成的image作为缓存，以便下一次build使用，如果要去掉缓存，可以加上","position":{"start":{"line":168,"column":1,"offset":2659},"end":{"line":168,"column":52,"offset":2710}}},{"type":"raw","value":"<code class=\"language-text\">--no-cache</code>","position":{"start":{"line":168,"column":52,"offset":2710},"end":{"line":168,"column":64,"offset":2722}}},{"type":"text","value":"标记。","position":{"start":{"line":168,"column":64,"offset":2722},"end":{"line":168,"column":67,"offset":2725}}}],"position":{"start":{"line":168,"column":1,"offset":2659},"end":{"line":168,"column":67,"offset":2725}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"如果别的Dockerfile的顶部指令相似，就会使用缓存。","position":{"start":{"line":170,"column":1,"offset":2729},"end":{"line":170,"column":30,"offset":2758}}}],"position":{"start":{"line":170,"column":1,"offset":2729},"end":{"line":170,"column":30,"offset":2758}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"之后运行这个image","position":{"start":{"line":172,"column":1,"offset":2762},"end":{"line":172,"column":12,"offset":2773}}}],"position":{"start":{"line":172,"column":1,"offset":2762},"end":{"line":172,"column":12,"offset":2773}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker run -d -p 80 --name nginx <span class=\"token punctuation\">[</span>image-id<span class=\"token punctuation\">]</span> nginx -g <span class=\"token string\">\"daemon off;\"</span></code></pre></div>","position":{"start":{"line":174,"column":1,"offset":2777},"end":{"line":176,"column":4,"offset":2862}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这里的","position":{"start":{"line":178,"column":1,"offset":2866},"end":{"line":178,"column":4,"offset":2869}}},{"type":"raw","value":"<code class=\"language-text\">-p</code>","position":{"start":{"line":178,"column":4,"offset":2869},"end":{"line":178,"column":8,"offset":2873}}},{"type":"text","value":"也设置了80，然后可以通过","position":{"start":{"line":178,"column":8,"offset":2873},"end":{"line":178,"column":21,"offset":2886}}},{"type":"raw","value":"<code class=\"language-text\">sudo docker ps -l</code>","position":{"start":{"line":178,"column":21,"offset":2886},"end":{"line":178,"column":40,"offset":2905}}},{"type":"text","value":"或者","position":{"start":{"line":178,"column":40,"offset":2905},"end":{"line":178,"column":42,"offset":2907}}},{"type":"raw","value":"<code class=\"language-text\">sudo port nginx</code>","position":{"start":{"line":178,"column":42,"offset":2907},"end":{"line":178,"column":59,"offset":2924}}},{"type":"text","value":"来查看端口对应。","position":{"start":{"line":178,"column":59,"offset":2924},"end":{"line":178,"column":67,"offset":2932}}}],"position":{"start":{"line":178,"column":1,"offset":2866},"end":{"line":178,"column":67,"offset":2932}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"或者可以在运行的时候设置对应","position":{"start":{"line":180,"column":1,"offset":2936},"end":{"line":180,"column":15,"offset":2950}}}],"position":{"start":{"line":180,"column":1,"offset":2936},"end":{"line":180,"column":15,"offset":2950}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> docker run -d -p 8080:80 --name nginx <span class=\"token punctuation\">[</span>image-id<span class=\"token punctuation\">]</span> nginx -g <span class=\"token string\">\"daemon off;\"</span></code></pre></div>","position":{"start":{"line":182,"column":1,"offset":2954},"end":{"line":184,"column":4,"offset":3044}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"这样就把容器的80端口绑定在了宿主机的8080端口上。这时访问","position":{"start":{"line":186,"column":1,"offset":3048},"end":{"line":186,"column":32,"offset":3079}}},{"type":"raw","value":"<code class=\"language-text\">localhost:8080</code>","position":{"start":{"line":186,"column":32,"offset":3079},"end":{"line":186,"column":48,"offset":3095}}},{"type":"text","value":"就可以显示出","position":{"start":{"line":186,"column":48,"offset":3095},"end":{"line":186,"column":54,"offset":3101}}},{"type":"raw","value":"<code class=\"language-text\">Hi, I am in your container</code>","position":{"start":{"line":186,"column":54,"offset":3101},"end":{"line":186,"column":82,"offset":3129}}},{"type":"text","value":"了。","position":{"start":{"line":186,"column":82,"offset":3129},"end":{"line":186,"column":84,"offset":3131}}}],"position":{"start":{"line":186,"column":1,"offset":3048},"end":{"line":186,"column":84,"offset":3131}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在","position":{"start":{"line":188,"column":1,"offset":3135},"end":{"line":188,"column":2,"offset":3136}}},{"type":"raw","value":"<code class=\"language-text\">run</code>","position":{"start":{"line":188,"column":2,"offset":3136},"end":{"line":188,"column":7,"offset":3141}}},{"type":"text","value":"指令中还有一个非常使用的","position":{"start":{"line":188,"column":7,"offset":3141},"end":{"line":188,"column":19,"offset":3153}}},{"type":"raw","value":"<code class=\"language-text\">-P</code>","position":{"start":{"line":188,"column":19,"offset":3153},"end":{"line":188,"column":23,"offset":3157}}},{"type":"text","value":"指令，用于把所有的容器内公开的指令随即绑定到某一个随机端口上。","position":{"start":{"line":188,"column":23,"offset":3157},"end":{"line":188,"column":54,"offset":3188}}}],"position":{"start":{"line":188,"column":1,"offset":3135},"end":{"line":188,"column":54,"offset":3188}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Dockerfile的其余指令","position":{"start":{"line":190,"column":5,"offset":3196},"end":{"line":190,"column":20,"offset":3211}}}],"position":{"start":{"line":190,"column":1,"offset":3192},"end":{"line":190,"column":20,"offset":3211}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"CMD","position":{"start":{"line":192,"column":3,"offset":3217},"end":{"line":192,"column":6,"offset":3220}}}],"position":{"start":{"line":192,"column":3,"offset":3217},"end":{"line":192,"column":6,"offset":3220}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"容器被启动时运行的指令。例如：","position":{"start":{"line":194,"column":3,"offset":3226},"end":{"line":194,"column":18,"offset":3241}}}],"position":{"start":{"line":194,"column":3,"offset":3226},"end":{"line":194,"column":18,"offset":3241}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">CMD</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/bash\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-l\"</span><span class=\"token punctuation\">]</span></code></pre></div>","position":{"start":{"line":196,"column":3,"offset":3247},"end":{"line":198,"column":6,"offset":3294}}},{"type":"text","value":"\n"}],"position":{"start":{"line":192,"column":1,"offset":3215},"end":{"line":199,"column":1,"offset":3296}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ENTRYPOINT","position":{"start":{"line":200,"column":3,"offset":3300},"end":{"line":200,"column":13,"offset":3310}}}],"position":{"start":{"line":200,"column":3,"offset":3300},"end":{"line":200,"column":13,"offset":3310}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">docker run</code>","position":{"start":{"line":202,"column":3,"offset":3316},"end":{"line":202,"column":15,"offset":3328}}},{"type":"text","value":"命令行中指定的任何参数都会被当做参数再次传递给ENTRYPOINT指令中指定的命令。如：","position":{"start":{"line":202,"column":15,"offset":3328},"end":{"line":202,"column":59,"offset":3372}}}],"position":{"start":{"line":202,"column":3,"offset":3316},"end":{"line":202,"column":59,"offset":3372}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">ENTRYPOINT</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/usr/sbin/nginx\"</span><span class=\"token punctuation\">]</span></code></pre></div>","position":{"start":{"line":204,"column":3,"offset":3378},"end":{"line":206,"column":6,"offset":3432}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"甚至可以像","position":{"start":{"line":208,"column":3,"offset":3438},"end":{"line":208,"column":8,"offset":3443}}},{"type":"raw","value":"<code class=\"language-text\">CMD</code>","position":{"start":{"line":208,"column":8,"offset":3443},"end":{"line":208,"column":13,"offset":3448}}},{"type":"text","value":"一样加入参数","position":{"start":{"line":208,"column":13,"offset":3448},"end":{"line":208,"column":19,"offset":3454}}}],"position":{"start":{"line":208,"column":3,"offset":3438},"end":{"line":208,"column":19,"offset":3454}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">ENTRYPOINT</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/usr/sbin/nginx\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"-g\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"daemn off;\"</span><span class=\"token punctuation\">]</span></code></pre></div>","position":{"start":{"line":210,"column":3,"offset":3460},"end":{"line":212,"column":6,"offset":3534}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"注意CMD和ENTRYPOINT的最大区别是，CMD是会被","position":{"start":{"line":214,"column":3,"offset":3540},"end":{"line":214,"column":32,"offset":3569}}},{"type":"raw","value":"<code class=\"language-text\">docker run</code>","position":{"start":{"line":214,"column":32,"offset":3569},"end":{"line":214,"column":44,"offset":3581}}},{"type":"text","value":"里面的参数覆盖的，而ENTRYPOINT只会把参数附在其后面。所以也可以同时有ENTRYPOINT和CMD","position":{"start":{"line":214,"column":44,"offset":3581},"end":{"line":214,"column":97,"offset":3634}}}],"position":{"start":{"line":214,"column":3,"offset":3540},"end":{"line":214,"column":97,"offset":3634}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">ENTRYPOINT <span class=\"token punctuation\">[</span><span class=\"token string\">\"/usr/sbin/nginx\"</span><span class=\"token punctuation\">]</span>\nCMD <span class=\"token punctuation\">[</span><span class=\"token string\">\"-h\"</span><span class=\"token punctuation\">]</span></code></pre></div>","position":{"start":{"line":216,"column":3,"offset":3640},"end":{"line":219,"column":6,"offset":3702}}},{"type":"text","value":"\n"}],"position":{"start":{"line":200,"column":1,"offset":3298},"end":{"line":220,"column":1,"offset":3704}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"WORKDIR","position":{"start":{"line":221,"column":3,"offset":3708},"end":{"line":221,"column":10,"offset":3715}}}],"position":{"start":{"line":221,"column":3,"offset":3708},"end":{"line":221,"column":10,"offset":3715}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"用来在从镜像创建新容器的时候，在容器内部设置一个工作牡蛎，","position":{"start":{"line":223,"column":3,"offset":3721},"end":{"line":223,"column":32,"offset":3750}}},{"type":"raw","value":"<code class=\"language-text\">ENTRYPOINT</code>","position":{"start":{"line":223,"column":32,"offset":3750},"end":{"line":223,"column":44,"offset":3762}}},{"type":"text","value":"和","position":{"start":{"line":223,"column":44,"offset":3762},"end":{"line":223,"column":45,"offset":3763}}},{"type":"raw","value":"<code class=\"language-text\">/</code>","position":{"start":{"line":223,"column":45,"offset":3763},"end":{"line":223,"column":48,"offset":3766}}},{"type":"text","value":"或","position":{"start":{"line":223,"column":48,"offset":3766},"end":{"line":223,"column":49,"offset":3767}}},{"type":"raw","value":"<code class=\"language-text\">CMD</code>","position":{"start":{"line":223,"column":49,"offset":3767},"end":{"line":223,"column":54,"offset":3772}}},{"type":"text","value":"指定的程序会在这个目录下执行。如：","position":{"start":{"line":223,"column":54,"offset":3772},"end":{"line":223,"column":71,"offset":3789}}}],"position":{"start":{"line":223,"column":3,"offset":3721},"end":{"line":223,"column":71,"offset":3789}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">WORKDIR</span> /opt/webapp/db\n<span class=\"token keyword\">RUN</span> bundle install\n<span class=\"token keyword\">WORKDIR</span> /opt/webapp\n<span class=\"token keyword\">ENTRYPOINT</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"rackup\"</span><span class=\"token punctuation\">]</span></code></pre></div>","position":{"start":{"line":225,"column":3,"offset":3795},"end":{"line":230,"column":6,"offset":3911}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"就是先把工作目录设为","position":{"start":{"line":232,"column":3,"offset":3917},"end":{"line":232,"column":13,"offset":3927}}},{"type":"raw","value":"<code class=\"language-text\">/opt/webapp/db</code>","position":{"start":{"line":232,"column":13,"offset":3927},"end":{"line":232,"column":29,"offset":3943}}},{"type":"text","value":"，运行","position":{"start":{"line":232,"column":29,"offset":3943},"end":{"line":232,"column":32,"offset":3946}}},{"type":"raw","value":"<code class=\"language-text\">bundle install</code>","position":{"start":{"line":232,"column":32,"offset":3946},"end":{"line":232,"column":48,"offset":3962}}},{"type":"text","value":"，再把工作目录设为","position":{"start":{"line":232,"column":48,"offset":3962},"end":{"line":232,"column":57,"offset":3971}}},{"type":"raw","value":"<code class=\"language-text\">/opt/webapp</code>","position":{"start":{"line":232,"column":57,"offset":3971},"end":{"line":232,"column":70,"offset":3984}}},{"type":"text","value":"，运行ENTRYPOINT。","position":{"start":{"line":232,"column":70,"offset":3984},"end":{"line":232,"column":84,"offset":3998}}}],"position":{"start":{"line":232,"column":3,"offset":3917},"end":{"line":232,"column":84,"offset":3998}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"注意在运行的时候可以用","position":{"start":{"line":234,"column":3,"offset":4004},"end":{"line":234,"column":14,"offset":4015}}},{"type":"raw","value":"<code class=\"language-text\">docker run</code>","position":{"start":{"line":234,"column":14,"offset":4015},"end":{"line":234,"column":26,"offset":4027}}},{"type":"text","value":"的","position":{"start":{"line":234,"column":26,"offset":4027},"end":{"line":234,"column":27,"offset":4028}}},{"type":"raw","value":"<code class=\"language-text\">-w</code>","position":{"start":{"line":234,"column":27,"offset":4028},"end":{"line":234,"column":31,"offset":4032}}},{"type":"text","value":"标记来覆盖工作目录。","position":{"start":{"line":234,"column":31,"offset":4032},"end":{"line":234,"column":41,"offset":4042}}}],"position":{"start":{"line":234,"column":3,"offset":4004},"end":{"line":234,"column":41,"offset":4042}}},{"type":"text","value":"\n"}],"position":{"start":{"line":221,"column":1,"offset":3706},"end":{"line":235,"column":1,"offset":4044}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ENV","position":{"start":{"line":236,"column":3,"offset":4048},"end":{"line":236,"column":6,"offset":4051}}}],"position":{"start":{"line":236,"column":3,"offset":4048},"end":{"line":236,"column":6,"offset":4051}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"设置环境变量，设置后后续任何RUN都可以用。","position":{"start":{"line":238,"column":3,"offset":4057},"end":{"line":238,"column":25,"offset":4079}}}],"position":{"start":{"line":238,"column":3,"offset":4057},"end":{"line":238,"column":25,"offset":4079}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">ENV</span> RVM_PATH /home/rvm</code></pre></div>","position":{"start":{"line":240,"column":3,"offset":4085},"end":{"line":242,"column":6,"offset":4131}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"之后运行","position":{"start":{"line":244,"column":3,"offset":4137},"end":{"line":244,"column":7,"offset":4141}}},{"type":"raw","value":"<code class=\"language-text\">RUN gem install unicorn</code>","position":{"start":{"line":244,"column":7,"offset":4141},"end":{"line":244,"column":32,"offset":4166}}},{"type":"text","value":"就会实际运行","position":{"start":{"line":244,"column":32,"offset":4166},"end":{"line":244,"column":38,"offset":4172}}},{"type":"raw","value":"<code class=\"language-text\">RVM_PATH=/home/rvm gem install unicorn</code>","position":{"start":{"line":244,"column":38,"offset":4172},"end":{"line":244,"column":78,"offset":4212}}},{"type":"text","value":"。","position":{"start":{"line":244,"column":78,"offset":4212},"end":{"line":244,"column":79,"offset":4213}}}],"position":{"start":{"line":244,"column":3,"offset":4137},"end":{"line":244,"column":79,"offset":4213}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"也可以设置多变量：","position":{"start":{"line":246,"column":3,"offset":4219},"end":{"line":246,"column":12,"offset":4228}}}],"position":{"start":{"line":246,"column":3,"offset":4219},"end":{"line":246,"column":12,"offset":4228}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">ENV</span> RVM_PATH /home/rvm RVM_ARCHFLAG=<span class=\"token string\">\"-arch i386\"</span></code></pre></div>","position":{"start":{"line":248,"column":3,"offset":4234},"end":{"line":250,"column":6,"offset":4306}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在别的dockerfile指令中也可以直接使用","position":{"start":{"line":252,"column":3,"offset":4312},"end":{"line":252,"column":26,"offset":4335}}}],"position":{"start":{"line":252,"column":3,"offset":4312},"end":{"line":252,"column":26,"offset":4335}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">ENV</span> TARGET_DIR /opt/app\n<span class=\"token keyword\">WORKDIR</span> $TARGET_DIR</code></pre></div>","position":{"start":{"line":254,"column":3,"offset":4341},"end":{"line":257,"column":6,"offset":4411}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"在container中运行","position":{"start":{"line":259,"column":3,"offset":4417},"end":{"line":259,"column":16,"offset":4430}}},{"type":"raw","value":"<code class=\"language-text\">env</code>","position":{"start":{"line":259,"column":16,"offset":4430},"end":{"line":259,"column":21,"offset":4435}}},{"type":"text","value":"可以看到我们设置的环境变量。","position":{"start":{"line":259,"column":21,"offset":4435},"end":{"line":259,"column":35,"offset":4449}}}],"position":{"start":{"line":259,"column":3,"offset":4417},"end":{"line":259,"column":35,"offset":4449}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"也可以用","position":{"start":{"line":261,"column":3,"offset":4455},"end":{"line":261,"column":7,"offset":4459}}},{"type":"raw","value":"<code class=\"language-text\">docker run</code>","position":{"start":{"line":261,"column":7,"offset":4459},"end":{"line":261,"column":19,"offset":4471}}},{"type":"text","value":"的","position":{"start":{"line":261,"column":19,"offset":4471},"end":{"line":261,"column":20,"offset":4472}}},{"type":"raw","value":"<code class=\"language-text\">-e</code>","position":{"start":{"line":261,"column":20,"offset":4472},"end":{"line":261,"column":24,"offset":4476}}},{"type":"text","value":"传递环境变量。","position":{"start":{"line":261,"column":24,"offset":4476},"end":{"line":261,"column":31,"offset":4483}}}],"position":{"start":{"line":261,"column":3,"offset":4455},"end":{"line":261,"column":31,"offset":4483}}},{"type":"text","value":"\n"}],"position":{"start":{"line":236,"column":1,"offset":4046},"end":{"line":262,"column":1,"offset":4485}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"USER","position":{"start":{"line":263,"column":3,"offset":4489},"end":{"line":263,"column":7,"offset":4493}}}],"position":{"start":{"line":263,"column":3,"offset":4489},"end":{"line":263,"column":7,"offset":4493}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"指定该镜像会以什么样的用户去运行。（不太明白）","position":{"start":{"line":265,"column":3,"offset":4499},"end":{"line":265,"column":26,"offset":4522}}}],"position":{"start":{"line":265,"column":3,"offset":4499},"end":{"line":265,"column":26,"offset":4522}}},{"type":"text","value":"\n"}],"position":{"start":{"line":263,"column":1,"offset":4487},"end":{"line":266,"column":1,"offset":4524}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"VOLUME","position":{"start":{"line":267,"column":3,"offset":4528},"end":{"line":267,"column":9,"offset":4534}}}],"position":{"start":{"line":267,"column":3,"offset":4528},"end":{"line":267,"column":9,"offset":4534}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"像基于镜像创建的容器添加卷。一个卷是可以存在与一个或多个容器内的特定目录。用于多个容器共享资源。","position":{"start":{"line":269,"column":3,"offset":4540},"end":{"line":269,"column":51,"offset":4588}}}],"position":{"start":{"line":269,"column":3,"offset":4540},"end":{"line":269,"column":51,"offset":4588}}},{"type":"text","value":"\n"}],"position":{"start":{"line":267,"column":1,"offset":4526},"end":{"line":270,"column":1,"offset":4590}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ADD","position":{"start":{"line":271,"column":3,"offset":4594},"end":{"line":271,"column":6,"offset":4597}}}],"position":{"start":{"line":271,"column":3,"offset":4594},"end":{"line":271,"column":6,"offset":4597}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"将构建环境下的文件和目录复制到镜像中。如：","position":{"start":{"line":273,"column":3,"offset":4603},"end":{"line":273,"column":24,"offset":4624}}}],"position":{"start":{"line":273,"column":3,"offset":4603},"end":{"line":273,"column":24,"offset":4624}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">ADD</span> software.lic /opt/application/software.lic</code></pre></div>","position":{"start":{"line":275,"column":3,"offset":4630},"end":{"line":277,"column":6,"offset":4700}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"就是把本地的","position":{"start":{"line":279,"column":3,"offset":4706},"end":{"line":279,"column":9,"offset":4712}}},{"type":"raw","value":"<code class=\"language-text\">software.lic</code>","position":{"start":{"line":279,"column":9,"offset":4712},"end":{"line":279,"column":23,"offset":4726}}},{"type":"text","value":"复制到镜像中的","position":{"start":{"line":279,"column":23,"offset":4726},"end":{"line":279,"column":30,"offset":4733}}},{"type":"raw","value":"<code class=\"language-text\">/opt/application/software.lic</code>","position":{"start":{"line":279,"column":30,"offset":4733},"end":{"line":279,"column":61,"offset":4764}}},{"type":"text","value":"。","position":{"start":{"line":279,"column":61,"offset":4764},"end":{"line":279,"column":62,"offset":4765}}}],"position":{"start":{"line":279,"column":3,"offset":4706},"end":{"line":279,"column":62,"offset":4765}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ADD也可以加入URL格式的文件。如","position":{"start":{"line":281,"column":3,"offset":4771},"end":{"line":281,"column":21,"offset":4789}}},{"type":"raw","value":"<code class=\"language-text\">http://wordpress.org/latest.zip</code>","position":{"start":{"line":281,"column":21,"offset":4789},"end":{"line":281,"column":54,"offset":4822}}},{"type":"text","value":"。","position":{"start":{"line":281,"column":54,"offset":4822},"end":{"line":281,"column":55,"offset":4823}}}],"position":{"start":{"line":281,"column":3,"offset":4771},"end":{"line":281,"column":55,"offset":4823}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"注意如果加入","position":{"start":{"line":283,"column":3,"offset":4829},"end":{"line":283,"column":9,"offset":4835}}},{"type":"raw","value":"<code class=\"language-text\">gzip, bzip2, xz</code>","position":{"start":{"line":283,"column":9,"offset":4835},"end":{"line":283,"column":26,"offset":4852}}},{"type":"text","value":"等文件时，会自动解压。","position":{"start":{"line":283,"column":26,"offset":4852},"end":{"line":283,"column":37,"offset":4863}}}],"position":{"start":{"line":283,"column":3,"offset":4829},"end":{"line":283,"column":37,"offset":4863}}},{"type":"text","value":"\n"}],"position":{"start":{"line":271,"column":1,"offset":4592},"end":{"line":284,"column":1,"offset":4865}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"COPY","position":{"start":{"line":285,"column":3,"offset":4869},"end":{"line":285,"column":7,"offset":4873}}}],"position":{"start":{"line":285,"column":3,"offset":4869},"end":{"line":285,"column":7,"offset":4873}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"类似ADD，不过只赋值，不会文件提取与解压。如：","position":{"start":{"line":287,"column":3,"offset":4879},"end":{"line":287,"column":27,"offset":4903}}}],"position":{"start":{"line":287,"column":3,"offset":4879},"end":{"line":287,"column":27,"offset":4903}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">COPY</span> conf.d/ /etc/apache2/</code></pre></div>","position":{"start":{"line":289,"column":3,"offset":4909},"end":{"line":291,"column":6,"offset":4959}}},{"type":"text","value":"\n"}],"position":{"start":{"line":285,"column":1,"offset":4867},"end":{"line":292,"column":1,"offset":4961}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"LABEL","position":{"start":{"line":293,"column":3,"offset":4965},"end":{"line":293,"column":8,"offset":4970}}}],"position":{"start":{"line":293,"column":3,"offset":4965},"end":{"line":293,"column":8,"offset":4970}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"给镜像添加元数据，如：","position":{"start":{"line":295,"column":3,"offset":4976},"end":{"line":295,"column":14,"offset":4987}}}],"position":{"start":{"line":295,"column":3,"offset":4976},"end":{"line":295,"column":14,"offset":4987}}},{"type":"text","value":"\n"},{"type":"raw","value":"<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token keyword\">LABEL</span> version=<span class=\"token string\">\"1.0\"</span>\n<span class=\"token keyword\">LABEL</span> location=<span class=\"token string\">\"New York\"</span> type=<span class=\"token string\">\"Data Center\"</span> role=<span class=\"token string\">\"Web Server\"</span></code></pre></div>","position":{"start":{"line":297,"column":3,"offset":4993},"end":{"line":300,"column":6,"offset":5102}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"使用","position":{"start":{"line":302,"column":3,"offset":5108},"end":{"line":302,"column":5,"offset":5110}}},{"type":"raw","value":"<code class=\"language-text\">docker inspect</code>","position":{"start":{"line":302,"column":5,"offset":5110},"end":{"line":302,"column":21,"offset":5126}}},{"type":"text","value":"的时候可以看到label对应的json。","position":{"start":{"line":302,"column":21,"offset":5126},"end":{"line":302,"column":41,"offset":5146}}}],"position":{"start":{"line":302,"column":3,"offset":5108},"end":{"line":302,"column":41,"offset":5146}}},{"type":"text","value":"\n"}],"position":{"start":{"line":293,"column":1,"offset":4963},"end":{"line":303,"column":1,"offset":5148}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"STOPSIGNAL","position":{"start":{"line":304,"column":3,"offset":5152},"end":{"line":304,"column":13,"offset":5162}}}],"position":{"start":{"line":304,"column":3,"offset":5152},"end":{"line":304,"column":13,"offset":5162}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"估计用不上...","position":{"start":{"line":306,"column":3,"offset":5168},"end":{"line":306,"column":11,"offset":5176}}}],"position":{"start":{"line":306,"column":3,"offset":5168},"end":{"line":306,"column":11,"offset":5176}}},{"type":"text","value":"\n"}],"position":{"start":{"line":304,"column":1,"offset":5150},"end":{"line":307,"column":1,"offset":5178}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ARG","position":{"start":{"line":308,"column":3,"offset":5182},"end":{"line":308,"column":6,"offset":5185}}}],"position":{"start":{"line":308,"column":3,"offset":5182},"end":{"line":308,"column":6,"offset":5185}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"raw","value":"<code class=\"language-text\">docker build</code>","position":{"start":{"line":310,"column":3,"offset":5191},"end":{"line":310,"column":17,"offset":5205}}},{"type":"text","value":"的时候可以传入的参数。可以用","position":{"start":{"line":310,"column":17,"offset":5205},"end":{"line":310,"column":31,"offset":5219}}},{"type":"raw","value":"<code class=\"language-text\">docker build</code>","position":{"start":{"line":310,"column":31,"offset":5219},"end":{"line":310,"column":45,"offset":5233}}},{"type":"text","value":"中的","position":{"start":{"line":310,"column":45,"offset":5233},"end":{"line":310,"column":47,"offset":5235}}},{"type":"raw","value":"<code class=\"language-text\">--build-arg</code>","position":{"start":{"line":310,"column":47,"offset":5235},"end":{"line":310,"column":60,"offset":5248}}},{"type":"text","value":"指定。注意不要穿证书或密钥。","position":{"start":{"line":310,"column":60,"offset":5248},"end":{"line":310,"column":74,"offset":5262}}}],"position":{"start":{"line":310,"column":3,"offset":5191},"end":{"line":310,"column":74,"offset":5262}}},{"type":"text","value":"\n"}],"position":{"start":{"line":308,"column":1,"offset":5180},"end":{"line":311,"column":1,"offset":5264}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ONBUILD","position":{"start":{"line":312,"column":3,"offset":5268},"end":{"line":312,"column":10,"offset":5275}}}],"position":{"start":{"line":312,"column":3,"offset":5268},"end":{"line":312,"column":10,"offset":5275}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"给镜像加trigger的，等见过再说吧。","position":{"start":{"line":314,"column":3,"offset":5281},"end":{"line":314,"column":23,"offset":5301}}}],"position":{"start":{"line":314,"column":3,"offset":5281},"end":{"line":314,"column":23,"offset":5301}}},{"type":"text","value":"\n"}],"position":{"start":{"line":312,"column":1,"offset":5266},"end":{"line":314,"column":23,"offset":5301}}},{"type":"text","value":"\n"}],"position":{"start":{"line":192,"column":1,"offset":3215},"end":{"line":314,"column":23,"offset":5301}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"删除镜像，可以用","position":{"start":{"line":318,"column":1,"offset":5309},"end":{"line":318,"column":9,"offset":5317}}},{"type":"raw","value":"<code class=\"language-text\">docker rmi</code>","position":{"start":{"line":318,"column":9,"offset":5317},"end":{"line":318,"column":21,"offset":5329}}},{"type":"text","value":"或者","position":{"start":{"line":318,"column":21,"offset":5329},"end":{"line":318,"column":23,"offset":5331}}},{"type":"raw","value":"<code class=\"language-text\">docker image rm</code>","position":{"start":{"line":318,"column":23,"offset":5331},"end":{"line":318,"column":40,"offset":5348}}},{"type":"text","value":"。","position":{"start":{"line":318,"column":40,"offset":5348},"end":{"line":318,"column":41,"offset":5349}}}],"position":{"start":{"line":318,"column":1,"offset":5309},"end":{"line":318,"column":41,"offset":5349}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"用例","position":{"start":{"line":320,"column":5,"offset":5357},"end":{"line":320,"column":7,"offset":5359}}}],"position":{"start":{"line":320,"column":1,"offset":5353},"end":{"line":320,"column":7,"offset":5359}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"真正使用docker还是要靠动手。我创了一个叫","position":{"start":{"line":322,"column":1,"offset":5363},"end":{"line":322,"column":24,"offset":5386}}},{"type":"element","tagName":"a","properties":{"href":"https://github.com/zhuzilin/play-with-docker"},"children":[{"type":"text","value":"play-with-docker","position":{"start":{"line":322,"column":25,"offset":5387},"end":{"line":322,"column":41,"offset":5403}}}],"position":{"start":{"line":322,"column":24,"offset":5386},"end":{"line":322,"column":88,"offset":5450}}},{"type":"text","value":"的repo来放自己写的例子。有兴趣的朋友也可以来看看。","position":{"start":{"line":322,"column":88,"offset":5450},"end":{"line":322,"column":115,"offset":5477}}}],"position":{"start":{"line":322,"column":1,"offset":5363},"end":{"line":322,"column":115,"offset":5477}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":324,"column":1,"offset":5481}}}}